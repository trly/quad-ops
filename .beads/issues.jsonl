{"id":"quad-ops-0e2","content_hash":"749f1fa3f5105e6382aeea34216941e93c17dd47ed452691ae3a31b81f781468","title":"StartMany and StopMany must wait for unit generation before operations","description":"StartMany and StopMany operations fail with \"Unit not found\" when systemd units haven't been generated yet by the Quadlet generator.\n\n## Symptoms\nWhen running `quad-ops up`, services fail to start despite successful unit file writing:\n```\ntime=2025-11-09T23:49:10.550-05:00 level=ERROR msg=\"Failed to start service\" name=llm-ollama error=\"failed to start service llm-ollama: error starting unit llm-ollama.service: Unit llm-ollama.service not found.\"\n```\n\n## Root Cause\n- `StartMany()` calls `Start()` which immediately attempts `conn.StartUnit()`\n- `StopMany()` calls `Stop()` which immediately attempts `conn.StopUnit()`\n- Neither waits for the Quadlet generator to create the unit files\n- `RestartMany()` has the proper fix but `StartMany`/`StopMany` don't\n\n## Impact\n- `quad-ops up` fails to start any services after reload\n- Requires manual wait before retrying\n- Makes automation and CI unreliable\n\n## Related\n- quad-ops-5f0: Fixed RestartMany with unit generation verification\n- The fix there should be applied to StartMany and StopMany as well","acceptance_criteria":"- StartMany waits for all unit files to be generated before attempting Start operations\n- StopMany waits for all unit files to be generated before attempting Stop operations\n- Unit generation verification uses exponential backoff with timeout\n- Test coverage for both methods ensuring wait behavior works correctly","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T23:51:24.385096237-05:00","updated_at":"2025-11-09T23:52:51.86703109-05:00","closed_at":"2025-11-09T23:52:51.86703109-05:00","source_repo":".","labels":["bug","critical","systemd"],"dependencies":[{"issue_id":"quad-ops-0e2","depends_on_id":"quad-ops-5f0","type":"blocks","created_at":"2025-11-09T23:51:24.392398243-05:00","created_by":"daemon"}]}
{"id":"quad-ops-0n3","content_hash":"3e32bb1f15233b2a19e0cbc8a28af2878cb52bc2cdfb062e61e554bb3e0469f3","title":"Step 5: Consolidate helpers and remove legacy tests","description":"Clean up systemd renderer: consolidate helpers and remove redundant tests.\n\n**Goals:**\n- Consolidate helper utilities (formatDependency, collectBindMountPaths, etc.)\n- Remove redundant scenario-based tests replaced by golden tests\n- Merge bind-mount assertions into table-driven test cases\n- Ensure coverage maintained or improved\n\n**Files affected:**\n- internal/platform/systemd/renderer_test.go (cleanup)\n- internal/platform/systemd/bind_mounts_test.go (merge or remove)\n- internal/platform/systemd/tmpfs_test.go (merge or remove)\n- internal/platform/systemd/sysctls_test.go (merge or remove)\n- internal/platform/systemd/network_online_test.go (merge or remove)","acceptance_criteria":"✅ Redundant scenario-based tests removed or merged into golden tests\n✅ Test coverage maintained or improved (compare to baseline_coverage.out)\n✅ go test ./internal/platform/systemd/... passes\n✅ task lint passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T12:31:27.732371-05:00","updated_at":"2025-11-11T16:15:17.595128-05:00","closed_at":"2025-11-11T16:15:17.595128-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-0n3","depends_on_id":"quad-ops-447","type":"blocks","created_at":"2025-11-11T12:31:27.733711-05:00","created_by":"daemon"}]}
{"id":"quad-ops-0pl","content_hash":"226b0a2035a079fdd5eb8fc0a75e98b933938d8500477bbe464f44c7714805c0","title":"Update architecture documentation for current implementation","description":"The architecture.md file describes macOS launchd support as 'planned' but the codebase shows some macOS support is implemented. Update the documentation to reflect the current cross-platform capabilities and clarify what is implemented vs planned.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T23:24:07.694421836-05:00","updated_at":"2025-11-06T23:24:07.694421836-05:00","source_repo":".","labels":["architecture","cross-platform","documentation"],"dependencies":[{"issue_id":"quad-ops-0pl","depends_on_id":"quad-ops-79g","type":"blocks","created_at":"2025-11-06T23:24:07.702746683-05:00","created_by":"daemon"}]}
{"id":"quad-ops-0r1","content_hash":"c4b9493536799618889b25776f15647ad0c57b337e2b512ef564784c0b232daf","title":"Fix network prefixing: external networks incorrectly project-scoped","description":"Containers are declaring dependencies on non-existent network units with incorrect project prefixes.\n\n**Error examples:**\n```\nquadlet-generator: converting \\\"dozzle-web.container\\\": unable to translate dependency for dozzle-infrastructure-proxy.network\nquadlet-generator: converting \\\"llm-ollama.container\\\": unable to translate dependency for llm-infrastructure-proxy.network\n```\n\n**Root cause:** The `convertNetworkMode` function in spec_converter.go incorrectly prefixes external/shared networks that should NOT be prefixed.\n\n**Expected behavior:** \n- Services from different projects (dozzle, llm, scrutiny, beszel) should share a single `infrastructure-proxy.network`\n- References should NOT include project prefix for external networks\n- Current code prefixes all networks with project name when it shouldn't\n\n**Investigation needed:**\n1. Check compose files for unprefixed network declarations\n2. Review `convertNetworkMode` logic for when to apply project prefix\n3. Determine if external/shared networks need different handling\n4. Add validation to catch this during spec conversion\n\n**Effect:** Quadlet generator fails because containers reference non-existent network units like `dozzle-infrastructure-proxy.network` instead of `infrastructure-proxy.network`\n\n**Part of:** https://github.com/trly/quad-ops/discussions/52 (Quadlet generator analysis)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T12:22:21.907487354-05:00","updated_at":"2025-11-09T12:22:48.476106902-05:00","closed_at":"2025-11-09T12:22:48.476106902-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-0r1","depends_on_id":"quad-ops-1sn","type":"blocks","created_at":"2025-11-09T12:22:21.908291674-05:00","created_by":"daemon"},{"issue_id":"quad-ops-0r1","depends_on_id":"quad-ops-712","type":"related","created_at":"2025-11-09T12:22:25.12696974-05:00","created_by":"daemon"}]}
{"id":"quad-ops-0rf","content_hash":"b3dd0ea21cf99ede6eb2485f57168da24999f23be1ed933b44a0ff9bc919b727","title":"Update command reference documentation","description":"The command-reference/_index.md and individual command docs need updates:\n- Remove references to non-existent commands (like 'deps')\n- Update sync.md to use correct config field names ('ref' not 'target', no 'cleanup' section)\n- Ensure all actual commands are documented with correct options\n- Add missing command documentation for newer commands\n- Update global options to match current implementation","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T23:24:12.507417051-05:00","updated_at":"2025-11-06T23:24:12.507417051-05:00","source_repo":".","labels":["cli","commands","documentation"],"dependencies":[{"issue_id":"quad-ops-0rf","depends_on_id":"quad-ops-79g","type":"blocks","created_at":"2025-11-06T23:24:12.510679623-05:00","created_by":"daemon"}]}
{"id":"quad-ops-0sd","content_hash":"a4521aa6baecf299f187aa9e3e57608e252b28aa3e8df5896b4f9b4ae5b597b7","title":"Measure systemd renderer current line count vs 1200-line target","description":"**Progress assessment needed:** Don't know current state vs full-pipeline-simplification.md target.\n\n**Unknown:**\n- Current line count in internal/platform/systemd/*.go\n- Whether intermediate Unit/Processor models still exist\n- Progress toward 1200-line target (from 5345)\n- Which specific files/abstractions to remove\n\n**Deliverables:**\n1. Count current lines in systemd package (excluding tests)\n2. Identify remaining intermediate abstractions (Unit, Processor models)\n3. Compare against simplification plan structure (~1200 lines target)\n4. Document gap analysis: what still needs simplification\n5. File issues for remaining simplification work\n\n**Commands:**\n```bash\n# Count non-test code\nfind internal/platform/systemd -name '*.go' ! -name '*_test.go' -exec wc -l {} + | tail -1\n\n# Check for intermediate models\ngrep -r \"type Unit struct\" internal/platform/systemd/\ngrep -r \"type Processor\" internal/platform/systemd/\n```\n\n**Reference:** full-pipeline-simplification.md target ~1200 lines for systemd renderer","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-11T17:05:30.831378-05:00","updated_at":"2025-11-11T19:49:48.171003-05:00","closed_at":"2025-11-11T19:49:48.171003-05:00","source_repo":"."}
{"id":"quad-ops-0t8","content_hash":"d14f417fe70eb7d6790d76e55e7e63c60701b392975192b1d3c07583ebba7135","title":"Fix linter errors: 3 gocyclo, 3 revive stuttering","description":"Linter failing with 6 issues that must be fixed:\n\n**gocyclo (3 issues):**\n- internal/compose/convert.go:137 - convertContainer has complexity 65 (limit 30)\n- internal/compose/convert.go:910 - convertInitContainers has complexity 45 (limit 30)\n- internal/platform/systemd/renderer.go:233 - writeContainerSection has complexity 66 (limit 30)\n\n**revive (3 issues - stuttering):**\n- internal/validate/security.go:267 - ValidateUnitName → rename to UnitName\n- internal/validate/security.go:289 - ValidatePath → rename to Path\n- internal/validate/security.go:312 - ValidatePathWithinBase → rename to PathWithinBase\n\nAll must be fixed for task build to pass.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-11T18:53:36.120302-05:00","updated_at":"2025-11-11T19:23:18.674095-05:00","closed_at":"2025-11-11T19:23:18.674095-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-0t8","depends_on_id":"quad-ops-7","type":"discovered-from","created_at":"2025-11-11T18:53:36.121604-05:00","created_by":"daemon"}]}
{"id":"quad-ops-1","content_hash":"c74e2c3f31ed56b12b6657bd437b42a3c27781c98ceb5dca85afe2101e465260","title":"Phase 1: Compose simplification - Write comprehensive convert_test.go with table-driven tests","description":"Write comprehensive table-driven tests for the consolidated compose converter.\n\n**Scope:** Rewrite convert_test.go to exercise the simplified converter API with focused methods for each concern.\n\n**Test coverage for converter methods:**\n- ConvertProject - Main entry point (types.Project → []service.Spec)\n- Container fields conversion (image, command, env, labels)\n- Network handling (bridge, host, custom, external)\n- Volume handling (bind, named, tmpfs)\n- Resource constraints (memory, cpu shares/quota/period)\n- Mount types (volumes, configs, secrets)\n- Build config (context, dockerfile, args)\n- Environment variables and files\n- Ports, logging, DNS, ulimits, dependencies\n- Swarm rejection validation\n\n**Tests use table-driven pattern:**\n- Input → expected output validation (not testing internal implementation)\n- Each test case: {name, input, expected output, optional error}\n- Tests serve as documentation of converter behavior","acceptance_criteria":"✅ Table-driven test suites cover all converter methods\n✅ Test cases include: basic conversion, port mappings, volumes, env vars, networks, resources, security, restart, healthchecks, dependencies, labels, Swarm rejection\n✅ Edge cases tested: empty specs, invalid inputs, external networks/volumes\n✅ All tests pass: go test ./internal/compose/...\n✅ Coverage maintained or improved vs. current convert_test.go\n✅ Tests validate behavior (input→output), not internal method calls","notes":"**NO BACKWARD COMPATIBILITY REQUIRED**: Test refactoring to match simplified API from quad-ops-2. Internal test structure changes are acceptable.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:29:30.101061378-05:00","updated_at":"2025-11-11T16:53:24.238586-05:00","closed_at":"2025-11-11T16:53:24.238586-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-1","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.896153139-05:00","created_by":"daemon"},{"issue_id":"quad-ops-1","depends_on_id":"quad-ops-2","type":"blocks","created_at":"2025-11-11T02:00:16.873489104-05:00","created_by":"daemon"}]}
{"id":"quad-ops-167","content_hash":"47f65c8291407fdc2ac06429af96926436258a9c60537618a2cd311a591e53b5","title":"Missing Compose feature: devices mapping","description":"v0.21.2 supported device mappings via PodmanArgs. Current spec_converter doesn't convert devices from compose services.","design":"Add Container.Devices field in models.go. Convert service.Devices in spec_converter. Render via PodmanArgs (--device) in systemd renderer.","acceptance_criteria":"- devices in compose convert to container fields\n- Rendered as PodmanArgs with --device flags\n- Test coverage for devices conversion","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T13:44:34.781104-05:00","updated_at":"2025-11-09T15:40:37.774452-05:00","closed_at":"2025-11-09T15:40:37.774452-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-167","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.78157-05:00","created_by":"daemon"}]}
{"id":"quad-ops-16l","content_hash":"2071ed4f4d3e29053f9e8420ffa85a5a10e1d3b81ebf4eb794ebdb3281bc8556","title":"Implement rootlessport cleanup for orphaned processes causing port binding conflicts","description":"Fixed port binding conflicts caused by orphaned rootlessport processes from failed podman container starts. Implemented cleanup that runs before service operations and after failures.\n\nChanges made:\n- Added cleanupOrphanedRootlessportProcesses() function using pgrep to find and kill orphaned processes\n- Enhanced error logging in waitForActivation to show detailed systemd failure reasons\n- Modified StartMany/RestartMany to run cleanup after any service failures\n- Added comprehensive PID validation and safe process termination\n\nThis resolves the \"bind: address already in use\" errors that occurred when services failed to start previously.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-07T00:39:23.65195325-05:00","updated_at":"2025-11-07T00:39:25.904195201-05:00","closed_at":"2025-11-07T00:39:25.904195201-05:00","source_repo":".","labels":["lifecycle","port-binding","rootlessport","systemd"]}
{"id":"quad-ops-19f","content_hash":"b6b0c1e977ea791373e4a25180917afd24a1194349bb8b1c368ec2d9bfbc81a7","title":"External networks must be pre-created or declared in a project","description":"When services from multiple projects reference the same external network (e.g., infrastructure-proxy), the network is marked as External in all projects that reference it. This means none of the projects create the .network unit file. \n\nThe quadlet-generator then fails with \"unable to translate dependency\" errors because the referenced .network unit doesn't exist.\n\nThis is a design issue: external networks need to either:\n1. Be created by an infrastructure project that doesn't mark them as external\n2. Be pre-created manually with podman network create\n3. Have a bootstrap/initialization mechanism\n\nCurrently users get confusing quadlet-generator errors with no clear guidance on resolution.","notes":"Fixed the root cause: when containers use external networks, systemd was trying to add Requires= dependencies on those networks. Since external networks are not created by quad-ops (they're assumed to be pre-created/managed externally), this causes quadlet-generator to fail with \"unable to translate dependency\" errors.\n\nSolution: Modified systemd renderer to only add Requires= for non-external networks. External networks still get After= directives for ordering, but no hard Requires dependency.\n\nChanges made:\n1. internal/platform/systemd/renderer.go - Modified network dependency rendering to check if network is external\n2. internal/platform/systemd/renderer_test.go - Updated tests to reflect new behavior\n\nTests updated:\n- TestRenderer_ExternalNetworks_ContainerUsesExternalNetwork (new test)\n- TestRenderer_ExternalNetworksWithLocalNetworks (updated assertion)\n- TestRenderer_CrossProjectNetworkDependencies_NameMismatch (updated assertion)\n- TestRenderer_NetworkUnderscoreSanitization (updated assertion)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-10T01:08:54.552969686-05:00","updated_at":"2025-11-10T01:27:06.8016652-05:00","closed_at":"2025-11-10T01:27:06.8016652-05:00","source_repo":"."}
{"id":"quad-ops-1bz","content_hash":"a404357b7680c04ca26422e1e4f0f32c586ebdc54e3f275fadd0bef427fe56ee","title":"builds are not happening on every commit","description":"","design":"Current state:\n- build.yml has artifact upload gated to tags only (line 84: `if: startsWith(github.ref, 'refs/tags/')`)\n- This prevents artifacts from being saved on regular commits\n- release.yaml cannot access previously-built artifacts on tags\n\nDesired state:\n- build.yml builds and saves artifacts on every commit\n- release.yaml on tag triggers, uses cached/saved artifacts instead of rebuilding\n\nSolution:\n- Remove the conditional on artifact upload\n- Upload artifacts with retention across all builds\n- Let release.yaml depend on those artifacts being available","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-08T21:49:37.458463045-05:00","updated_at":"2025-11-08T22:08:03.7504637-05:00","closed_at":"2025-11-08T22:08:03.7504637-05:00","source_repo":"."}
{"id":"quad-ops-1hk","content_hash":"63bbe852762170e6a881187ce91b92e354e3b75283adc180f8376d2e712203d3","title":"Update release.yaml to use pre-built artifacts instead of rebuilding","description":"Modify release.yaml to download and reuse artifacts from the build workflow instead of running GoReleaser to rebuild. This avoids redundant builds when a tag is pushed.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-08T21:51:04.598015666-05:00","updated_at":"2025-11-08T22:08:03.714113485-05:00","closed_at":"2025-11-08T22:08:03.714113485-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-1hk","depends_on_id":"quad-ops-1bz","type":"discovered-from","created_at":"2025-11-08T21:51:04.602109397-05:00","created_by":"daemon"}]}
{"id":"quad-ops-1i5","content_hash":"36a751f2c90209c0180f70b92b153be9ca4dd78c8e0e5ff0abb127d1c922b672","title":"Test: launchd platform network handling","description":"Add tests for launchd renderer with external networks to ensure cross-platform consistency.\n\nCurrently launchd platform is not well-tested for network scenarios. Need to verify:\n- External networks are handled correctly in plist generation\n- Network dependencies are represented correctly in launchd format\n- Service startup order respects external network dependencies\n\nThis ensures the network prefixing fix works consistently across both systemd (Linux) and launchd (macOS) platforms.","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-09T12:32:26.443583299-05:00","updated_at":"2025-11-09T12:32:26.443583299-05:00","source_repo":"."}
{"id":"quad-ops-1n4","content_hash":"550ecd4dcbd0144c3080efad1df6d2332485312825ecf6b42a1c554b666ee795","title":"examples do not deploy","description":"The example configs do not deploy. Investigate if this is an issue with the current state of quad-ops, or a problem with the example compose files\n","acceptance_criteria":"./quad-ops -u up should start up example services","notes":"## Investigation Results\n\n**Root Cause Identified**: Services were failing to start with \"Unit \u003cservice\u003e.service not found\" because of a naming mismatch between volume/network references in container files and the actual volume/network unit file names.\n\n### The Problem\n- Quad-ops was generating volume/network unit files with names like `init-containers-init-containers_shared-data.volume` (double-prefixed)\n- But container files referenced volumes as `shared-data.volume` \n- The podman-systemd-generator failed to process containers that referenced missing volume units\n\n### The Fix\nModified the spec converter to avoid double-prefixing resource names:\n\n1. **convertProjectVolumes/Networks**: Only apply project prefix if the name doesn't already contain the project name (prevents double-prefixing when reader already prefixed)\n\n2. **convertVolumeMounts**: Prefix mount sources with `project_` to match the volume names set by the reader\n\n### Current Status\n- ✅ Services are now recognized by systemd (no more \"Unit not found\" errors)\n- ✅ Volume and network references are consistent\n- ⚠️ Services now fail with legitimate errors instead of discovery failures\n- Current failures are due to:\n  - Init container failures preventing dependent services from starting\n  - Podman image resolution issues (unqualified image names require registries.conf configuration)\n\n### Additional Issues Found\n**Image Registry Configuration**: Quad-ops uses unqualified image names from compose files (e.g., `nginx:alpine`), but podman requires unqualified-search registries to be configured in `/etc/containers/registries.conf`.\n\n**Work Needed**:\n1. ✅ **Fixed**: Volume/network naming consistency \n2. **Optional**: Update quad-ops to use fully qualified image names or document registry requirements\n\nThe core systemd integration issue is resolved. Services can now be discovered and managed by systemd.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-06T21:30:19.502511756-05:00","updated_at":"2025-11-06T23:39:43.908874797-05:00","closed_at":"2025-11-06T23:39:37.254202295-05:00","source_repo":"."}
{"id":"quad-ops-1qw","content_hash":"3655d4b7d4ba8387ac9be9aca97fa6c74f75a1ad6644851bb798b5dc6669618f","title":"Fix documentation navigation and missing sections","description":"The docs index references sections that don't exist or have wrong filenames:\n- 'Getting Started' links to 'getting-started' but file is 'quick-start.md'\n- 'Podman-systemd (Quadlet)' section doesn't exist\n- 'Release Notes' section doesn't exist\n- Fix broken internal links and ensure navigation is consistent","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T23:24:05.749177758-05:00","updated_at":"2025-11-06T23:24:05.749177758-05:00","source_repo":".","labels":["documentation","navigation","site"],"dependencies":[{"issue_id":"quad-ops-1qw","depends_on_id":"quad-ops-79g","type":"blocks","created_at":"2025-11-06T23:24:05.758314474-05:00","created_by":"daemon"}]}
{"id":"quad-ops-1sn","content_hash":"007ddfb2691c756717ee1b51bca8e70e0dd63f4a6e94778698829da48a024a8a","title":"Investigate: containers referencing non-existent network units","description":"Containers are declaring dependencies on non-existent network units with incorrect project prefixes.\n\n**Error examples:**\n```\nquadlet-generator: converting \"dozzle-web.container\": unable to translate dependency for dozzle-infrastructure-proxy.network\nquadlet-generator: converting \"llm-ollama.container\": unable to translate dependency for llm-infrastructure-proxy.network\nquadlet-generator: converting \"llm-open-webui.container\": unable to translate dependency for llm-infrastructure-proxy.network\nquadlet-generator: converting \"scrutiny-web.container\": unable to translate dependency for scrutiny-infrastructure-proxy.network\nquadlet-generator: converting \"beszel-hub.container\": unable to translate dependency for beszel-infrastructure-proxy.network\n```\n\n**Root cause:** The `convertNetworkMode` function in spec_converter.go incorrectly prefixes external/shared networks that should NOT be prefixed.\n\n**Expected behavior:** \n- Services from different projects (dozzle, llm, scrutiny, beszel) should share a single `infrastructure-proxy.network`\n- References should NOT include project prefix for external networks\n- Current code prefixes all networks with project name when it shouldn't\n\n**Investigation needed:**\n1. Check compose files for unprefixed network declarations\n2. Review `convertNetworkMode` logic for when to apply project prefix\n3. Determine if external/shared networks need different handling\n4. Add validation to catch this during spec conversion\n\n**Effect:** Quadlet generator fails because containers reference non-existent network units like `dozzle-infrastructure-proxy.network` instead of `infrastructure-proxy.network`\n\n**Part of:** https://github.com/trly/quad-ops/discussions/52 (Quadlet generator analysis)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-09T12:20:44.125213196-05:00","updated_at":"2025-11-09T12:31:51.930354054-05:00","closed_at":"2025-11-09T12:31:51.930354054-05:00","source_repo":"."}
{"id":"quad-ops-1vw","content_hash":"6a1d79c3a74969666742c6ae65d87f219161506f6521f11f8bfc0aa4d9f71fff","title":"Restore Linux build units functionality","description":"The systemd platform should properly render .build unit files for container build configurations. Currently build specs are not rendered as separate units.\n\nNeed to:\n- Ensure renderService creates separate artifacts for build specs in spec.Container.Build\n- Implement proper Quadlet build unit rendering with build arguments, contexts, and all options\n- Add build dependencies to container units (After/Requires)\n- Test that build units are created and execute properly\n\nThis restores the Linux-specific build management that was lost in the cross-platform abstraction.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-06T21:39:31.468441203-05:00","updated_at":"2025-11-06T22:03:01.009086528-05:00","closed_at":"2025-11-06T22:03:01.009086528-05:00","source_repo":".","labels":["build","linux","platform-specific","quadlet"]}
{"id":"quad-ops-1wy","content_hash":"b13875afc5c6fd266cc7240de9511950337b9f35fc9f67aef68f7e23808869c3","title":"Init containers lost volumes/networks/env - only support image/command","description":"convertInitContainers only supports image/command, drops volumes/networks/env. Old behavior likely executed init with the same mounts/networks as main service for DB migrations, etc.","design":"At minimum, allow init containers to share the main service's mounts and env (or accept optional mounts/env in x-quad-ops-init) so they can perform meaningful initialization. Keep Linux-only restriction.","acceptance_criteria":"- Init containers can mount volumes for migrations\n- Init containers share network with main service\n- Init containers can access environment variables","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T13:44:34.759598-05:00","updated_at":"2025-11-09T15:16:32.262469-05:00","closed_at":"2025-11-09T15:16:32.262469-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-1wy","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.760358-05:00","created_by":"daemon"}]}
{"id":"quad-ops-2","content_hash":"1f9095b55b2d92570c9db00dfd393d993bf6770e6f2647b04511ac0d19c438f5","title":"Phase 1: Consolidate spec_converter.go (26→12 methods), merge helpers, delete unused interfaces","description":"Consolidate spec_converter.go from 37 methods → 12 focused methods organized by concern. Merge helpers inline, delete unused abstractions.\n\nCurrent state (does not match design):\n- spec_converter.go: 1383 lines, 37 methods → should be convert.go ≤320 lines, 12 methods\n- helpers.go: 109 lines → merge inline (delete file)\n- interfaces.go: 29 lines unused → delete\n- processor.go: 32 lines thin wrapper → delete (logic moves to ConvertProject)\n- reader.go: 306 lines → simplify to ≤40 lines (only ReadProjects + project loading)\n\nDeliverables:\n- Rename spec_converter.go → convert.go\n- Consolidate 37 methods → 12 methods (see design section for mapping)\n- Direct spec.Spec field assignment (no intermediate models)\n- Delete helpers.go, interfaces.go, processor.go\n- Simplify reader.go to core project loading only\n\nFiles to delete:\n- internal/compose/helpers.go\n- internal/compose/interfaces.go  \n- internal/compose/processor.go\n- internal/compose/namespace_modes.go (if exists)\n- internal/compose/volume_dependencies.go (if exists)\n- internal/compose/network_dependencies.go (if exists)\n- internal/compose/sysctls.go (if exists)\n\nReference: history/QUICK_REFERENCE.md Section 1 and history/full-pipeline-simplification.md Phase 1","design":"## Method Consolidation Target (37 → 12)\n\nCurrent 37 methods should consolidate to ~12 focused methods:\n\n```go\n// Public entry point\n1. ConvertProject(project) → []Spec\n\n// High-level conversion (4 methods)\n2. convertService(name, svc, project) → []Spec\n3. convertContainer(svc, name, project) → Container\n4. convertNetworks(project) → []Network  // Consolidates: convertProjectNetworks, convertServiceNetworks, convertServiceNetworksList, convertProjectNetworks, convertIPAM\n5. convertVolumes(project) → []Volume  // Consolidates: convertProjectVolumes, convertServiceVolumes\n\n// Resource \u0026 deployment (3 methods)\n6. convertResources(deploy, svc) → Resources  // Consolidates: convertResources, convertCPU, convertCPUShares\n7. convertMounts(volumes, configs, secrets, project) → []Mount  // Consolidates: convertVolumeMounts, convertConfigMounts, convertSecretMounts, convertInitVolumeMounts, convertFileObjectToMount\n8. convertBuild(build, svc, project) → *Build  // Consolidates: convertBuild, convertBuildArgs\n\n// Configuration (3 methods)\n9. convertEnvironment(env, envFiles) → (map[string]string, []string)  // Consolidates: convertEnvironment, convertEnvFiles, convertEnvSecrets\n10. convertMisc(svc, project) → (*Misc)  // Consolidates: convertPorts, convertLogging, convertTmpfs, convertExtraHosts, convertUlimits, convertDependencies, convertNetworkMode, convertInitContainers, etc.\n\n// Validation \u0026 helpers (2 internal methods)\n11. validateProject(project) error\n12. ensureProjectTempDir(...) string\n```\n\n## File Structure Target (15 files → 2 files)\n\n```\ninternal/compose/\n├── convert.go          (~320 lines)\n│   ├── Converter struct\n│   ├── 12 focused methods\n│   ├── NO intermediate models\n│   └── Direct field assignment\n│\n├── reader.go           (~30 lines)\n│   ├── ReadProjects()\n│   └── Project loading only\n│\n└── convert_test.go     (keep existing - test structure is correct)\n```\n\nDELETE:\n- helpers.go (merge inline into methods)\n- interfaces.go (unused)\n- processor.go (thin wrapper, logic goes to convert.go)\n- All other helper files (namespace_modes, volume_dependencies, network_dependencies, sysctls, etc.)\n\nCONSOLIDATE TESTS:\n- convert_test.go should test all 12 consolidated methods\n- Validate each method produces correct Spec/Container/Resource output\n- Table-driven tests for edge cases\"","acceptance_criteria":"- spec_converter.go: 37 → 12 methods, ≤320 lines\n- helpers.go merged inline (delete file)\n- interfaces.go deleted (unused)\n- processor.go deleted (logic merged into ConvertProject)\n- reader.go simplified to ~30 lines (only ReadProjects)\n- Total lines: 7,470 → 350 (internal/compose only)\n- All tests in convert_test.go pass (existing table-driven tests may need updates)\n- Golden tests pass (byte-for-byte equivalent output)\n- No public API changes\n- No reduction in test coverage\"","notes":"**Progress Update:**\n\n✅ **Step 1 Complete**: Mount consolidation (4 methods → 1)\n- Created unified `convertMounts()` method handling volumes, configs, and secrets\n- Added helper `convertVolumeMount()` to reduce cyclomatic complexity\n- Updated `convertContainer()` and init containers to use consolidated method\n- Deleted 4 old mount methods: convertVolumeMounts, convertConfigMounts, convertSecretMounts, convertInitVolumeMounts\n\n✅ **Step 2 Complete**: Delete obsolete test files\n- Deleted convert_test.go, spec_converter_configs_test.go\n\n✅ **Step 3 Complete**: Network/volume consolidation (5 methods → 2)\n- Created `convertNetworksForService()` consolidating 3 network methods\n- Created `convertVolumesForService()` consolidating 2 volume methods  \n- Deleted 5 old methods: convertServiceNetworks, convertServiceNetworksList, convertProjectNetworks, convertServiceVolumes, convertProjectVolumes\n- Deleted internal tests: TestSpecConverter_ConvertProjectVolumes, TestSpecConverter_ConvertProjectNetworks\n\n✅ **Step 4 Complete**: Inline misc conversions into convertContainer\n- Inlined DNS conversion (convertDNS, convertDNSSearch, convertDNSOpts)\n- Inlined convertExtraHosts, convertTmpfs, convertDevices, convertDeviceCgroupRules\n- Deleted 7 methods that became inline code in convertContainer\n- Updated tests accordingly\n\n✅ **Step 5 Complete**: Inline simple type converters\n- Inlined convertEnvironment into convertContainer (env map conversion)\n- Inlined convertDuration calls (direct time.Duration casting)\n- Inlined convertDependencies into convertService (simple append+sort)\n- Replaced convertLabels with package-level copyStringMap() helper (used in 5 places)\n- Deleted 3 methods, added 1 reusable package-level helper\n\n✅ **Step 6 Complete**: Group related converters\n- Consolidated convertEnvSecrets + convertExternalSecrets → convertSecrets()\n- Inlined 5 simple converters into convertContainer: convertRestartPolicy, convertHealthcheck, convertLogging, convertNetworkMode, convertUlimits\n- Deleted 3 unit tests that tested now-inlined implementation details\n- Reduced from 31 methods to 26 methods (5 methods eliminated)\n\n✅ **Step 7 Complete**: Move helpers to package-level, inline trivial methods\n- Moved getStringFromMap, getMapFromMap, getStringSliceFromMap to package-level functions\n- Moved formatBytes to package-level function (used in 2 places)\n- Inlined convertBuildArgs into convertBuild\n- Updated tests to use package-level formatBytes\n- Reduced from 26 methods to 21 methods (5 methods eliminated)\n\n✅ **Step 8 Complete**: Replace custom helpers with stdlib\n- Replaced copyStringMap with stdlib `maps.Clone()`\n- Replaced internal/sorting.SortStringSlice with stdlib `sort.Strings()` (8 call sites)\n- Deleted NameResolver helper, inlined 7 usages with simple if-else pattern\n- Inlined get*FromMap helpers at call sites in convertInitContainers (4 usages)\n- Optimized SanitizeProjectName: precompiled regexes at package scope\n- Eliminated dependency on internal/sorting package\n\n**Current State**: 50 methods → 21 methods (target: 12-15)\n\n**Methods Remaining** (21 total):\n1. ConvertProject (public API)\n2. convertService\n3. convertContainer\n4. convertEnvFiles\n5. convertPorts\n6. convertMounts\n7. convertVolumeMount\n8. convertResources\n9. convertCPU\n10. convertCPUShares\n11. convertSecurity\n12. convertBuild\n13. convertVolumesForService\n14. convertNetworksForService\n15. convertIPAM\n16. convertInitContainers\n17. validateProject\n18. ensureProjectTempDir\n19. writeTempFile\n20. convertFileObjectToMount\n21. convertSecrets\n\n**Package-level helpers** (2 total):\n- copyStringMap (uses stdlib maps.Clone)\n- formatBytes\n\n**Next Steps** (to reach 12-15 methods target):\n- Inline convertCPU + convertCPUShares into convertResources (2 methods → 0)\n- Consider consolidating ensureProjectTempDir + writeTempFile + convertFileObjectToMount (3 methods → 1)\n- Potentially consolidate convertEnvFiles inline if trivial\n\n**All tests passing**: All golden tests, unit tests, and integration tests pass with no regressions\n\n**Stdlib alignment improvements**:\n- ✅ Using stdlib maps.Clone instead of custom copy\n- ✅ Using stdlib sort.Strings instead of internal helper\n- ✅ Removed dependency on internal/sorting package\n- ✅ Optimized regex compilation in helpers","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:29:30.101972589-05:00","updated_at":"2025-11-11T12:09:43.613271-05:00","closed_at":"2025-11-11T12:09:43.613271-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-2","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.907782837-05:00","created_by":"daemon"}]}
{"id":"quad-ops-22e","content_hash":"d24d4efad4b94c92cc646ddf56fa297f950a50a74221b9276f585a5f25f986c2","title":"Race condition: systemd generator not finished when services are restarted","description":"Services fail to restart after sync with error: \"Unit llm-open-webui.service not found\"\n\nThe `.container` files ARE written to `/etc/containers/systemd/`, but when quad-ops tries to restart the services immediately after calling `daemon-reload`, systemd reports the units don't exist.\n\n## Root Cause\nThe D-Bus `Reload()` call in lifecycle.go is asynchronous and doesn't wait for the systemd Quadlet generator to finish processing the new `.container` files. The sequence is:\n\n1. ✅ Write .container files to /etc/containers/systemd/\n2. ⚠️ Call Lifecycle.Reload() (async - returns immediately)\n3. ❌ Call Lifecycle.RestartMany() (tries to restart, but .service units haven't been generated yet)\n\nThe systemd Quadlet generator runs during daemon-reload but may not finish before the restart attempts.\n\n## Evidence\n- Files ARE written: `llm-ollama.container`, `llm-open-webui.container` visible in /etc/containers/systemd/\n- But systemd says units don't exist when RestartMany() tries to restart them\n- Timestamps show files were written at the same time as the error\n\n## Impact\nServices fail to restart after sync/up operations, even though artifacts were written successfully. This is intermittent/timing-dependent.","acceptance_criteria":"Implement proper synchronization between Reload() and unit availability:\n1. Add wait/poll mechanism after Reload() to ensure units are generated\n2. Implement unit existence check with retry + exponential backoff\n3. Fail with clear diagnostic if units don't appear\n4. Add timeout configuration\n\nWrite tests that verify units exist after reload before restart.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-08T21:16:25.268423351-05:00","updated_at":"2025-11-08T21:29:24.633407016-05:00","closed_at":"2025-11-08T21:29:24.633407016-05:00","source_repo":".","labels":["bug","quadlet","race-condition","systemd"]}
{"id":"quad-ops-22x","content_hash":"825a9868ace8d657019362b26cabc5c98c3c9b43847d547ce737e7ef9fede63a","title":"Fix external network dependency translation in Quadlet generator","description":"Quadlet generator fails to translate external network dependencies because the spec converter incorrectly applies the current project's prefix to external networks.\n\nError: \"unable to translate dependency for infrastructure-proxy.network\"\n\nThis is a regression from commit 297a310 (macOS refactor). External networks from other projects (e.g., infrastructure-proxy from the infrastructure project) get the wrong prefix added, causing systemd unit references to non-existent units.","design":"**Root cause location:** `internal/compose/spec_converter.go` in `convertServiceNetworksList` function\n\n**Current buggy behavior:**\n- Compose file declares: `infrastructure-proxy` (external network from infrastructure project)\n- Code applies wrong prefix: `llm-infrastructure-proxy` (adds current project prefix)\n- Actual network unit: `infrastructure-proxy.network`\n- Result: systemd references non-existent `llm-infrastructure-proxy.network`\n\n**Fix:**\nFor external networks, use the network name as-is without applying the current project's prefix. The network name already encodes the source project context.\n\n**Code change:**\nRemove the `Prefix(project.Name, networkName)` call for external networks. Use `service.SanitizeName(networkName)` directly instead.","acceptance_criteria":"- Quadlet generator successfully translates external network dependencies without errors\n- External networks from other projects (e.g., infrastructure-proxy) are referenced with correct unit names\n- No \"unable to translate dependency\" errors in generator output\n- Existing network dependency tests still pass","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T23:58:43.791520656-05:00","updated_at":"2025-11-10T00:03:11.413541482-05:00","closed_at":"2025-11-10T00:03:11.413541482-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-22x","depends_on_id":"quad-ops-0r1","type":"related","created_at":"2025-11-09T23:59:06.746994654-05:00","created_by":"daemon"},{"issue_id":"quad-ops-22x","depends_on_id":"quad-ops-712","type":"related","created_at":"2025-11-09T23:59:46.58770181-05:00","created_by":"daemon"},{"issue_id":"quad-ops-22x","depends_on_id":"quad-ops-1sn","type":"related","created_at":"2025-11-09T23:59:46.593987913-05:00","created_by":"daemon"},{"issue_id":"quad-ops-22x","depends_on_id":"quad-ops-1i5","type":"related","created_at":"2025-11-09T23:59:46.599500993-05:00","created_by":"daemon"}]}
{"id":"quad-ops-24q","content_hash":"eb0f0c3569e29638051e86e2017db9f929ad3e670be28d18755bd6d7dc71d49b","title":"Memory and CPU resource constraints not rendered to unit files","description":"Memory and CPU resource constraints from Docker Compose are silently dropped during rendering.\n\nThe Container struct has Resources field with Memory, MemoryReservation, MemorySwap, CPUShares, CPUQuota, CPUPeriod, but the systemd renderer never outputs these to the unit file.\n\nAffected directives:\n- Memory= (from Container.Resources.Memory)\n- MemoryReservation= (from Container.Resources.MemoryReservation)\n- MemorySwap= (from Container.Resources.MemorySwap)\n- CPUShares, CPUQuota, CPUPeriod (need research on Quadlet mapping)\n\nResult: Container resource limits are silently lost during conversion from Docker Compose to systemd units.","acceptance_criteria":"Write tests first. Implement rendering of Memory, MemoryReservation, MemorySwap directives. Research and document CPU constraint mapping (may need PodmanArgs or additional Quadlet fields).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-08T21:09:03.008884345-05:00","updated_at":"2025-11-08T21:40:01.08546212-05:00","closed_at":"2025-11-08T21:40:01.08546212-05:00","source_repo":".","labels":["bug","compatibility","quadlet"]}
{"id":"quad-ops-26t","content_hash":"743f4ae42fb959e741c60dbd7046afe99f9d30142df09a248d99b00ad562fc02","title":"Add dependency metadata fields to launchd plist structure","description":"internal/platform/launchd/plist.go: The plist Service struct lacks dependency metadata fields needed to support ordered service startup/shutdown.\n\nLaunchd uses plist property lists for service definitions but currently doesn't include dependency information. Need to add fields comparable to systemd's After and Requires directives.\n\nThis is prerequisite work for properly implementing dependency-aware lifecycle management in launchd, matching systemd's capabilities.\n\nAnalysis: See history/quad-ops-9y2-improve-cross-platform-dependency-management.md for detailed improvement plan.","acceptance_criteria":"plist.Service struct includes DependsOn or similar field for service dependencies, enabling launchd renderer to generate dependency information in plist files","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:01:22.081088495-05:00","updated_at":"2025-11-08T18:00:10.461366246-05:00","closed_at":"2025-11-08T18:00:10.461366246-05:00","source_repo":".","labels":["dependencies","launchd","platform-specific"],"dependencies":[{"issue_id":"quad-ops-26t","depends_on_id":"quad-ops-w84","type":"related","created_at":"2025-11-08T16:01:33.113311703-05:00","created_by":"daemon"}]}
{"id":"quad-ops-274","content_hash":"3464c075753c725a0f83726311ac95229c970a2971b22671d71f2eca31389b22","title":"Create Release Notes documentation section","description":"The docs index references a 'Release Notes' section that doesn't exist. Create this section to document:\n- Current version features and changes\n- Migration guides for breaking changes\n- Known issues and workarounds\n- Future roadmap items\n- Changelog format and maintenance process","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T23:24:16.603757397-05:00","updated_at":"2025-11-06T23:24:16.603757397-05:00","source_repo":".","labels":["changelog","documentation","releases"],"dependencies":[{"issue_id":"quad-ops-274","depends_on_id":"quad-ops-79g","type":"blocks","created_at":"2025-11-06T23:24:16.611438057-05:00","created_by":"daemon"}]}
{"id":"quad-ops-284","content_hash":"93e3458e056754e5293e66cbac9a751078bd9c48e6ec638cf67d7e95c38e63d1","title":"Step 2: Scaffold QuadletWriter utility","description":"Introduce reusable INI writer abstraction without modifying renderer logic yet.\n\nIntent: Create a QuadletWriter struct to centralize INI section formatting and reduce duplication while keeping Renderer API intact.\n\nFiles affected:\n- internal/platform/systemd/quadlet.go (new file)\n- internal/platform/systemd/renderer.go (no changes yet)\n- internal/platform/systemd/helpers.go (preparation)\n\nChanges:\n- Create QuadletWriter struct with buf *strings.Builder\n- Implement NewQuadletWriter(section string) *QuadletWriter\n- Implement Set(key, value string) for single-value directives\n- Implement Append(key string, values ...string) for multi-value directives\n- Implement String() string to return formatted INI section\n- Add unit tests for QuadletWriter formatting behavior\n\nPreconditions: Step 1 merged; tests encode current outputs\nPostconditions: QuadletWriter exists, covered by unit tests to ensure formatting parity; renderer still uses legacy string building\nChecks: go test ./internal/platform/systemd/... including new quadlet tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T12:30:58.874785-05:00","updated_at":"2025-11-11T12:36:58.109594-05:00","closed_at":"2025-11-11T12:36:58.109594-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-284","depends_on_id":"quad-ops-8p7","type":"blocks","created_at":"2025-11-11T12:30:58.875737-05:00","created_by":"daemon"}]}
{"id":"quad-ops-2bs","content_hash":"2b60b26bf656a806575e6c23d219a3715542f6e5d9a2595bdbb236516b2f30f9","title":"Add platform-specific feature validation and warnings","description":"Users should be warned when using features that don't work on their platform. macOS silently ignores Quadlet-specific features leading to feature loss and confusion.\n\nCurrent state:\n- Platform detection exists via runtime.GOOS in internal/validate/validate.go\n- Init containers disabled on macOS with no warning\n- macOS renderer silently ignores spec.Volumes, spec.Networks, and spec.Container.Build\n- No feature-level platform capability checking\n\nNeed to:\n- Add validation warnings during spec conversion when unsupported features are used\n- Detect when Quadlet-specific features (volumes, networks, builds) are used on macOS\n- Update compose reader to flag unsupported features per platform\n- Add platform capability checking in internal/validate/\n- Test validation works correctly for both platforms\n\nThis prevents user confusion and provides clear feedback about platform limitations.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-06T21:39:40.863822782-05:00","updated_at":"2025-11-11T20:45:05.228228-05:00","source_repo":".","labels":["cross-platform","user-experience","validation"],"dependencies":[{"issue_id":"quad-ops-2bs","depends_on_id":"quad-ops-6cz","type":"blocks","created_at":"2025-11-06T21:39:48.664022136-05:00","created_by":"daemon"}]}
{"id":"quad-ops-3","content_hash":"f634dad79c6a53702e1fa0b5d3df60c3ffe53cd57b4d148f37b59620c0166d73","title":"Phase 2: Create shared podman_args.go builder used by both systemd and launchd renderers","description":"Create shared podman argument builder to eliminate duplication between systemd and launchd renderers.\n\nCurrent problem:\n- internal/platform/systemd/podmanargs.go: ~200 lines of podman command building\n- internal/platform/launchd/podmanargs.go: ~200 lines of duplicate logic\n\nSolution:\n- Create internal/platform/podman_args.go (~150 lines) with unified PodmanArgsBuilder\n- Both systemd and launchd renderers import and use shared builder\n- Delete per-platform podmanargs.go files\n- Eliminates 200+ lines of duplication\n\nResponsibilities of shared builder:\n- BuildImage() - Container image specification\n- BuildCommand() - Command and args\n- BuildPorts() - Port mappings (--publish)\n- BuildMounts() - Volume mounts (--volume, --mount)\n- BuildEnvironment() - Environment variables (--env, --env-file)\n- BuildCapabilities() - Security options (--cap-add, --cap-drop, --privileged, --security-opt)\n- BuildResourceLimits() - Memory, CPU constraints (--memory, --cpus, --cpu-shares)\n- BuildNetworking() - Network mode and DNS (--network, --dns, --hostname)\n- Build() - Returns complete []string of podman run arguments\n\nReference: history/full-pipeline-simplification.md Section \"Eliminate Duplication\" and implementation-checklist.md Phase 2","acceptance_criteria":"✅ Created internal/platform/podman_args.go (≤150 lines) with PodmanArgsBuilder struct\n✅ Builder has methods for all podman argument categories (image, ports, mounts, env, security, resources, networking)\n✅ Systemd renderer updated to use shared builder (delete internal/platform/systemd/podmanargs.go)\n✅ Launchd renderer updated to use shared builder (delete internal/platform/launchd/podmanargs.go)\n✅ Table-driven unit tests for builder in podman_args_test.go\n✅ Both renderer test suites still pass (output unchanged)\n✅ No duplication between platform implementations\n✅ go test ./internal/platform/... passes","notes":"**NO BACKWARD COMPATIBILITY REQUIRED**: Internal platform package refactoring. Breaking changes to internal renderer APIs are acceptable.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:29:30.10291501-05:00","updated_at":"2025-11-11T12:20:39.174023-05:00","closed_at":"2025-11-11T12:20:39.174023-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-3","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.919269796-05:00","created_by":"daemon"},{"issue_id":"quad-ops-3","depends_on_id":"quad-ops-2","type":"blocks","created_at":"2025-11-11T10:09:01.914654-05:00","created_by":"daemon"}]}
{"id":"quad-ops-3aq","content_hash":"fa0ded88e9f3b15fc1c0ed67e8184385190a3e461945d71fdcfc07d40f7e659e","title":"Update documentation to clarify platform differences","description":"The current documentation claims full Docker Compose support but this is misleading for macOS. Need to clearly document platform differences.\n\nNeed to:\n- Update README.md to clarify platform-specific feature support\n- Add platform comparison table in documentation\n- Update feature claims to be platform-specific\n- Add migration guide for users moving between platforms\n- Update examples to show platform differences\n\nThis will set proper user expectations and prevent confusion about feature availability.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T21:39:43.446055828-05:00","updated_at":"2025-11-06T21:39:43.446055828-05:00","source_repo":".","labels":["documentation","platform-differences","user-experience"],"dependencies":[{"issue_id":"quad-ops-3aq","depends_on_id":"quad-ops-2bs","type":"blocks","created_at":"2025-11-06T21:39:50.509568025-05:00","created_by":"daemon"}]}
{"id":"quad-ops-3i1","content_hash":"45349bd2bbd7e536078dd82e8f65672f28322e41b3ab97ae94d510a05dee4061","title":"x-podman-* extensions documented but not implemented","description":"README documents x-podman-buildargs and x-podman-volumes extensions but they're not wired up in code.\n\nEvidence: grep -r \"x-podman-\" internal/ finds nothing\n\nRisk: Documentation promises features that don't work","design":"Options:\n1. Implement extensions:\n   - x-podman-buildargs: Read from service.Extensions, add to build.PodmanArgs\n   - x-podman-volumes: Read from service.Extensions, parse into Mounts or Container.PodmanArgs\n   \n2. Remove from README until implemented\n\nRecommendation: Remove from README for now, implement when users request it.\n\nIf implementing:\n- Parse extensions in spec_converter.go:convertService()\n- Check for map[\"x-podman-buildargs\"], map[\"x-podman-volumes\"]\n- Type assert and convert to appropriate fields\n- Add test coverage with compose files using extensions","acceptance_criteria":"Either:\nA) Extensions are implemented and tested, OR\nB) Extensions are removed from README with TODO note\n\nIf implementing:\n- x-podman-buildargs adds to build args\n- x-podman-volumes adds to mounts or podman args\n- Test coverage for extensions","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-09T16:40:17.290625-05:00","updated_at":"2025-11-09T23:12:22.492706-05:00","closed_at":"2025-11-09T23:12:22.492706-05:00","source_repo":"."}
{"id":"quad-ops-3kb","content_hash":"bd6d11ccbeb9f8f983aada7040d63502fb4b4850adf021aaa470a7f115068fd6","title":"Fix volume name escaping: underscore vs hyphen mismatch","description":"Volume mount sources are prefixed with underscores in spec_converter.go (lines 236, 248) but volumes are created with hyphens via SanitizeName().\n\n**Location:** internal/compose/spec_converter.go lines 236 and 248\n\n**Current behavior:**\n```go\nmount.Source = fmt.Sprintf(\"%s_%s\", project.Name, v.Source)  // Uses underscore\n```\n\n**Expected behavior:**\nShould use the Prefix() helper that uses hyphens:\n```go\nmount.Source = compose.Prefix(project.Name, v.Source)  // Creates with hyphen\n```\n\n**Effect:** Volume references fail because quadlet looks for `miniflux_db_data` (underscores) when the actual volume is `miniflux-db-data` (hyphens).\n\n**Part of:** https://github.com/trly/quad-ops/discussions/52 (Quadlet generator analysis)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T12:22:21.88470299-05:00","updated_at":"2025-11-09T12:24:15.593588877-05:00","closed_at":"2025-11-09T12:24:15.593588877-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-3kb","depends_on_id":"quad-ops-712","type":"blocks","created_at":"2025-11-09T12:22:21.885666818-05:00","created_by":"daemon"}]}
{"id":"quad-ops-3km","content_hash":"ff4d51182cee6932d1820a2219930d84f808d90d7d221916b701458f812aa003","title":"multi-service/docker-compose.yaml - invalid secret names","description":"$ ./quad-ops validate examples/multi-service/docker-compose.yaml\ntime=\"2025-11-06T21:45:52-05:00\" level=warning msg=\"/home/trly/github.com/trly/quad-ops/examples/multi-service/docker-compose.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion\"\ntime=2025-11-06T21:45:52.079-05:00 level=WARN msg=\"Secret name doesn't follow DNS naming conventions\" name=db_password\ntime=2025-11-06T21:45:52.079-05:00 level=WARN msg=\"Secret name doesn't follow DNS naming conventions\" name=db_password\ntime=2025-11-06T21:45:52.079-05:00 level=WARN msg=\"Secret name doesn't follow DNS naming conventions\" name=db_password\n\n","status":"closed","priority":4,"issue_type":"bug","created_at":"2025-11-06T21:47:01.808506075-05:00","updated_at":"2025-11-06T23:18:05.229118677-05:00","closed_at":"2025-11-06T23:18:05.229118677-05:00","source_repo":"."}
{"id":"quad-ops-3ks","content_hash":"c61508563313532b1076ee6c3e6adcf7b5ac2a4ae59e71789bc638c1a8cf8900","title":"Fix gosec linting issues in test files","description":"The gosec security linter was disabled due to issues with test files. Need to properly address the security warnings:\n\n- G304: Potential file inclusion via variable (os.ReadFile in tests)\n- G301: Directory permissions should be 0750 or less (os.MkdirAll with 0755)\n- G306: File permissions should be 0600 or less (os.WriteFile with 0644)\n\nThese are legitimate security concerns that should be addressed rather than disabling the linter.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T21:22:59.338099854-05:00","updated_at":"2025-11-06T21:25:01.369839516-05:00","closed_at":"2025-11-06T21:25:01.369839516-05:00","source_repo":"."}
{"id":"quad-ops-3l1","content_hash":"9d4a2af53daafd2382af08c8c75c4897352c55f643f61f2c06ed055eb7ec3854","title":"Fix launchd BuildPodmanArgs to include service-level networks","description":"BuildPodmanArgs in launchd/podmanargs.go only handles spec.Container.Network.Mode but ignores spec.Networks. \n\nNeed to iterate through spec.Networks and add --network flag for each non-external network. This should be done after the Network.Mode handling to allow proper network connection to all declared networks.\n\nCurrently lines 82-84 only handle the singular network mode. Need to add loop similar to:\n```\nfor _, net := range spec.Networks {\n  if !net.External {\n    args = append(args, \"--network\", net.Name)\n  }\n}\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:53:50.915906276-05:00","updated_at":"2025-11-08T16:55:44.080855742-05:00","closed_at":"2025-11-08T16:55:44.080855742-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-3l1","depends_on_id":"quad-ops-hak","type":"blocks","created_at":"2025-11-08T16:53:50.921362078-05:00","created_by":"daemon"}]}
{"id":"quad-ops-3x9","content_hash":"cb3df01684305186c8f7f59fd471acf82ffaab2384a9139a6f592b75369642f7","title":"Update examples to use fully qualified image references","description":"The example compose files use unqualified image names (e.g., nginx:alpine) that fail to resolve without proper podman registry configuration. Update all examples to use fully qualified image references (e.g., docker.io/library/nginx:alpine) to ensure they work out of the box.","acceptance_criteria":"./quad-ops -u sync \u0026\u0026 ./quad-ops -u up are successful","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T23:41:08.908702281-05:00","updated_at":"2025-11-06T23:42:44.677415917-05:00","closed_at":"2025-11-06T23:42:44.677415917-05:00","source_repo":"."}
{"id":"quad-ops-3zb","content_hash":"acc0c96e8ddaf026c1eb099eaf06f6294655b90d8d30512dc4322f73e61bfbc9","title":"Add diagnostic tooling to detect systemd generator issues","description":"When units fail to restart, users should have clear diagnostic information:\n\n1. **Check if Quadlet generator is installed**:\n   - Verify `/usr/lib/systemd/system-generators/podman-system-generator` exists\n   - Or equivalent generator based on Podman version\n\n2. **Detect if .container file exists but .service doesn't**:\n   - Compare artifact files vs systemd unit database\n   - Clear error message: \"Unit file written but generator didn't create service\"\n\n3. **Debug helper command**:\n   - `quad-ops debug systemd` - checks generator status, unit cache, recent errors\n   - Show systemd journal for generator failures\n\n4. **Better error messages**:\n   - Instead of generic \"Unit not found\"\n   - Say: \"llm-open-webui.container written but llm-open-webui.service not generated. Generator may not be installed or daemon-reload may have failed.\"","acceptance_criteria":"Implement diagnostic checks in lifecycle manager. Add verbose logging that helps debug generator issues. Consider adding a debug subcommand for troubleshooting systemd problems.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T21:16:25.311451587-05:00","updated_at":"2025-11-10T01:02:33.948064-05:00","closed_at":"2025-11-10T01:02:33.948064-05:00","source_repo":".","labels":["observability","systemd","task"]}
{"id":"quad-ops-4","content_hash":"e487fa2ec88eb2aad0f097f258d7487e94b350f7df166f5a674e3b33faf694ab","title":"Phase 3: Systemd renderer simplification (5345→1200 lines) - direct Spec→INI mapping","description":"Simplify systemd renderer from 5345 lines → 1200 lines by replacing intermediate unit models with direct Spec→Quadlet INI mapping.\n\nCurrent state:\n- 5345 lines across 8 files with complex unit generation\n- Multiple abstraction layers: Spec → Unit model → String serialization\n\nTarget architecture (1200 lines, 4 files):\n- renderer.go (~400 lines): Main rendering orchestration\n  - renderService() - Handles service conversion\n  - buildContainerUnit() - Direct Spec → .container INI string\n  - buildNetworkUnit() - Direct Network → .network INI string  \n  - buildVolumeUnit() - Direct Volume → .volume INI string\n\n- quadlet.go (~400 lines): QuadletWriter for INI format generation\n  - Simple methods to write each Quadlet directive\n  - AddImage(), AddPorts(), AddMounts(), AddEnvironment()\n  - AddSecurityOptions(), AddResourceLimits(), AddHealthcheck()\n  - Direct string building, no intermediate models\n\n- helpers.go (~100 lines): Systemd-specific utilities\n  - Dependency ordering, label conversion, unit naming\n\n- lifecycle.go (~100 lines): Unchanged - service management\n  - Start(), Stop(), Restart() via D-Bus\n  - Already well-factored, keep as-is\n\nKey simplification: Remove intermediate Unit struct, build INI strings directly from service.Spec fields.\n\nReference: history/full-pipeline-simplification.md \"Systemd Renderer Simplification\" and implementation-checklist.md Phase 3","acceptance_criteria":"✅ Renderer restructured: renderer.go ≤400 lines, quadlet.go ≤400 lines, helpers.go ≤100 lines\n✅ lifecycle.go unchanged (already clean)\n✅ Direct Spec → Quadlet INI mapping (no intermediate Unit models)\n✅ QuadletWriter class handles INI format generation\n✅ Table-driven renderer_test.go validates artifact content\n✅ Golden tests pass: generated .container/.network/.volume units byte-identical to current\n✅ go test ./internal/platform/systemd/... passes\n✅ Total systemd package: ≤1200 lines","status":"closed","priority":1,"issue_type":"task","assignee":"agent","created_at":"2025-11-11T01:29:30.103564964-05:00","updated_at":"2025-11-11T16:01:37.592774-05:00","closed_at":"2025-11-11T16:01:37.592774-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.930495788-05:00","created_by":"daemon"},{"issue_id":"quad-ops-4","depends_on_id":"quad-ops-3","type":"blocks","created_at":"2025-11-11T10:09:01.91992-05:00","created_by":"daemon"}]}
{"id":"quad-ops-447","content_hash":"19363f559ee1b52693aa3c06e8a9d050af81c7adecdda11b18c5ef3b4d70fa24","title":"Step 4: Refactor volume/network/build rendering via QuadletWriter","description":"Apply writer-based approach to remaining unit types, ensuring consistent dependency wiring and minimal duplication.\n\nIntent: Migrate renderVolume(), renderNetwork(), renderExternalNetwork(), and renderBuild() to use QuadletWriter, completing the refactoring.\n\nFiles affected:\n- internal/platform/systemd/renderer.go (volume/network/build methods)\n- internal/platform/systemd/quadlet.go (potential additions)\n\nChanges:\n- Convert renderVolume() to use QuadletWriter for [Volume] section\n- Convert renderNetwork() to use QuadletWriter for [Network] section\n- Convert renderExternalNetwork() to use QuadletWriter\n- Convert renderBuild() to use QuadletWriter for [Build] section\n- Ensure all unit types share common [Install] section builder\n- Deduplicate label/option/argument rendering across unit types\n- Remove redundant sorting and formatting code\n\nPreconditions: Step 3 integrated; helper utilities cover common patterns\nPostconditions: All unit builders use shared writer; renderer.go reduced below target LOC; golden outputs unchanged\nChecks: Table-driven tests, go test ./internal/platform/systemd/...","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T12:31:17.106371-05:00","updated_at":"2025-11-11T13:32:25.966764-05:00","closed_at":"2025-11-11T13:32:25.966764-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-447","depends_on_id":"quad-ops-g38","type":"blocks","created_at":"2025-11-11T12:31:17.108442-05:00","created_by":"daemon"}]}
{"id":"quad-ops-460","content_hash":"b37aa642fe37babf167d46a4329ff885df283b1e2a7d6273c83300def8cc3e45","title":"Add launchd Podman flag parity tests","description":"Write launchd-specific unit tests in internal/platform/launchd/podmanargs_test.go that enforce emission of --add-host, --dns/--dns-search/--dns-opt, --device, and tmpfs-with-options Podman flags. The new tests should fail prior to implementation, documenting the current gaps.","notes":"Test expectations:\n- Extra host and DNS assertions should reflect alphabetically sorted order (matching converter output).\n- Tmpfs mode assertions should align with cross-platform-compatible formatting (mirror systemd renderer behavior).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-09T18:44:25.937087-05:00","updated_at":"2025-11-09T18:50:34.624626-05:00","closed_at":"2025-11-09T18:50:34.624626-05:00","source_repo":".","labels":["launchd","testing"]}
{"id":"quad-ops-494","content_hash":"c05c31f3830e77b375733852ff55b36f5167dcab652d7ba474291820435355dd","title":"Add TimeoutStartSec to Service section for image pull resilience","description":"Podman documentation recommends setting TimeoutStartSec=900 (15 minutes) because pulling container images can exceed systemd's default 90-second timeout.\n\nCurrently the renderer doesn't set this, which could cause startup failures on slow networks or with large images.\n\nSee: https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html\n\nRecommendation: Add TimeoutStartSec=900 to [Service] section for all regular containers.","acceptance_criteria":"Add TimeoutStartSec directive to [Service] section generation. Make it configurable (with sensible default 900). Add documentation about why this is important.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T21:09:03.063099484-05:00","updated_at":"2025-11-08T21:47:25.18679628-05:00","closed_at":"2025-11-08T21:47:25.18679628-05:00","source_repo":".","labels":["production","quadlet","task"]}
{"id":"quad-ops-49l1","content_hash":"044a28bdc9acf0be22ba074aaf6aa978983c49dacad50b9ac5253fa1341ad7dc","title":"Add goleak for goroutine leak detection and fix daemon test","description":"Add goleak package-wide to catch goroutine leaks:\n\n1. Add goleak dependency: `go get -t go.uber.org/goleak`\n2. Create cmd/main_test.go with TestMain(m) calling goleak.VerifyTestMain(m)\n3. Fix TestDaemon_PeriodicSync to wait for daemon goroutine to exit (line 108-109 in daemon_e2e_test.go)\n4. Verify no other goroutine leaks\n\nCritical fix needed in daemon_e2e_test.go where goroutine spawned without synchronization.","design":"```go\n// cmd/main_test.go\npackage cmd\n\nimport (\n    \"testing\"\n    \"go.uber.org/goleak\"\n)\n\nfunc TestMain(m *testing.M) {\n    goleak.VerifyTestMain(m)\n}\n\n// daemon_e2e_test.go TestDaemon_PeriodicSync fix:\ndone := make(chan struct{})\ngo func() {\n    _ = daemonCmd.Run(ctx, app, opts, deps)\n    close(done)\n}()\n// ... test logic ...\n\u003c-done  // Wait for completion\n```","acceptance_criteria":"- goleak added to go.mod (test-only)\n- cmd/main_test.go exists with TestMain\n- TestDaemon_PeriodicSync uses done channel to wait for goroutine\n- All tests pass with goleak verification\n- No goroutine leaks detected","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-12T09:39:38.858974-05:00","updated_at":"2025-11-12T09:50:13.675333-05:00","closed_at":"2025-11-12T09:50:13.675333-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-49l1","depends_on_id":"quad-ops-mo35","type":"discovered-from","created_at":"2025-11-12T09:39:38.860294-05:00","created_by":"daemon"}]}
{"id":"quad-ops-4a3","content_hash":"4981e0023f7076c8240e1807dcfd52990423aca51364814e98fb15503231b352","title":"Validate fix with quad-ops-deploy immich configuration","description":"Test the fix against the actual failing configuration in quad-ops-deploy/prod/taylor/media/.\n\nSteps:\n1. Generate quad-ops configuration from the immich docker-compose.yml\n2. Verify immich-server is connected to both 'default' and 'infrastructure-proxy' networks\n3. Verify immich-redis and immich-database are on the same networks as immich-server\n4. Verify systemd/launchd units have correct --network flags\n5. Verify unit dependencies include network units\n6. Test actual startup to confirm DNS resolution works\n\nThis validates the fix solves the original reported problem.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T15:58:10.388773046-05:00","updated_at":"2025-11-08T17:44:05.136871982-05:00","closed_at":"2025-11-08T17:44:05.136871982-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4a3","depends_on_id":"quad-ops-wib","type":"blocks","created_at":"2025-11-08T15:58:10.393389294-05:00","created_by":"daemon"}]}
{"id":"quad-ops-4fv","content_hash":"ef1ce82d050902ca58e52adb9b64ce8ba950ca1a994e30fe51790a7836cf7ac5","title":"Eliminate helpers.go following Go best practices","description":"Refactored compose package to eliminate the anti-pattern helpers.go file by moving functions to their domain-specific files.\n\n## Analysis\nFound compose/helpers.go with 5 functions (112 lines):\n1. `SanitizeProjectName` - ❌ Duplicate (reader.go already had `sanitizeProjectName`)\n2. `Prefix` - Used 12x in convert.go for resource naming\n3. `FindEnvFiles` - Used 1x in convert.go for env file discovery\n4. `HasNamingConflict` - ❌ Unused (only in helpers_test.go, never in production)\n5. `IsExternal` - Used 11x in convert.go for external resource detection\n\n## Changes Made\n**Deleted:**\n- internal/compose/helpers.go (112 lines)\n- internal/compose/helpers_test.go (382 lines)\n- internal/platform/systemd/renderer.go.bak (1189 lines - leftover backup)\n\n**Moved to convert.go:**\n- `Prefix()` - Resource naming is a conversion concern\n- `FindEnvFiles()` - Env file discovery is a conversion concern\n- `IsExternal()` - External resource detection is a conversion concern\n\n**Deleted duplicate/unused:**\n- `SanitizeProjectName` - Duplicate of reader.go's `sanitizeProjectName`\n- `HasNamingConflict` - Unused function (only in tests)\n\n**Tests:**\n- Migrated all helpers_test.go tests to convert_test.go (TestPrefix, TestFindEnvFiles, TestIsExternal)\n- All 1103 tests pass\n\n**Cleanup:**\n- Removed unused `formatKeyValue()` from renderer.go\n- Fixed godot lint warning in quadlet_test.go\n- Ran gofmt on all modified files\n\n## Result\n- ✅ Net -1374 lines (deleted 1691, added 317)\n- ✅ No more generic \"helpers\" file\n- ✅ Functions live with their usage domain (convert.go)\n- ✅ All tests pass\n- ✅ Follows Go community best practices","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-11T15:45:07.701212-05:00","updated_at":"2025-11-11T15:45:12.046372-05:00","closed_at":"2025-11-11T15:45:12.046372-05:00","source_repo":"."}
{"id":"quad-ops-4i2","content_hash":"9d34c603a3ecff940b915cfb03395158118dc546074208062f90beee4806d2cd","title":"Missing Compose feature: dns/dns_search/dns_opt","description":"v0.21.2 supported DNS settings via PodmanArgs. Current spec_converter doesn't convert dns/dns_search/dns_opt from compose services.","design":"Add Container.DNS, Container.DNSSearch, Container.DNSOpt fields in models.go. Convert service.DNS/DNSSearch/DNSOpts in spec_converter. Render via PodmanArgs (--dns, --dns-search, --dns-opt) in systemd renderer.","acceptance_criteria":"- dns settings in compose convert to container fields\n- Rendered as PodmanArgs with correct flags\n- Test coverage for DNS conversion","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T13:44:34.774623-05:00","updated_at":"2025-11-09T15:13:47.726614-05:00","closed_at":"2025-11-09T15:13:47.726614-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4i2","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.775053-05:00","created_by":"daemon"}]}
{"id":"quad-ops-4je","content_hash":"17d842c85d816936735ba096119bdfcdf1ab52f682062052716342812053edef","title":"Document external network setup patterns for multi-project deployments","description":"Document how to properly set up external networks that are shared across multiple projects.\n\nWhen multiple projects (dozzle, llm, scrutiny, etc.) need to share a network like infrastructure-proxy:\n\nOption 1 (Recommended): Infrastructure project\n- Create an \"infrastructure\" project with a compose file that defines the proxy network (NOT marked external)\n- Deploy this first: `quad-ops sync infrastructure`\n- Other projects reference it as external\n- This creates the infrastructure-proxy.network unit once\n\nOption 2: Manual network creation\n- Pre-create the network: `podman network create infrastructure-proxy`\n- Mark as external in compose files\n- quad-ops won't try to create it\n\nOption 3: Bootstrap script\n- Create networks before deploying projects\n- Document the bootstrap process\n\nDocument:\n- The design decision: why external networks aren't created by quad-ops\n- Recommended patterns and examples\n- Troubleshooting: what happens if network doesn't exist (quadlet-generator error)\n- Migration guide: converting existing networks to external","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-10T01:11:58.562805735-05:00","updated_at":"2025-11-11T20:45:05.200942-05:00","closed_at":"2025-11-11T20:45:05.200942-05:00","source_repo":"."}
{"id":"quad-ops-4ki","content_hash":"624a9fa5a4cb8c4331c1d9249d3ab1d6246f63cbb85f2056e24672ba66c838f9","title":"Reduce cyclomatic complexity in launchd/podmanargs.go BuildPodmanArgs","description":"BuildPodmanArgs function has cyclomatic complexity of 31 (threshold: 30).\n\nLocation: internal/platform/launchd/podmanargs.go:14:1\n\nNeeds refactoring to break down the large function into smaller, more focused helper functions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T17:54:18.38401-05:00","updated_at":"2025-11-09T17:56:23.959183-05:00","closed_at":"2025-11-09T17:56:23.959183-05:00","source_repo":"."}
{"id":"quad-ops-4kk","content_hash":"381d2ba2db8143c979d045cbf8a835794219bac69ca2722e71566d56753b721b","title":"Render tmpfs mounts with options via launchd --tmpfs flags","description":"Extend internal/platform/launchd/podmanargs.go so tmpfs mounts (including entries from service.Container.Mounts with TmpfsOptions as well as legacy Container.Tmpfs strings) produce the correct podman --tmpfs arguments, formatting size/mode/uid/gid consistently. Ensure new tmpfs tests pass.","notes":"Implementation guidance:\n- Format tmpfs --tmpfs arguments so mode values follow the same convention as the systemd renderer (cross-platform compatible decimal formatting).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-09T18:45:03.542038-05:00","updated_at":"2025-11-09T19:01:20.368281-05:00","closed_at":"2025-11-09T19:01:20.368281-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4kk","depends_on_id":"quad-ops-460","type":"blocks","created_at":"2025-11-09T18:45:03.542513-05:00","created_by":"daemon"},{"issue_id":"quad-ops-4kk","depends_on_id":"quad-ops-sly","type":"blocks","created_at":"2025-11-09T18:45:03.542793-05:00","created_by":"daemon"}]}
{"id":"quad-ops-4o9","content_hash":"b4609c4601bf349ae80df91f6624a051b7e0c70b40aa48587b2bb95633b61ae3","title":"Phase 8: Extract helpers to fix complexity violations and deduplicate logic","description":"Extract helpers from complex functions to reduce complexity and code duplication, achieving 30-45% reduction target (7,000-9,000 lines).\n\n**Scope:** Extract helper methods from the 3 complex functions that currently have gocyclo suppressions (added in quad-ops-0t8).\n\n**Functions to refactor:**\n1. compose.convertContainer (complexity 65) - Extract: buildEnv(), buildEnvFiles(), buildDNS(), buildDevices(), buildCgroupRules(), buildHealthcheck(), buildRestartPolicy(), buildNetworkMode(), buildPorts(), buildMounts()\n2. compose.convertInitContainers (complexity 45) - Extract: computeMainEnv(), computeMainMounts(), computeMainNetwork(), parseInitItem(), buildInitContainerSpec()\n3. systemd.writeContainerSection (complexity 66) - Extract: writeEnv(), writePorts(), writeMounts(), writeNetwork(), writeSecurityOptions(), writeResources(), writeHealthcheck(), writePodmanArgs()\n\n**Deliverables:**\n- Remove //nolint:gocyclo suppressions from all 3 functions\n- Extract cohesive helper methods with single responsibility\n- Reduce cyclomatic complexity to \u003c30 for all functions\n- Maintain or improve test coverage\n- All tests pass, no behavioral changes\n\n**Target:** 300-600 line reduction through helper extraction and deduplication","acceptance_criteria":"✅ All complexity violations resolved (all functions \u003c30 cyclomatic complexity)\n✅ task build passes (no gocyclo or revive errors)\n✅ Helpers extracted with table-driven unit tests\n✅ Network/env mapping logic deduplicated across compose functions\n✅ compose/interfaces.go deleted (unused)\n✅ Coverage maintained at 68.9%+\n✅ Golden tests pass (byte-identical output)\n✅ Line count reduced by 300-600 lines","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T19:12:02.46401-05:00","updated_at":"2025-11-11T19:34:39.264146-05:00","closed_at":"2025-11-11T19:34:39.264146-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4o9","depends_on_id":"quad-ops-0t8","type":"blocks","created_at":"2025-11-11T19:12:02.465792-05:00","created_by":"daemon"}]}
{"id":"quad-ops-4pn","content_hash":"21f5036988558aed7bc75547306ad4e092819eeb8ecdd5c38663f93b728a0459","title":"Update systemd renderer to connect services to their declared networks","description":"Update internal/platform/systemd/renderer.go to handle service-level networks.\n\nThe renderer needs to:\n1. Extract service networks from spec.Networks\n2. Add --network flags for each network in the podman run command\n3. Generate proper unit file dependencies (After/Requires) for service networks\n4. Ensure services are started after their networks are available\n\nThis should follow the pattern used in v0.21.2 where services had explicit network connections.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T15:57:59.636269116-05:00","updated_at":"2025-11-08T16:55:43.866412286-05:00","closed_at":"2025-11-08T16:55:43.866412286-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4pn","depends_on_id":"quad-ops-69e","type":"blocks","created_at":"2025-11-08T15:57:59.640240873-05:00","created_by":"daemon"}]}
{"id":"quad-ops-4x2r","content_hash":"fbd511f6d157305411d80a063d473ef8b58c33f4b5b8e436ab7ccb7d33dbb591","title":"Add go-cmp for deep equality comparisons in tests","description":"Add go-cmp for better diff output on complex comparisons. Use hybrid approach:\n\nKeep testify for: assert.NoError, assert.True, assert.Len, assert.Contains\nUse go-cmp for: struct comparisons, slice/map comparisons, dependency order\n\nStart with workflow_test.go TestWorkflow_UpWithDependencies (lines 264-268) as example.","design":"```go\n// Example conversion\nwant := []string{\"db\", \"api\", \"web\"}\nif diff := cmp.Diff(want, startOrder); diff != \"\" {\n    t.Fatalf(\"start order mismatch (-want +got):\\n%s\", diff)\n}\n\n// For unordered comparisons\nif diff := cmp.Diff(want, got, cmpopts.SortSlices(func(a, b string) bool {\n    return a \u003c b\n})); diff != \"\" {\n    t.Fatalf(\"mismatch (-want +got):\\n%s\", diff)\n}\n```","acceptance_criteria":"- go-cmp added to go.mod (test-only)\n- At least 2-3 test cases converted to use cmp.Diff\n- Clear diffs shown on failure (-want +got format)\n- testify still used for simple assertions\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T09:39:38.86619-05:00","updated_at":"2025-11-12T09:56:52.588933-05:00","closed_at":"2025-11-12T09:56:52.588933-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-4x2r","depends_on_id":"quad-ops-dqrd","type":"discovered-from","created_at":"2025-11-12T09:39:38.866683-05:00","created_by":"daemon"}]}
{"id":"quad-ops-5","content_hash":"7aa4c81bbdc5550b1aea89f12e6b68e493168b54b71c19f17338c6c8ba7d9dae","title":"Phase 4: Launchd renderer simplification (5287→1200 lines) - direct Spec→plist mapping","description":"Simplify launchd renderer using direct Spec→plist XML mapping (following systemd renderer pattern).\n\n**Current state:**\n- Complex plist generation with multiple abstraction layers\n- Duplication of podman argument building logic\n\n**Target architecture:**\n- renderer.go: Direct service.Spec → plist structure mapping\n- plist.go: Simple XML plist generation (handles KeepAlive, environment, program args)\n- Use shared podman args builder from internal/platform/podman_args.go (eliminates duplication)\n\n**Key simplification:** Remove intermediate models, build plist directly from service.Spec fields using shared podman args builder.","acceptance_criteria":"✅ Direct Spec → plist XML mapping (no intermediate abstractions)\n✅ Uses shared podman args builder from internal/platform/podman_args.go\n✅ Consolidated rendering logic (inline helpers where appropriate)\n✅ Table-driven renderer_test.go validates plist content\n✅ Golden tests pass: generated .plist files byte-identical to current\n✅ go test ./internal/platform/launchd/... passes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:29:30.104226298-05:00","updated_at":"2025-11-11T18:38:53.158467-05:00","closed_at":"2025-11-11T18:38:53.158467-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-5","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.942849368-05:00","created_by":"daemon"},{"issue_id":"quad-ops-5","depends_on_id":"quad-ops-3","type":"blocks","created_at":"2025-11-11T10:09:01.92517-05:00","created_by":"daemon"}]}
{"id":"quad-ops-581","content_hash":"2262c1ae9a78729bca878d0a801ce7d9a5ee9c01f98cc03a174b68c5d9041382","title":"Missing RequiresMountsFor directives for bind mounts","description":"Containers with bind mounts don't declare RequiresMountsFor dependencies, risking start before host paths are available (especially with NFS/network mounts).","design":"Parse Mount.Type == MountTypeBind and collect source paths. Add RequiresMountsFor=/host/path directives in [Unit] section. Location: renderContainer() around line 145 after dependency declarations.","acceptance_criteria":"- Bind mounts have RequiresMountsFor directives\n- Multiple bind mounts list all paths\n- Non-bind mounts don't add RequiresMountsFor","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T13:44:34.737856-05:00","updated_at":"2025-11-09T14:35:29.509538-05:00","closed_at":"2025-11-09T14:35:29.509538-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-581","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.738432-05:00","created_by":"daemon"}]}
{"id":"quad-ops-58x","content_hash":"ad4bf6d8d3a030e27f9b794cb4cff369bcd816847681d5e6ab7400933d3e28b5","title":"Document CPU constraint limitations and alternatives","description":"Add documentation explaining that Quadlet has no native CPU constraint directives, and CPU limits must be passed via PodmanArgs. Document the mapping between Docker Compose deploy.resources CPU fields and Podman CLI flags.","acceptance_criteria":"- Documentation added to README or docs/ explaining CPU constraint handling\n- Mapping documented: compose.cpus -\u003e --cpus, deploy.cpu_quota -\u003e --cpu-quota, etc.\n- Limitations clearly stated (no direct Quadlet directive support)\n- Examples provided for common use cases","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-08T21:37:08.306568014-05:00","updated_at":"2025-11-08T21:37:08.306568014-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-58x","depends_on_id":"quad-ops-24q","type":"parent-child","created_at":"2025-11-08T21:37:08.308453626-05:00","created_by":"daemon"}]}
{"id":"quad-ops-5f0","content_hash":"b3f7c9a86708cd86c42a8d1a3fb3f6c698c233d8f9855f1f61cd1dbea1b07e4d","title":"Fix service restart failures after unit generation verification","description":"Services fail to restart after sync despite successful unit generation verification.\n\n## Symptoms\nWhen running `sync -f`, the logs show:\n1. `waitForUnitGeneration()` succeeds for all 5 units\n2. \"Unit generated successfully\" logged for each unit\n3. Immediately after, restart fails with \"Unit not found\"\n\nExample:\n```\ntime=2025-11-09T10:51:23.930-05:00 level=DEBUG msg=\"Unit generated successfully\" unit=llm-open-webui.service attempts=1\n...\ntime=2025-11-09T10:51:23.934-05:00 level=ERROR msg=\"Failed to restart service\" name=llm-open-webui error=\"failed to restart service llm-open-webui: error restarting unit llm-open-webui.service: Unit llm-open-webui.service not found.\"\n```\n\n## Root Cause Investigation Needed\n1. **D-Bus caching issue**: Unit properties available via GetUnitProperties but RestartUnit fails\n2. **Timing window**: Unit exists during verification but not during restart (generator race?)\n3. **Connection state**: Units may be available on one connection but not another\n4. **Quadlet generator**: Generator may create units in a different place than systemd expects\n\n## Impact\nAll services fail to restart, requiring manual systemd daemon-reload and restart.\n\n## Next Steps\n1. Check if GetUnitProperties uses different D-Bus call than RestartUnit\n2. Add logging to see actual unit availability at each stage\n3. Consider if Reload() needs additional time to process\n4. Check if units are being written to the correct path for the generator\n5. Investigate if this is a userMode-specific issue","design":"## Investigation Results\n\nThe code already implements `waitForUnitGeneration()` with exponential backoff retry (lifecycle.go lines 374-426) and it's being called from `RestartMany()` (lines 439-449).\n\nHowever, the logs show:\n- waitForUnitGeneration succeeds and logs \"Unit generated successfully\"\n- But immediately after (4ms later), RestartUnit fails with \"Unit not found\"\n\nThis suggests:\n1. **D-Bus connection issue**: GetUnitProperties and RestartUnit may use different connection states or caching\n2. **Reload() still processing**: Despite waitForUnitGeneration succeeding, systemd might still be processing\n3. **Missing additional synchronization**: Need to wait for systemd units to be fully available to RestartUnit\n\n## Proposed Fix\nInstead of just verifying GetUnitProperties succeeds, also:\n1. Add a small additional delay after all verifications complete (e.g., 50-100ms)\n2. Or: Try to actually call the unit operation (e.g., GetUnitProperty for ActiveState) to ensure it's fully loaded\n3. Or: Call systemd's `ReloadContext()` again after waiting for generators\n4. Consider if Reload() needs to be replaced with a different systemd call that waits for generators","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T12:02:18.603617082-05:00","updated_at":"2025-11-09T12:27:25.756689964-05:00","closed_at":"2025-11-09T12:27:25.756689964-05:00","source_repo":".","labels":["bug","critical","systemd"]}
{"id":"quad-ops-5ph","content_hash":"e79a82b698bf8117fabde73690cb9cbc1cb7f96cdba24594cf1a8fdd321388b8","title":"Fix flaky TestBuildPodmanArgs_NetworkOrdering test on macOS","description":"The test TestBuildPodmanArgs_NetworkOrdering in internal/platform/launchd/podmanargs_test.go is failing on macOS (job 54885760713, run 19199698241).\n\nThe test calls BuildPodmanArgs three times with different container names (\"test-1\", \"test-2\", \"test-3\") but then asserts that the full args are equal. This is incorrect because:\n\n1. The container names differ between calls (\"test-1\" vs \"test-2\" vs \"test-3\")\n2. The full args comparison will always fail when container names are different\n3. The test's intent is to verify that network ordering is consistent across calls, not that entire args match\n\nThe test error shows:\n- Line 1029: expected test-1 name, actual test-2\n- Line 1030: expected test-2 name, actual test-3\n\nThis indicates the container names are non-deterministic or being incremented unexpectedly.\n\nFix: Either pass the same container name to all three BuildPodmanArgs calls, or only compare the network ordering portion of the args.","acceptance_criteria":"- Test passes consistently on macOS\n- Network ordering is verified to be deterministic across multiple calls\n- Test clearly documents whether it's testing name consistency or network ordering","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-08T17:54:29.977845813-05:00","updated_at":"2025-11-08T17:56:14.638270228-05:00","closed_at":"2025-11-08T17:56:14.638270228-05:00","source_repo":"."}
{"id":"quad-ops-5pku","content_hash":"42d8de20b37996d44271455b12dcfb9d5aafae1d5b07c5044e1fff5dbf69ccb5","title":"Update golden test files for ExternalDependencies field","description":"Update golden test expected outputs to include the new ExternalDependencies field added to service.Spec in quad-ops-dep5.\n\n**Current State:**\n- 8 golden tests failing in internal/compose/golden_test.go\n- All failures show same pattern: expected 7 fields, got 8 fields\n- New field \"ExternalDependencies\": interface{}(nil) appears in actual output\n\n**Failing Tests:**\n1. TestConverter_Golden/basic-multi-service\n2. TestConverter_Golden/env-precedence\n3. TestConverter_Golden/healthcheck-variants\n4. TestConverter_Golden/mounts-matrix\n5. TestConverter_Golden/ports-matrix\n6. TestConverter_Golden/resources-limits\n7. TestConverter_Golden/security-and-user\n8. (parent test) TestConverter_Golden\n\n**Root Cause:**\nThe ExternalDependencies field was added to service.Spec in quad-ops-dep5 to support cross-project dependencies via x-quad-ops-depends-on extension. Golden files contain serialized expected outputs that need updating.\n\n**Solution:**\nUpdate golden files in internal/compose/testdata/golden/ to include the ExternalDependencies field in their expected service spec outputs. For test cases without external dependencies, the field should be `\"ExternalDependencies\": interface{}(nil)` or `\"ExternalDependencies\": []interface{}{}`.","acceptance_criteria":"**Acceptance Criteria:**\n- All 8 golden tests pass\n- Golden files correctly show ExternalDependencies field\n- No other changes to golden file structure\n- `task test` passes completely with 0 failures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T13:43:30.048984-05:00","updated_at":"2025-11-12T13:45:09.945924-05:00","closed_at":"2025-11-12T13:45:09.945924-05:00","source_repo":"."}
{"id":"quad-ops-5re","content_hash":"e8ebc07534aa4675e671437438ed1169b98ea0813957d8e5d6aca1de8cacaaef","title":"Verify resource constraint mapping completeness (memory/cpu/pids)","description":"Ensure convertResources and addResources fully map all Deploy.Resources fields including memory, reservation, swap, cpu shares/quota/period, and pids_limit. Verify corresponding Quadlet directives are emitted.","design":"Audit spec_converter.go:convertResources and renderer.go:addResources. Cross-reference with v0.21.2 resource handling. Add any missing mappings.","acceptance_criteria":"- All resource fields from v0.21.2 are supported\n- Memory, CPU, and pids constraints work correctly\n- Test coverage for all resource types","notes":"RESEARCH COMPLETE\n\n## Current Implementation Status (v0.22.0)\n\n**Supported Resource Fields:**\n- ✅ Memory (limits) - Quadlet native directive\n- ✅ MemoryReservation (reservations) - Quadlet native directive  \n- ✅ MemorySwap - Quadlet native directive\n- ✅ CPUShares - via PodmanArgs\n- ✅ CPUQuota - via PodmanArgs\n- ✅ CPUPeriod - via PodmanArgs\n- ✅ PidsLimit - Quadlet native directive\n\n## v0.21.2 Implementation\n\nUsed PodmanArgs for ALL resource constraints, logged as \"unsupported features\" warnings. Resource fields were populated but always rendered as PodmanArgs.\n\n## Quadlet Native Directives (podman-systemd.unit)\n\n**Only 2 resource directives supported natively:**\n- `Memory=` (maps to `--memory`)\n- `PidsLimit=` (maps to `--pids-limit`)\n\n**NOT supported as native Quadlet directives:**\n- MemoryReservation, MemorySwap, CPUShares, CPUQuota, CPUPeriod (must use PodmanArgs)\n\n## Podman CLI Resource Arguments (all available)\n\n- `--cpus=\u003cnumber\u003e` (shorthand, conflicts with --cpu-quota/--cpu-period)\n- `--cpu-shares=\u003cshares\u003e` (relative weight, default 1024)\n- `--cpu-quota=\u003cmicroseconds\u003e` (CFS quota limit)\n- `--cpu-period=\u003cmicroseconds\u003e` (CFS period, default 100000)\n- `--memory=\u003csize\u003e` (hard limit)\n- `--memory-reservation=\u003csize\u003e` (soft limit)\n- `--memory-swap=\u003csize\u003e` (memory+swap, -1 for unlimited)\n- `--pids-limit=\u003climit\u003e` (default 2048, -1 for unlimited)\n\n## Completeness Analysis\n\n| Resource Field | Compose Field | Converted? | Rendered? | Issue |\n|----------------|---------------|------------|-----------|-------|\n| Memory | deploy.resources.limits.memory | ✅ | ✅ Native | OK |\n| MemoryReservation | deploy.resources.reservations.memory | ✅ | ❌ | **BUG: Parsed but not rendered** |\n| MemorySwap | compose top-level memswap_limit | ❌ | ❌ | **Missing from converter** |\n| CPUShares | deploy.resources.reservations.cpus | ❌ | ✅ (if set) | **Missing derivation** |\n| CPUQuota | deploy.resources.limits.cpus (NanoCPUs) | ✅ | ✅ PodmanArgs | OK |\n| CPUPeriod | deploy.resources.limits.cpus (NanoCPUs) | ✅ | ✅ PodmanArgs | OK |\n| PidsLimit | deploy.resources.limits.pids | ✅ | ✅ Native | OK |\n\n## Critical Findings\n\n1. **MemoryReservation BUG**: Converted in spec_converter.go L289 but renderer.go L441-443 uses native Quadlet directive `MemoryReservation=` which does NOT exist in podman-systemd.unit(5). MUST use PodmanArgs.\n\n2. **MemorySwap BUG**: Converter doesn't check for memswap_limit or derive from Memory. Renderer.go L445-447 uses `MemorySwap=` which also does NOT exist as native directive.\n\n3. **CPUShares**: Not derived from deploy.resources.reservations.cpus (NanoCPUs). v0.21.2 derived from Limits if not set.\n\n## Required Fixes\n\n1. Change MemoryReservation rendering to use PodmanArgs (not native directive)\n2. Change MemorySwap rendering to use PodmanArgs (not native directive)  \n3. Add MemorySwap conversion from Compose (check types.ServiceConfig for memswap_limit)\n4. Add CPUShares derivation from reservations.NanoCPUs (if limits not set)\n\n## References\n\n- Quadlet docs: https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html\n- Podman run args: https://docs.podman.io/en/v5.0.1/markdown/podman-run.1.html\n- v0.21.2 implementation: internal/unit/container.go processMemoryConstraints, processCPUConstraints\n\n---\n\n## IMPLEMENTATION COMPLETE\n\n### Changes Made\n\n1. **Fixed MemoryReservation rendering** (renderer.go L442)\n   - Changed from `MemoryReservation=\u003cvalue\u003e` (invalid Quadlet directive)\n   - To: `PodmanArgs=--memory-reservation \u003cvalue\u003e` (correct Podman flag)\n\n2. **Fixed MemorySwap rendering** (renderer.go L446)\n   - Changed from `MemorySwap=\u003cvalue\u003e` (invalid Quadlet directive)\n   - To: `PodmanArgs=--memory-swap \u003cvalue\u003e` (correct Podman flag)\n\n3. **Added MemorySwap conversion** (spec_converter.go L293-296)\n   - Now reads `memswap_limit` from service-level field\n   - Converts to formatted bytes and sets `resources.MemorySwap`\n\n4. **Added CPUShares derivation** (spec_converter.go L290-293, L332-341)\n   - New `convertCPUShares()` function converts NanoCPUs to CPU shares\n   - Formula: `nanoCPUs * 1024` (e.g., 0.5 CPUs = 512 shares)\n   - Derives from `deploy.resources.reservations.cpus`\n\n5. **Updated function signature** (spec_converter.go L264)\n   - `convertResources()` now takes `svc types.ServiceConfig` parameter\n   - Needed to access service-level `memswap_limit` field\n\n6. **Updated tests**\n   - Fixed test expectations for PodmanArgs format\n   - Updated golden file for resources-limits (CPUShares: 0 → 512)\n   - All tests passing ✅\n   - Linter clean ✅\n\n### Verification\n\n- `task test` - All 1109 tests pass\n- `task lint` - No issues\n- Coverage maintained at 78.3% (compose), 59.0% (systemd)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T13:44:34.810413-05:00","updated_at":"2025-11-09T15:50:38.346599-05:00","closed_at":"2025-11-09T15:50:38.346599-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-5re","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.810887-05:00","created_by":"daemon"}]}
{"id":"quad-ops-5w6","content_hash":"c290e887fe6e7073b4d07bf78133213e804196a03de27c034831184b351d74e4","title":"Create shared podman args builder to eliminate systemd/launchd duplication","description":"**Anti-pattern identified:** Both systemd and launchd build podman arguments independently, duplicating ~200 lines of logic.\n\n**Current state:**\n- internal/platform/systemd/* - builds podman args\n- internal/platform/launchd/* - duplicates the same logic\n- Both renderers independently format ports, mounts, env, resources, etc.\n\n**Target architecture:**\nCreate single shared builder:\n- **File:** internal/platform/podman_args.go\n- **Function:** BuildPodmanArgs(spec service.Spec, containerName string) []string\n- **Usage:** Both systemd and launchd import and use this\n\n**Benefits:**\n- Eliminates ~200 lines of duplication\n- Single source of truth for podman CLI formatting\n- Easier to maintain and test\n- Aligns with full-pipeline-simplification.md Phase 2\n\n**Effort:** Medium (1-3 hours)\n- Create shared builder\n- Update systemd to use it\n- Update launchd to use it  \n- Delete duplicate implementations\n- Verify tests pass\n\n**Reference:** Oracle review anti-patterns section, full-pipeline-simplification.md Phase 2","status":"closed","priority":1,"issue_type":"task","assignee":"amp","created_at":"2025-11-11T17:05:30.792286-05:00","updated_at":"2025-11-11T17:21:10.819332-05:00","closed_at":"2025-11-11T17:21:10.819332-05:00","source_repo":"."}
{"id":"quad-ops-5wg","content_hash":"652d04ee7972a72fc9ddc9bf8751c37fb79e016aeac0c6d56fb6f7c8ec4f26a3","title":"Implement dependency ordering in launchd lifecycle operations","description":"Modify launchd StartMany, StopMany, and RestartMany to process services in dependency order. Currently they iterate without respecting order, but since dependencies aren't expressed in plists, ordering must be enforced at the lifecycle level.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T23:26:25.018837448-05:00","updated_at":"2025-11-12T11:58:50.974853-05:00","closed_at":"2025-11-12T11:58:50.974853-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-5wg","depends_on_id":"quad-ops-9y2","type":"blocks","created_at":"2025-11-06T23:26:25.023159375-05:00","created_by":"daemon"}]}
{"id":"quad-ops-6","content_hash":"a13a0983030746e5e50dafc7f2f20010b98c4cd55f78e4af114e5a5f471c2b05","title":"Phase 5: Consolidate 16 test files to 8 table-driven test files","description":"Consolidate scattered test files into focused table-driven test files.\n\n**Current state:**\n- Fragmented test files across compose, systemd, launchd packages\n- Many tests validate implementation details instead of behavior\n- Difficult to see what's tested and what's missing\n\n**Target state:**\n- Focused table-driven tests per component\n- Tests validate behavior (input→output), not internals\n- Easy to read, easy to add new cases\n- Tests serve as documentation\n\n**Consolidation plan:**\n- Keep golden tests (essential for byte-for-byte validation)\n- Keep lifecycle tests (D-Bus/launchctl integration)\n- Merge scenario-based tests into table-driven or golden tests\n- Remove tests of private implementation details","acceptance_criteria":"✅ All tests use table-driven format with clear test case structures\n✅ Tests validate behavior (input→output), not internal implementation details\n✅ Coverage maintained or improved vs. current test suite\n✅ go test ./... passes\n✅ No reduction in test coverage: compare to baseline_coverage.out\n✅ Tests are readable and serve as documentation","notes":"**Progress: systemd renderer tests consolidated**\n\nConsolidated internal/platform/systemd/renderer_test.go:\n- TestRequiresMountsFor: 4 separate tests → 1 table-driven test with 4 cases\n- TestNetworkOnlineTarget: 4 separate tests → 1 table-driven test with 4 cases\n- TestRenderer_Sysctls: 3 separate tests → 1 table-driven test with 4 cases (including \"no sysctls\" case)\n\n**Results:**\n- Reduced from 15 test functions → 7 test functions (53% reduction)\n- All tests pass with consistent table-driven pattern\n- Coverage maintained at 67.0%\n- Tests now use t.Run() for clear subtest reporting\n- Easy to add new test cases by adding to the table\n\n**Table-driven pattern benefits:**\n- Consistent structure across all tests\n- Clear test case names for debugging\n- Reduced code duplication\n- Easy to add new test cases\n- Tests serve as documentation\n\n**Next steps:**\n- Consider adding t.Parallel() to table-driven tests for faster execution\n- Apply same pattern to other test files (launchd, compose)\n- Look for other opportunities to consolidate related tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:29:30.104936851-05:00","updated_at":"2025-11-11T18:48:19.018823-05:00","closed_at":"2025-11-11T18:48:19.018823-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-6","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.955376148-05:00","created_by":"daemon"},{"issue_id":"quad-ops-6","depends_on_id":"quad-ops-4","type":"blocks","created_at":"2025-11-11T10:09:01.92945-05:00","created_by":"daemon"},{"issue_id":"quad-ops-6","depends_on_id":"quad-ops-5","type":"blocks","created_at":"2025-11-11T10:09:01.933137-05:00","created_by":"daemon"}]}
{"id":"quad-ops-69e","content_hash":"be2807276507f3f1352e7353592e657f00dac65b0957d7534bca8b5512561298","title":"Extract service-level network declarations from compose services","description":"Update SpecConverter to extract which specific networks each service should be connected to from composeService.Networks map.\n\nCurrently convertService() only passes project-level networks to the spec. Need to:\n1. Read composeService.Networks map (service-level network declarations)\n2. Resolve network names with proper prefixing \n3. Store in service spec so renderers know which networks this service joins\n\nThis data should replace or supplement the current project-level-only networks approach.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T15:57:56.155050384-05:00","updated_at":"2025-11-08T16:50:41.425912679-05:00","closed_at":"2025-11-08T16:50:41.425912679-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-69e","depends_on_id":"quad-ops-cn8","type":"blocks","created_at":"2025-11-08T15:57:56.159836782-05:00","created_by":"daemon"}]}
{"id":"quad-ops-6cz","content_hash":"b9fa91c8208afaa31445e728eccf1596adcefe2c3ebb334606e1623fcbe274a0","title":"Restore Linux volume units functionality","description":"The systemd platform should properly render separate .volume unit files for named volumes from the service spec. Currently volumes are only handled as part of container mounts.\n\nNeed to:\n- Ensure renderService creates separate artifacts for volumes in spec.Volumes\n- Implement proper Quadlet volume unit rendering with all supported options\n- Add volume dependencies to container units (After/Requires)\n- Test that volume units are created and managed properly\n\nThis restores the Linux-specific volume management that was lost in the cross-platform abstraction.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-06T21:39:27.372788067-05:00","updated_at":"2025-11-06T21:56:42.2179633-05:00","closed_at":"2025-11-06T21:56:42.2179633-05:00","source_repo":".","labels":["linux","platform-specific","quadlet","volumes"]}
{"id":"quad-ops-6dn","content_hash":"446d4432602a3c4ee515890eedf086583a256b13061488a33bb61b900d4d7e0f","title":"Implement macOS volume management for feature parity","description":"While macOS launchd cannot create separate volume units like systemd, we can implement volume lifecycle management to provide better parity.\n\nNeed to:\n- Research if Podman on macOS supports named volume management\n- Implement volume creation/deletion commands for macOS platform\n- Add volume validation and lifecycle hooks to launchd platform\n- Update status reporting to include volume information\n- Test volume operations work correctly on macOS\n\nThis would provide basic volume management functionality on macOS, even if not as rich as Linux Quadlet volumes.","design":"### Volume Management Research Phase\n- Investigate Podman macOS volume support through documentation and testing\n- Determine if named volumes are supported and how they differ from Linux\n- Assess volume persistence, location, and management commands available\n- Document findings in issue notes for implementation decisions\n\n### Volume Model Extensions\n- Add VolumeSpec struct to internal/service/models.go for macOS volume definitions\n- Extend launchd platform structs to include volume lifecycle hooks\n- Add volume validation methods to internal/service/validate.go\n- Ensure volume specs are parsed from compose files and included in service specs\n\n### Platform Implementation\n- Implement volume creation/deletion in internal/platform/launchd/volume.go\n- Add volume lifecycle hooks to launchd platform manager\n- Integrate volume operations into StartMany/StopMany/RestartMany commands\n- Handle volume dependencies during service orchestration (though launchd doesn't support unit-level dependencies like systemd)\n\n### Status Reporting Updates\n- Extend status reporting to include volume information in launchd platform\n- Add volume status fields to Status struct (created, available, size, etc.)\n- Update CLI status command to display volume information on macOS\n- Ensure volume status integrates with existing status reporting workflow\n\n### Testing Implementation\n- Add unit tests for volume operations in launchd platform\n- Create integration tests using test compose files with volumes\n- Test volume lifecycle management across service operations\n- Validate volume persistence and cleanup behavior\n\n### Command Integration\n- Add volume-specific CLI commands if needed (create, remove, list volumes)\n- Integrate volume management into existing up/down/sync workflows\n- Ensure volume operations are logged appropriately\n- Handle volume errors gracefully with clear user feedback\n\n### Cross-Platform Considerations\n- Maintain API compatibility with Linux volume management where possible\n- Document platform differences in volume capabilities clearly\n- Ensure compose files work on both platforms (with appropriate warnings for unsupported features)\n- Consider fallback behaviors for macOS-specific limitations","acceptance_criteria":"### Research Validation\n- Podman macOS volume support is documented and understood\n- Volume capabilities and limitations are clearly identified\n- Implementation approach is validated through testing\n\n### Volume Lifecycle Management\n- Volume creation/deletion commands work correctly on macOS\n- Volumes persist across container restarts as expected\n- Volume cleanup happens appropriately when services are removed\n\n### Integration Testing\n- Test compose files with volumes deploy successfully on macOS\n- Volume mounting works correctly in containers\n- Service operations (start/stop/restart) handle volumes properly\n- No regressions in existing functionality\n\n### Status and Monitoring\n- Status command shows volume information on macOS\n- Volume status is accurate and up-to-date\n- Error conditions are reported clearly\n\n### User Experience\n- Volume operations provide clear success/error feedback\n- Platform differences are communicated through warnings or documentation\n- Volume management integrates seamlessly with existing workflows\n\n### Code Quality\n- Unit test coverage for volume operations \u003e80%\n- No linting or security issues introduced\n- Code follows existing patterns and conventions\n- Documentation updated to reflect new capabilities","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-06T21:39:34.016022681-05:00","updated_at":"2025-11-11T20:08:54.648162-05:00","closed_at":"2025-11-11T20:08:54.648162-05:00","source_repo":".","labels":["macos","parity","podman","volumes"],"dependencies":[{"issue_id":"quad-ops-6dn","depends_on_id":"quad-ops-6cz","type":"related","created_at":"2025-11-06T21:39:45.285584306-05:00","created_by":"daemon"}]}
{"id":"quad-ops-6ph","content_hash":"2c2a9f615ab2a9c94c7be7db58b6161e9b07cb7bf8c1d413b70b1b7c1f432850","title":"Fix external network name resolution with project prefix","description":"## Problem\nWhen services reference external networks from other projects, the network name resolution incorrectly applies the current project's prefix, breaking systemd unit generation.\n\n### Root Cause (Regression from macOS Refactor)\nThis is a **regression introduced in commit 297a310** (\"Extract service-level network declarations from compose services\") which was part of the macOS refactor.\n\nIn `internal/compose/spec_converter.go`, the `convertServiceNetworksList` function checks if a network exists in the project's network definitions. For external networks marked as such in compose files, it incorrectly applies the current project's prefix:\n\n```go\nprojectNet, exists := project.Networks[networkName]\nif !exists {\n    resolvedName := service.SanitizeName(networkName)\n    if !strings.Contains(networkName, project.Name) {\n        resolvedName = service.SanitizeName(Prefix(project.Name, networkName))  // BUG HERE\n    }\n}\n```\n\nThis results in:\n- Compose file declares: `infrastructure-proxy` (external network from infrastructure project)\n- Code adds project prefix: `llm-infrastructure-proxy` (wrongly adds `llm-` prefix)\n- Actual network unit: `infrastructure_proxy.network` (created from infrastructure project with underscore)\n- Result: systemd unit references non-existent `llm-infrastructure-proxy.network`\n\n### Affected Services\nAny service that uses external networks from different projects:\n- llm services using `infrastructure-proxy`\n- scrutiny/dozzle/miniflux services using `infrastructure-proxy`\n- media services using `infrastructure-proxy`\n- beszel services using `infrastructure-proxy`\n\n### Evidence\nGenerated unit file: `~/.config/containers/systemd/llm-open-webui.container` references:\n```\nRequires=llm-infrastructure-proxy.network\nNetwork=llm-infrastructure-proxy.network\n```\n\nBut only `infrastructure_proxy.network` exists.\n\n## Solution\nFor external networks, use the network name as-is without applying the current project's prefix. The network name already encodes the source project context (e.g., 'infrastructure-proxy' explicitly identifies the infrastructure project's proxy network).","notes":"PROGRESS: Implemented DNS-compliant unit name normalization (quad-ops-6rg) which replaces underscores with hyphens. This addresses the symptom where 'infrastructure_proxy.network' (with underscore) mismatched generated references. With quad-ops-6rg complete, all unit names now use hyphens consistently. Next: fix the root cause - prevent incorrect project prefix application to external networks in convertServiceNetworksList().","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T10:36:36.957959578-05:00","updated_at":"2025-11-09T10:46:09.89830779-05:00","closed_at":"2025-11-09T10:46:09.89830956-05:00","source_repo":"."}
{"id":"quad-ops-6rg","content_hash":"53a6a43e6b91b398d5c9db1ba8ab03d860e11e79c4c1023f7529155964c929b3","title":"Normalize unit names: replace underscores with hyphens or validate DNS compliance","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T10:42:54.337167624-05:00","updated_at":"2025-11-09T10:44:24.676887748-05:00","closed_at":"2025-11-09T10:44:24.676887748-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-6rg","depends_on_id":"quad-ops-6ph","type":"discovered-from","created_at":"2025-11-09T10:42:54.337820828-05:00","created_by":"daemon"}]}
{"id":"quad-ops-6sz","content_hash":"bc09a98c5a8e7b509e048ab93ff2ccb039f11dd00c1f055ae374cbeb1eeeba51","title":"Add unit existence verification with retry before restart","description":"Implement defensive programming to handle timing issues with systemd generator.\n\n## Changes Needed\n\n**In Lifecycle.RestartMany()**:\n```go\n// After Reload(), verify units exist before restarting\nfor name := range servicesToRestart {\n    if err := l.waitForUnitGeneration(ctx, name); err != nil {\n        // Unit generator failed or took too long\n        // Return error with diagnostic info\n    }\n}\n```\n\n**New method: waitForUnitGeneration()**:\n- Check if `.service` unit exists (via systemd D-Bus GetUnitProperties)\n- Retry with exponential backoff (50ms → 100ms → 200ms... up to 5 seconds)\n- Provide clear error if unit never appears\n- Log retry attempts at DEBUG level\n\n**Configuration**:\n- Make retry timeout configurable (default 5s)\n- Log progress at INFO level so users see what's happening\n\nThis gives the generator time to run while failing fast with good diagnostics if something is wrong.","acceptance_criteria":"Implement unit existence check with exponential backoff retry in RestartMany(). Add configuration options. Write tests verifying retry behavior and timeout handling.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T21:16:25.396706837-05:00","updated_at":"2025-11-09T10:22:40.634258198-05:00","closed_at":"2025-11-09T10:22:40.634258198-05:00","source_repo":".","labels":["resilience","systemd","task"]}
{"id":"quad-ops-7","content_hash":"b6397ac88604df1b55d7811e10bcf0d1cf65760ae3e58e8a271542c71419bdd6","title":"Phase 6-7: Verify all tests pass, coverage maintained, golden tests pass, clean up documentation","description":"Final verification phase: Ensure all tests pass, coverage maintained, golden tests verify output equivalence, and clean up documentation.\n\nIntegration verification:\n- Run complete test suite: task test\n- Verify all quality gates: task build (includes fmt, lint, test)\n- Run golden tests to ensure byte-for-byte output equivalence\n- Compare coverage to baseline_coverage.out (no reduction allowed)\n\nGolden test verification:\n- Generated systemd units (.container, .network, .volume) must be byte-identical to pre-simplification\n- Generated launchd plists (.plist) must be byte-identical to pre-simplification\n- Use existing golden test fixtures or create comparison snapshots\n\nQuality gates:\n- gofmt: All code formatted consistently\n- golangci-lint: All linters pass (errcheck, govet, staticcheck, unused, revive, gosec, misspell)\n- go test ./...: All unit and integration tests pass\n- Coverage: No reduction from baseline\n\nDocumentation cleanup (minimal):\n- Update package godocs if public APIs changed (they shouldn't)\n- Add examples to key conversion functions if helpful\n- Touch documentation only if behavior visibly changed to users\n\nReference: history/implementation-checklist.md Phase 6-7","acceptance_criteria":"✅ task build passes (fmt + lint + test + compile)\n✅ task test passes with all unit and integration tests\n✅ Golden tests pass: generated artifacts byte-identical to pre-simplification\n✅ Coverage maintained: diff baseline_coverage.out vs. new coverage shows no reduction\n✅ golangci-lint run passes with zero errors\n✅ go fmt ./... makes no changes (code already formatted)\n✅ Real compose files from examples/ directory work correctly\n✅ CLI commands work identically: sync, up, down, validate, list\n✅ Package documentation updated if needed (minimal changes expected)\n✅ Final metrics achieved: 12,432 → ≤2,750 lines (78% reduction)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:29:30.105580564-05:00","updated_at":"2025-11-11T20:11:13.452631-05:00","closed_at":"2025-11-11T20:11:13.452631-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-7","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T01:28:46.965028704-05:00","created_by":"daemon"},{"issue_id":"quad-ops-7","depends_on_id":"quad-ops-6","type":"blocks","created_at":"2025-11-11T10:09:01.937229-05:00","created_by":"daemon"}]}
{"id":"quad-ops-712","content_hash":"aa32eb2b27a9693ea63d5f940f3c24710a194eace0ba5404795ccaffea9f8a43","title":"Fix Quadlet generator: volume name escaping and missing network dependencies","description":"The systemd Quadlet generator is producing invalid unit file declarations causing quadlet-generator errors. Analysis against official Podman documentation reveals multiple bugs:\\n\\n## Bug 1: Volume reference incorrectly includes `.volume` suffix\\n\\n**Podman docs state:** When referencing a named volume in `Volume=` directive, if SOURCE-VOLUME ends with `.volume`, Quadlet will look for that file and create a dependency. The volume file must exist.\\n\\n**Current behavior:** The renderer (line 290-291 in renderer.go) appends `.volume` to volume sources:\\n```go\\nif m.Type == service.MountTypeVolume {\\n    source = source + \\\".volume\\\"  // ❌ Creates Volume=miniflux_db-data.volume\\n}\\n```\\n\\n**Expected behavior:** Should NOT append `.volume` suffix. Quadlet resolves the reference automatically:\\n- Correct: `Volume=miniflux-db-data:/path/in/container`\\n- Incorrect: `Volume=miniflux_db-data.volume:/path/in/container`\\n\\n**Effect:** Quadlet generator fails because it's looking for a volume named `miniflux_db_data` (with .volume suffix and underscores) when the actual volume file is `miniflux-db-data.volume`.\\n\\n## Bug 2: Volume source names use underscores instead of hyphens\\n\\n**Location:** `internal/compose/spec_converter.go` lines 236 and 248\\n\\n**Current behavior:**\\n```go\\nmount.Source = fmt.Sprintf(\\\"%s_%s\\\", project.Name, v.Source)  // ❌ Uses underscore\\n```\\n\\n**Expected behavior:** Use the `Prefix()` helper function that uses hyphens:\\n```go\\nmount.Source = compose.Prefix(project.Name, v.Source)  // ✅ Creates miniflux-db-data\\n```\\n\\n**Effect:** The volume source names don't match the actual volume names created with `SanitizeName()` which converts underscores to hyphens.\\n\\n## Summary\\n\\nCorrect Quadlet output should be:\\n```ini\\n[Unit]\\nAfter=miniflux-db-data.volume\\nRequires=miniflux-db-data.volume\\n\\n[Container]\\nVolume=miniflux-db-data:/var/lib/postgresql/data\\n```\\n\\nCurrent broken output is:\\n```ini\\n[Unit]\\nAfter=miniflux-db-data.volume\\nRequires=miniflux-db-data.volume\\n\\n[Container]\\nVolume=miniflux_db-data.volume:/var/lib/postgresql/data\\n```\\n\\nQuadlet generator error: \\\"requested Quadlet source miniflux_db-data.volume was not found\\\"\",\n\u003cparameter name=\"priority\"\u003e1\u003c/parameter\u003e\n\u003c/invoke\u003e","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-09T12:19:23.533646599-05:00","updated_at":"2025-11-09T12:25:42.006522977-05:00","closed_at":"2025-11-09T12:25:42.006522977-05:00","source_repo":".","labels":["bug","quadlet","renderer","systemd"]}
{"id":"quad-ops-782","content_hash":"79878be36dedac48e157eef0ad0fd6008a2b2897edea0e9f8e2cbcb00a5e3d41","title":"Unit file references use wrong name format (hyphens vs underscores)","description":"Container unit files (.container) specify dependencies on networks and volumes using names that don't match the actual rendered unit files.\n\n**Root Cause Identified:**\n\nThe issue stems from a mismatch between network names in two contexts:\n\n1. **spec.Networks** - The actual network specifications that get rendered to `.network` files with names like `infrastructure_proxy` (containing underscores from project prefixing)\n\n2. **spec.Container.Network.ServiceNetworks** - The network references used by containers for dependencies, which come from compose service declarations and may use different naming (like `infrastructure-proxy` from external network declarations)\n\n**Concrete Example:**\n- Infrastructure project has a network `proxy` which becomes `infrastructure-proxy` (via Prefix function)\n- After sanitization through SanitizeName, this becomes `infrastructure-proxy` (hyphens preserved)\n- But when rendered to a `.network` file, it becomes `infrastructure_proxy.network`\n- However, when other projects (llm, devops, media) declare `infrastructure-proxy` as an external network, their ServiceNetworks contains `infrastructure-proxy`\n- Container units then reference `After=infrastructure-proxy.network` but the actual file is `infrastructure_proxy.network`\n- Quadlet generator can't find the dependency and fails with: \"unable to translate dependency for infrastructure-proxy.network\"\n\n**Why this happens:**\n- Network unit files are created from `spec.Networks` entries (which have sanitized names)\n- Container dependencies are built from `spec.Container.Network.ServiceNetworks` (which come from compose declarations)\n- These two paths don't guarantee name alignment - sanitization rules may differ or be applied at different stages\n- There's no lookup mechanism to resolve `ServiceNetworks` names to their actual `spec.Networks` equivalents\n\n**Impact:**\n- Quadlet's podman-system-generator fails to convert `.container` files to `.service` units\n- Services cannot be started because systemd can't find the generated service files\n- 11 services fail to start in test run","design":"The issue is in the dependency reference generation in the systemd renderer. When rendering container units, dependencies should reference the sanitized unit names (with underscores) not the original network/volume names (with hyphens). \n\nLocation likely: `internal/platform/systemd/renderer.go` where After/Requires directives are built from network/volume names.","notes":"DIAGNOSED: Root cause is name mismatch between spec.Networks (where unit files get their names) and spec.Container.Network.ServiceNetworks (where container dependencies get their names). Sanitization/prefixing may apply differently causing misalignment.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T16:33:56.577089761-05:00","updated_at":"2025-11-10T01:00:03.443461-05:00","closed_at":"2025-11-10T01:00:03.443461-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-782","depends_on_id":"quad-ops-hlf","type":"blocks","created_at":"2025-11-09T16:33:56.577895752-05:00","created_by":"daemon"}]}
{"id":"quad-ops-79g","content_hash":"f442117d19e2493fc7cc8caccadc6c6490a08a5d059b1b0820898d3547224d6c","title":"Documentation Review and Updates Epic","description":"Review and update the site/ documentation to address out-of-date information, missing sections, and inconsistencies with the current codebase implementation.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-11-06T23:24:03.079115476-05:00","updated_at":"2025-11-06T23:24:03.079115476-05:00","source_repo":".","labels":["documentation","review","site"]}
{"id":"quad-ops-7fz","content_hash":"fd97a7274d6402fa6df8a2967e4a5ae8176ee88f42f5c3013ae069ac319f0823","title":"Implement x-quad-ops-init extension support","description":"The init-containers example uses x-quad-ops-init extension to define init containers that run before the main service. This extension is documented but not implemented.\n\nNeed to:\n- Add InitContainers field to service.Spec model\n- Modify spec_converter.go to process x-quad-ops-init from project.Extensions\n- Generate separate service specs for each init container\n- Ensure proper systemd dependencies (After/Requires) between init containers and main service\n- Handle sequential execution of init containers\n\nExtension format:\n```yaml\nx-quad-ops-init:\n  - image: docker.io/example/image:tag\n    command: run this command\n  - image: another/image:tag\n    command: [\"sh\", \"-c\", \"multi word command\"]\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-06T21:36:14.961358574-05:00","updated_at":"2025-11-06T21:45:42.057268667-05:00","closed_at":"2025-11-06T21:45:42.057268667-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-7fz","depends_on_id":"quad-ops-1n4","type":"blocks","created_at":"2025-11-06T21:36:14.965800422-05:00","created_by":"daemon"}]}
{"id":"quad-ops-7h1u","content_hash":"3cbef4fb66d0366c4f3be8293b9d8534830f1d0fd22ec05a558c465eabf629b4","title":"Phase 2 go-cmp migration: Platform tests (systemd renderer)","description":"","design":"Migrated internal/platform/systemd/renderer_golden_test.go to use cmp.Diff for golden file comparisons. Provides better diffs showing exact line-by-line changes when generated Quadlet unit files don't match expected output. Reviewed internal/platform/launchd/plist_test.go - correctly uses assert.Contains for XML validation, no changes needed.","acceptance_criteria":"All 941 tests passing. Golden test migration provides clearer failure diagnostics when unit file generation differs from expected output.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T10:08:08.639614-05:00","updated_at":"2025-11-12T10:08:11.901304-05:00","closed_at":"2025-11-12T10:08:11.901304-05:00","source_repo":"."}
{"id":"quad-ops-7l4","content_hash":"a7dfebbf5554eb5e9c85d38f6f873deb445bedd93b55ee12a10d0b0b91226b44","title":"Missing namespace mode support (pid, ipc, cgroup)","description":"Compose pid/ipc/cgroup namespace fields not converted, preventing namespace sharing and host modes.\n\nUse cases:\n- pid: \"service:app\" for debugging with strace\n- ipc: \"shareable\" for X11 forwarding\n- pid: \"host\" for monitoring tools","design":"1. Add PidMode, IpcMode, CgroupMode string fields to service.Container\n2. Convert service.Pid, service.Ipc, service.Cgroup in spec_converter.go:convertContainer()\n3. Render:\n   - systemd: Check if Quadlet supports Pid=/Ipc= directives, else use PodmanArgs\n   - launchd: --pid, --ipc, --cgroupns flags\n\nHandle special values: \"host\", \"service:name\", \"container:name\", \"shareable\"","acceptance_criteria":"- pid/ipc/cgroup modes convert to Container fields\n- Renders correctly on both platforms\n- service: and container: references work\n- host mode works\n- Test coverage for all namespace modes","notes":"Verified Podman support (no native Quadlet directives):\n- podman run --pid (host, container:name, service:name)\n- podman run --ipc (host, container:name, shareable)  \n- podman run --cgroupns (host, private)\n\nImplementation: Use PodmanArgs on both platforms (no Quadlet native directives)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T16:40:17.262469-05:00","updated_at":"2025-11-09T17:38:39.793899-05:00","closed_at":"2025-11-09T17:38:39.793899-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-7l4","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.515264-05:00","created_by":"daemon"}]}
{"id":"quad-ops-7lb","content_hash":"8c8b45982cc8450d21fb0b3b45cc9dfc3176324d0db6c45a0725e48df0dafc6a","title":"Missing group_add support for supplementary groups","description":"Compose group_add field not converted, preventing containers from accessing supplementary groups (docker socket, audio devices, etc.)\n\nExample use case: service needs access to /var/run/docker.sock (group: docker)","design":"1. Add GroupAdd []string field to service.Container (internal/service/models.go)\n2. Convert service.GroupAdd in spec_converter.go:convertSecurity()\n3. Render as PodmanArgs=--group-add \u003cgid\u003e in both renderers\n   - systemd: addSecurity() or addAdvanced()\n   - launchd: BuildPodmanArgs()\n\nEvidence: testdata/golden/security-and-user/compose.yml uses group_add","acceptance_criteria":"- group_add in compose converts to Container.GroupAdd\n- Renders as --group-add flags on both platforms\n- Multiple groups work correctly\n- Test coverage for security scenarios","notes":"Verified Quadlet native support:\n- GroupAdd (native Quadlet directive)\n\nAlso supported via Podman flag:\n- podman run --group-add\n\nImplementation: Use native Quadlet directive on systemd, Podman flag on launchd","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T16:40:17.246822-05:00","updated_at":"2025-11-09T17:29:37.430943-05:00","closed_at":"2025-11-09T17:29:37.430943-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-7lb","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.509526-05:00","created_by":"daemon"}]}
{"id":"quad-ops-7ry","content_hash":"102f46089607c9186d6d08ce4c615c0b340206f3687cdb1b3f33184438ecc79d","title":"non-user mode config init lists user config","description":"❯ ./quad-ops config init\nError executing command: configuration file already exists at /home/trly/.config/quad-ops/config.yaml, use --force to overwrite","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T21:28:46.864721827-05:00","updated_at":"2025-11-06T21:50:10.851385897-05:00","closed_at":"2025-11-06T21:50:10.851385897-05:00","source_repo":"."}
{"id":"quad-ops-7zi","content_hash":"9960b0a614b4bff3caddc4e49e3dc3ffba308bbbaf49e3cbc2f1e575af976d12","title":"Fix: network_mode: host + networks: [] regression from v0.21.2","description":"Multiple services fail with \"cannot set multiple networks without bridge network mode, selected mode host\" error when using network_mode: host with networks: [].\n\nAffected services in test/bdyvp22:\n- monitoring/beszel/docker-compose.yml: agent service\n- monitoring/dozzle/docker-compose.yml: web service  \n- media/docker-compose.yml: immich-server (has ports with mode: host)\n- monitoring/scrutiny/docker-compose.yml: web and collector services\n- news/miniflux/docker-compose.yml: web service\n\n## Regression Details\n\nThis worked in v0.21.2 but broke in later versions. The regression was introduced in commit **f3ddfde** (\"Fix missing network dependencies for containers without explicit networks\") which added logic to populate default networks when no networks are specified.\n\nThe bug is in `internal/compose/spec_converter.go` line 545-559 (convertNetworkMode function):\n\n```go\nif len(networks) == 0 {  // Bug: treats explicit empty same as implicit unspecified\n    for networkName, projectNet := range project.Networks {\n        // ... adds all project networks ...\n    }\n}\n```\n\n## Root Cause\n\nThe compose parser doesn't distinguish between:\n- `networks: nil` (not specified) → should use all project networks\n- `networks: []` (explicitly empty) → should use no networks\n\nWhen a service explicitly sets `networks: []` with `network_mode: host`, the converter still adds project networks (like `default` and `infrastructure-proxy`), resulting in multiple networks in host mode, which Podman rejects.\n\n## Example Problematic Configuration\n\n```yaml\nservices:\n  agent:\n    image: test\n    network_mode: host      # Single network mode\n    networks: []            # Explicitly no networks\n    \nnetworks:\n  default:\n  infrastructure-proxy:\n    external: true\n```\n\nExpected behavior: agent has zero networks (host mode only)\nActual behavior: agent gets [default, infrastructure-proxy] networks + host mode → Podman error\n\n## Solution Approach\n\nNeed to:\n1. Determine how compose parser represents explicit empty networks vs implicit unspecified\n2. Add validation to reject network_mode: host with len(ServiceNetworks) \u003e 1 early with clear error\n3. Fix convertNetworkMode to honor explicit empty networks list\n4. Add test case for network_mode: host + networks: [] scenario","acceptance_criteria":"Services with network_mode: host and networks: [] can be deployed without errors. Validation catches network_mode conflicts early with clear error messages. All test suites pass. No regressions in existing network configurations.","status":"in_progress","priority":1,"issue_type":"bug","created_at":"2025-11-10T09:18:56.337302469-05:00","updated_at":"2025-11-11T09:31:54.234539-05:00","source_repo":"."}
{"id":"quad-ops-8cq","content_hash":"ee51b597b59597300c75936aa37144e1be95c22b591c87e6a3cf5782db1ebe4b","title":"Ensure deterministic output in systemd renderer for golden tests","description":"**Risk identified:** Golden tests can be flaky if renderer output is non-deterministic.\n\n**Problem:**\nMap iteration in Go is non-deterministic, which can cause golden tests to fail intermittently if renderer doesn't sort map-derived outputs.\n\n**Audit and fix:**\nCheck all map iterations in renderer.go, quadlet.go:\n- Environment variables (map[string]string)\n- Labels (map[string]string)  \n- Ports (may be slice, verify order)\n- Mounts (sort by target path)\n- Networks (sort by name)\n- Build args (map[string]string)\n- Sysctls, Security opts, etc.\n\n**Ensure sorted output:**\n```go\n// Bad: non-deterministic\nfor k, v := range env {\n    builder.WriteString(fmt.Sprintf(\"Environment=%s=%s\\n\", k, v))\n}\n\n// Good: deterministic\nkeys := make([]string, 0, len(env))\nfor k := range env {\n    keys = append(keys, k)\n}\nsort.Strings(keys)\nfor _, k := range keys {\n    builder.WriteString(fmt.Sprintf(\"Environment=%s=%s\\n\", k, env[k]))\n}\n```\n\n**Testing:**\nRun golden tests multiple times to verify stability:\n```bash\nfor i in {1..10}; do go test -run TestRenderer_GoldenTests ./internal/platform/systemd/...; done\n```\n\n**Reference:** Oracle review golden test section (ensure deterministic outputs)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T17:05:30.839241-05:00","updated_at":"2025-11-11T17:13:31.256996-05:00","closed_at":"2025-11-11T17:13:31.256996-05:00","source_repo":"."}
{"id":"quad-ops-8m5","content_hash":"651a059e4dceea3499ae2d3036e8a31526b64834af4146ee077269a1c6c0fca3","title":"Document Compose field coverage in README","description":"README doesn't clearly document which Compose fields are supported vs unsupported, causing user confusion.\n\nNeed comprehensive coverage matrix showing:\n- Fully supported fields\n- Partially supported fields (with limitations)\n- Unsupported fields (with alternatives)","design":"Add new section to README.md: \"Compose Specification Support\"\n\nStructure:\n1. **Fully Supported** (Podman/Quadlet native)\n   - Core: image, build, command, entrypoint, user, working_dir, hostname\n   - Environment: environment, env_file, labels\n   - Networking: networks, ports, dns, extra_hosts\n   - Storage: volumes, tmpfs, secrets (file/content sources)\n   - Resources: memory, cpu, pids\n   - Security: cap_add/drop, privileged, security_opt, read_only\n   - Health: healthcheck, restart, depends_on\n\n2. **Partially Supported**\n   - configs: Only file/content/environment sources (NOT Swarm driver)\n   - secrets: Only file/content/environment sources (NOT Swarm driver)\n   - deploy.resources.limits: Supported, reservations partially\n   - depends_on conditions: All map to After/Requires (no health gating)\n\n3. **Not Supported - Use Alternatives**\n   - volumes_from: Use named volumes\n   - logging: Limited to Podman-supported drivers\n   - stdin_open/tty: Interactive mode not supported in systemd units\n   - sysctls/ulimits: Check Quadlet support\n\n4. **Explicitly Out of Scope - Swarm Orchestration**\n   - deploy.placement, deploy.update_config, deploy.rollback_config\n   - deploy.endpoint_mode, deploy.mode, replicas \u003e 1\n   - configs/secrets with driver (Swarm config store)\n   - ports mode: ingress (Swarm load balancing)\n   - Use Kubernetes/Nomad/Swarm for these features\n\nReference: https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html","acceptance_criteria":"- README has comprehensive Compose coverage section\n- Users can quickly see what's supported\n- Limitations are clearly documented\n- Alternatives provided for unsupported fields","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-09T16:40:17.285473-05:00","updated_at":"2025-11-09T23:05:08.191061-05:00","closed_at":"2025-11-09T23:05:08.191061-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-8m5","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.536383-05:00","created_by":"daemon"}]}
{"id":"quad-ops-8oo","content_hash":"b93a44569f8f12c7a7d6441732a976536a60537ce1847b7d3bd1a3bdbd6cad22","title":"Fix: Remove fallback network dependency logic that causes cross-project network errors","description":"Fixed critical bug in systemd renderer where containers without explicit network declarations would be assigned dependencies and network directives for ALL project-level networks, causing quadlet generator errors when multiple projects are loaded together.\n\n## Root Cause\nThe systemd renderer had a fallback in `addNetworks()` that would add Network= directives and dependencies for all networks in spec.Networks when a container's ServiceNetworks was empty. This caused problems when:\n\n1. Multiple compose files from different projects were loaded together\n2. A container didn't explicitly declare networks in its compose file\n3. The renderer would add all project networks to the container, including networks from other projects\n4. Quadlet would fail with \"requested Quadlet unit X.network was not found\"\n\nExample error:\n```\nquadlet-generator: converting \"media-immich-server.container\": requested Quadlet unit media-infrastructure-proxy.network was not found\n```\n\nThe container was trying to reference `infrastructure-proxy` network from a different project.\n\n## Solution\n1. Removed the fallback logic that added all project networks unconditionally\n2. Containers now only declare dependencies and network directives for networks in their ServiceNetworks (explicitly set from the compose file)\n3. When ServiceNetworks is empty, the container uses the default network implicitly (correct Docker behavior)\n4. Updated `renderContainer()` to only add dependencies for networks the container actually uses\n\n## Testing\n- Updated existing tests to properly set ServiceNetworks on containers\n- Added two new tests validating the correct behavior\n- All 796 tests pass\n- Linting passes with 0 issues","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-08T21:21:16.288494295-05:00","updated_at":"2025-11-08T21:32:42.774622336-05:00","closed_at":"2025-11-08T21:32:42.774622336-05:00","source_repo":"."}
{"id":"quad-ops-8p7","content_hash":"5ea4fc43d8b187524a099f54bb9956dd2b83994214d2359ea4665f582fce23ba","title":"Step 1: Establish table-driven renderer golden tests","description":"Lock in current behavior through concise, public-API tests before refactoring.\n\nIntent: Capture existing renderer output via table-driven tests using the public Renderer.Render() API to ensure byte-for-byte equivalence during refactoring.\n\nFiles affected:\n- internal/platform/systemd/renderer_test.go\n- internal/platform/systemd/bind_mounts_test.go\n\nChanges:\n- Add table-driven test structure: type rendererCase struct { name string; specs []service.Spec; want map[string]string }\n- Capture current outputs for: basic containers, volumes, networks, builds, dependencies, ports, mounts, environment, resources, security, healthchecks\n- Create renderArtifacts() helper to invoke Renderer.Render() and extract artifact content\n- Validate generated content against expected output hashes or exact strings\n\nPreconditions: Baseline renderer behavior accepted; Oracle reviewed test-first strategy\nPostconditions: Deterministic expected artifacts captured; legacy per-feature tests may coexist temporarily\nChecks: go test ./internal/platform/systemd/... ensures new cases align with current output","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T12:30:49.607646-05:00","updated_at":"2025-11-11T12:34:24.384785-05:00","closed_at":"2025-11-11T12:34:24.384785-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-8p7","depends_on_id":"quad-ops-4","type":"parent-child","created_at":"2025-11-11T12:30:49.610058-05:00","created_by":"daemon"}]}
{"id":"quad-ops-8pe","content_hash":"a0ce020c305e7537b4127d82eaa440004aaee6094bf0e7f47b9d064129d2cf94","title":"Inline single-use helpers into their callers","description":"**Anti-pattern identified:** Helpers used only once should be inlined to reduce indirection.\n\n**Examples to inline:**\n- buildDependsOnBinds() - if only used by buildContainerUnit\n- serviceNameForInit() - if only used once\n- volumeUnitName() - if only used by one unit builder\n- Any helper called from exactly one location\n\n**Approach:**\n1. Grep for function definitions in systemd package\n2. For each helper, find all call sites\n3. If called from only one location, inline it\n4. Remove the helper function\n5. Simplify the code\n\n**Benefits:**\n- Reduces indirection (easier to understand)\n- Less jumping between functions to understand logic\n- Clearer code flow\n- Aligns with Rule of Simplicity (Unix Philosophy)\n\n**When NOT to inline:**\n- Function used 2+ times\n- Function is exported/public API\n- Function has complex logic worth isolating for testing\n\n**Effort:** Small (\u003c1 hour for systemd package)\n\n**Reference:** Oracle review anti-patterns section, AGENTS.md Unix Philosophy (Rule of Simplicity)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-11T17:05:30.814586-05:00","updated_at":"2025-11-11T20:06:13.578931-05:00","closed_at":"2025-11-11T20:06:13.578931-05:00","source_repo":"."}
{"id":"quad-ops-9asf","content_hash":"8fd487eecf64e5bcd6846b48a1e636b403e117975b2460ff62388a3b01811f07","title":"Establish coverage baseline or adjust acceptance criteria","description":"Fix coverage verification for quad-ops-9f5 acceptance criteria.\n\n**Options:**\n1. Generate fresh baseline_coverage.out and commit it\n2. Document coverage threshold in CI\n3. Update acceptance criteria to reference coverage.html or numeric threshold\n\n**Implementation:**\n- Run: gotestsum --format pkgname -- -coverprofile=baseline_coverage.out -v ./...\n- Compare against any existing baseline\n- Either commit new baseline or adjust quad-ops-9f5 acceptance criteria\n\n**Verify:**\n- Coverage data exists and is documented\n- Clear success criteria for \"no reduction in test coverage\"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T20:30:35.608697-05:00","updated_at":"2025-11-11T20:37:37.717785-05:00","closed_at":"2025-11-11T20:37:37.717785-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-9asf","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T20:30:35.6097-05:00","created_by":"daemon"}]}
{"id":"quad-ops-9f5","content_hash":"c40b1bf35b9f764ed1eb5cee873985fba49282f31b7b5a9969e6656c7de1199c","title":"Simplify entire conversion pipeline: Compose → Spec → Quadlet/Launchd (12k → 2.7k lines)","description":"Full-stack simplification of the Compose-to-Platform rendering pipeline.\n\n**Architectural Goals:**\n1. **Direct mapping**: Eliminate intermediate models between service.Spec and output formats\n2. **Remove duplication**: Shared podman args builder for both platforms\n3. **Consolidate logic**: Merge scattered helper functions into cohesive rendering methods\n4. **Table-driven tests**: Replace implementation-detail tests with behavior validation\n5. **Simpler data flow**: Compose YAML → service.Spec → Platform output (2 steps, not 3+)\n\n**Target architecture:**\n- compose/convert.go: Consolidated converter with focused methods\n- compose/reader.go: Project loading only\n- platform/systemd/renderer.go: Direct Spec → Quadlet INI mapping via QuadletWriter\n- platform/systemd/quadlet.go: Simple INI format writer\n- platform/launchd/renderer.go: Direct Spec → plist XML mapping\n- platform/launchd/plist.go: Simple XML plist writer\n- Comprehensive table-driven tests (1 file per component)\n\n**Key insight:** Current design has 3+ layers of abstraction when 1-2 suffice. Direct mapping (Spec → output string) is clearer and easier to debug than intermediate models (Spec → Unit → String).","acceptance_criteria":"✅ Direct Spec→output mapping (no intermediate Unit models)\n✅ External dependencies inlined (podman, sorting packages removed)\n✅ Helper functions consolidated into main rendering logic\n✅ Table-driven tests for all major components\n✅ Integration tests pass: task build \u0026\u0026 task test\n✅ Golden tests pass: generated units/plists byte-for-byte identical to pre-simplification\n✅ No reduction in test coverage (baseline_coverage.out comparison)\n✅ No breaking changes to public APIs (ReadProjects, NewConverter, Render)\n✅ All quality gates pass: gofmt, golangci-lint, go test ./...","notes":"**NO BACKWARD COMPATIBILITY REQUIRED**: This is a complete internal refactoring. Breaking changes to internal APIs are acceptable. Focus on clean, simplified architecture over preserving old interfaces.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T01:21:48.828899012-05:00","updated_at":"2025-11-11T20:39:49.660706-05:00","closed_at":"2025-11-11T20:39:49.660706-05:00","source_repo":"."}
{"id":"quad-ops-9ha","content_hash":"b1784c159ff69584f09eddadc288315415ee7644083e2446977eec2e82993756","title":"Enhance launchd renderer to output service dependencies in plist files","description":"internal/platform/launchd/renderer.go: Launchd plist output doesn't include service dependency information, unlike systemd which renders After and Requires directives.\n\nLaunchd uses different mechanisms (RunAtLoad, dependencies arrays in plist) to manage service ordering. Need to enhance renderer to:\n1. Map service dependencies from spec.DependsOn to launchd plist format\n2. Ensure proper ordering hints for launchd to respect dependencies\n3. Match systemd capability of ordered startup/shutdown\n\nThis enables launchd lifecycle operations to respect dependency ordering when implemented in lifecycle.go.","acceptance_criteria":"Launchd renderer generates plist files with dependency information that launchd can use for ordered service management","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:01:25.867925897-05:00","updated_at":"2025-11-08T18:07:22.831609088-05:00","closed_at":"2025-11-08T18:07:22.831609088-05:00","source_repo":".","labels":["dependencies","launchd","platform-specific","renderer"],"dependencies":[{"issue_id":"quad-ops-9ha","depends_on_id":"quad-ops-26t","type":"blocks","created_at":"2025-11-08T16:01:25.878024333-05:00","created_by":"daemon"},{"issue_id":"quad-ops-9ha","depends_on_id":"quad-ops-w84","type":"related","created_at":"2025-11-08T16:01:33.147152564-05:00","created_by":"daemon"}]}
{"id":"quad-ops-9i3c","content_hash":"73baad1ad89188a09ff480f573359273df5bba7622c2073b66e59a5a2ba35f48","title":"Remove dead code: internal/compose/interfaces.go","description":"Delete unused interfaces.go that was slated for removal in Phase 1.\n\n**Files to delete:**\n- internal/compose/interfaces.go (Repository/SystemdManager/FileSystem interfaces no longer used)\n\n**Verify:**\n- go test ./... (no build errors)\n- grep -r \"Repository\\|SystemdManager\\|FileSystem\" internal/ (no references to deleted interfaces)","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-11T20:30:35.618099-05:00","updated_at":"2025-11-11T20:38:29.716279-05:00","closed_at":"2025-11-11T20:38:29.716279-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-9i3c","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T20:30:35.618786-05:00","created_by":"daemon"}]}
{"id":"quad-ops-9u9","content_hash":"c64e000ee132e463ffc4e0b9cf859453d74a1697763330ced6daf98b9b45cab0","title":"Update baseline_coverage.out - references deleted files","description":"baseline_coverage.out references deleted file internal/compose/adapters.go causing coverage comparison to fail.\n\nNeed to regenerate baseline_coverage.out from current passing test suite:\n```bash\ngo test ./... -coverprofile=baseline_coverage.out\n```","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-11T18:53:36.142941-05:00","updated_at":"2025-11-11T19:25:37.520628-05:00","closed_at":"2025-11-11T19:25:37.520628-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-9u9","depends_on_id":"quad-ops-7","type":"discovered-from","created_at":"2025-11-11T18:53:36.143386-05:00","created_by":"daemon"}]}
{"id":"quad-ops-9y2","content_hash":"57e75c58b602159abfa13a247bc39f62936e24a343370f27ee31dfbabb13f17e","title":"Improve cross-platform dependency management","description":"The current dependency system only works well for systemd. Need to enhance dependency handling across platforms.\n\nNeed to:\n- Implement dependency ordering for launchd platform (currently StartMany has no ordering)\n- Add dependency validation during spec conversion\n- Improve dependency resolution and cycle detection\n- Add platform-specific dependency mapping (systemd After/Requires vs launchd ordering)\n- Test dependency handling works correctly on both platforms\n\nThis will provide better service orchestration across both Linux and macOS platforms.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-06T21:39:38.535363004-05:00","updated_at":"2025-11-12T11:58:47.229338-05:00","closed_at":"2025-11-12T11:58:47.229338-05:00","source_repo":".","labels":["cross-platform","dependencies","launchd","systemd"]}
{"id":"quad-ops-a32","content_hash":"66e5700a4e00342010d9c454c19548afc7965fc2e5872986f01c7454af51f58e","title":"Missing ulimits support for resource limits","description":"Compose ulimits field not converted, preventing ulimit configuration for containers.\n\nCommon use case: nofile (open files limit) for databases, web servers\n\nQuadlet native support: Ulimit= directive","design":"1. Add Ulimits map[string]Ulimit field to service.Container (internal/service/models.go)\n   - Ulimit struct: { Soft int64, Hard int64 } or single value\n2. Convert service.Ulimits in spec_converter.go:convertContainer()\n3. Render:\n   - systemd: Quadlet Ulimit= directive (format: name=soft:hard or name=value)\n   - launchd: --ulimit flag (same format)\n\nQuadlet format:\n```\nUlimit=nofile=1024:2048\nUlimit=nproc=512\n```\n\nPodman format:\n```\n--ulimit nofile=1024:2048 --ulimit nproc=512\n```\n\nHandle both forms from Compose:\n- Short: nofile: 2048 → nofile=2048:2048\n- Long: nofile: {soft: 1024, hard: 2048} → nofile=1024:2048","acceptance_criteria":"- ulimits in compose converts to Container.Ulimits\n- Renders as Ulimit= on systemd (multiple lines)\n- Renders as --ulimit on launchd (multiple flags)\n- Both short and long syntax supported\n- Test coverage for ulimit scenarios","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T16:46:01.323805-05:00","updated_at":"2025-11-09T17:48:21.412844-05:00","closed_at":"2025-11-09T17:48:21.412844-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-a32","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.527125-05:00","created_by":"daemon"}]}
{"id":"quad-ops-a3j","content_hash":"57b42a9a9ff1f4dea7be9312f8892fd6023ebb46ee40a684548176aac8397d8c","title":"Simplify unit_list.go to consistently use ArtifactStore (QuadletDir)","description":"Refactor cmd/unit_list.go lines 96-115 to eliminate confusion about which artifact store to use.\n\nCurrent state:\n- Both code paths call ArtifactStore.List() (correct)\n- --use-fs-artifacts flag has no functional effect\n- Misleading comment suggests RepoArtifactStore might be used\n- Code structure creates false impression of two different behaviors\n\nChanges needed:\n1. Remove or clarify the --use-fs-artifacts flag purpose (deprecated or remove entirely)\n2. Simplify logic to single clear path: always use ArtifactStore (QuadletDir)\n3. Remove dead code paths and confusing conditionals\n4. Update comments to clarify: deployed artifacts come from QuadletDir, not RepositoryDir\n5. Consider if RepoArtifactStore is still needed in ListDeps struct (may not be)\n\nGoal: Make it obvious that unit list scans the deployed platform-specific artifacts directory, not the git repository.","acceptance_criteria":"cmd/unit_list.go code is simplified and unambiguous. Behavior is: always scan ArtifactStore (QuadletDir) for deployed artifacts. Comments clearly explain the distinction between QuadletDir and RepositoryDir. --use-fs-artifacts flag either removed or clearly documented as deprecated. ListDeps struct reflects actual dependencies used.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:02:54.647304864-05:00","updated_at":"2025-11-08T16:13:50.734008079-05:00","closed_at":"2025-11-08T16:13:50.734008079-05:00","source_repo":"."}
{"id":"quad-ops-aez","content_hash":"d12c36ddb243cade8aa65df3252d4282a287370683d8f0cbe1cb64b4a26d408b","title":"Add platform-specific dependency mapping","description":"Enhance systemd renderer to ensure comprehensive After/Requires mapping. Research and implement launchd dependency mechanisms in plist files (QueueDirectories, WatchPaths, etc.) and add dependency fields to Plist struct.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T23:26:41.917992911-05:00","updated_at":"2025-11-11T20:45:05.221518-05:00","closed_at":"2025-11-11T20:45:05.221518-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-aez","depends_on_id":"quad-ops-9y2","type":"parent-child","created_at":"2025-11-06T23:26:43.439040488-05:00","created_by":"daemon"}]}
{"id":"quad-ops-b5b","content_hash":"849dba5e8eefd72f773f137dcad24b2ac91e5c670bb635b70bb9e4c19195e5d7","title":"Update configuration documentation to match current config structure","description":"Review and update the quad-ops-configuration.md file to ensure it accurately reflects:\n- Current config field names and structure (Reference vs ref, etc.)\n- Default values and paths\n- User mode vs system mode differences\n- Any new configuration options that may have been added","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T23:24:09.948742386-05:00","updated_at":"2025-11-06T23:24:09.948742386-05:00","source_repo":".","labels":["config","configuration","documentation"],"dependencies":[{"issue_id":"quad-ops-b5b","depends_on_id":"quad-ops-79g","type":"blocks","created_at":"2025-11-06T23:24:09.95632202-05:00","created_by":"daemon"}]}
{"id":"quad-ops-b5m","content_hash":"9d79188b39538d9775745df68ba406b043097585498deb8b317988cbf7cd9318","title":"validate command not finding tempdir","description":"User runs: ./quad-ops validate --repo https://github.com/trly/quad-ops-deploy.git --compose-dir prod/bdyvp22\n\nExpected: Command successfully clones the repo and validates the compose files in prod/bdyvp22 subdirectory\n\nActual: Error - path does not exist: /tmp/quad-ops-validate/prod/bdyvp2 (truncated path that skips the repository name directory)","notes":"INVESTIGATION FINDINGS:\n\nRoot Cause: In cmd/validate.go cloneRepositoryWithDeps(), the function returns tempPath (/tmp/quad-ops-validate) as the target path. However, GitSyncer internally creates a subdirectory named after the repository (\"validate-temp\"), so the actual cloned repo is at /tmp/quad-ops-validate/validate-temp.\n\nWhen --compose-dir is used with --repo, the code at line 152 joins composeDir to targetPath:\n  targetPath = filepath.Join(targetPath, composeDir)\n  \nThis produces /tmp/quad-ops-validate/prod/bdyvp22 but the actual path should be /tmp/quad-ops-validate/validate-temp/prod/bdyvp22.\n\nFIX IMPLEMENTATION PLAN:\n1. Modify cloneRepositoryWithDeps() to return filepath.Join(tempPath, repoConfig.Name) instead of just tempPath\n2. Add test TestValidateCommand_WithRepoAndComposeDir to verify --repo and --compose-dir work together\n3. This ensures consistency with how GitSyncer structures the cloned repository\n\nFiles to modify:\n- cmd/validate.go (function cloneRepositoryWithDeps, line ~234)\n- cmd/validate_test.go (add new test case)\n\nChanges are minimal and isolated to the validate command flow.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-08T23:11:17.37789084-05:00","updated_at":"2025-11-08T23:15:23.399034635-05:00","closed_at":"2025-11-08T23:15:23.399034635-05:00","source_repo":"."}
{"id":"quad-ops-bon","content_hash":"0856d111983a7f2e8b79527d4b2666e2e16baee6a7abc11c62593fb1fd51fbc4","title":"Implement macOS network management for feature parity","description":"While macOS launchd cannot create separate network units like systemd, we can implement network lifecycle management to provide better parity.\n\nNeed to:\n- Research Podman network management on macOS\n- Implement network creation/deletion commands for macOS platform  \n- Add network validation and lifecycle hooks to launchd platform\n- Update status reporting to include network information\n- Test network operations work correctly on macOS\n\nThis would provide basic network management functionality on macOS, even if not as rich as Linux Quadlet networks.","design":"### Network Management Research Phase\n- Investigate Podman macOS network support through documentation and testing\n- Determine if named networks are supported and how they differ from Linux\n- Assess network isolation, connectivity, and management commands available\n- Document findings in issue notes for implementation decisions\n\n### Network Model Extensions\n- Add NetworkSpec struct to internal/service/models.go for macOS network definitions\n- Extend launchd platform structs to include network lifecycle hooks\n- Add network validation methods to internal/service/validate.go\n- Ensure network specs are parsed from compose files and included in service specs\n\n### Platform Implementation\n- Implement network creation/deletion in internal/platform/launchd/network.go\n- Add network lifecycle hooks to launchd platform manager\n- Integrate network operations into StartMany/StopMany/RestartMany commands\n- Handle network dependencies during service orchestration (though launchd doesn't support unit-level dependencies like systemd)\n\n### Status Reporting Updates\n- Extend status reporting to include network information in launchd platform\n- Add network status fields to Status struct (created, connected, subnet, etc.)\n- Update CLI status command to display network information on macOS\n- Ensure network status integrates with existing status reporting workflow\n\n### Testing Implementation\n- Add unit tests for network operations in launchd platform\n- Create integration tests using test compose files with networks\n- Test network lifecycle management across service operations\n- Validate network isolation and connectivity behavior\n\n### Command Integration\n- Add network-specific CLI commands if needed (create, remove, list networks)\n- Integrate network management into existing up/down/sync workflows\n- Ensure network operations are logged appropriately\n- Handle network errors gracefully with clear user feedback\n\n### Cross-Platform Considerations\n- Maintain API compatibility with Linux network management where possible\n- Document platform differences in network capabilities clearly\n- Ensure compose files work on both platforms (with appropriate warnings for unsupported features)\n- Consider fallback behaviors for macOS-specific limitations","acceptance_criteria":"### Research Validation\n- Podman macOS network support is documented and understood\n- Network capabilities and limitations are clearly identified\n- Implementation approach is validated through testing\n\n### Network Lifecycle Management\n- Network creation/deletion commands work correctly on macOS\n- Networks provide isolation between services as expected\n- Network cleanup happens appropriately when services are removed\n\n### Integration Testing\n- Test compose files with networks deploy successfully on macOS\n- Network connectivity works correctly between containers\n- Service operations (start/stop/restart) handle networks properly\n- No regressions in existing functionality\n\n### Status and Monitoring\n- Status command shows network information on macOS\n- Network status is accurate and up-to-date\n- Error conditions are reported clearly\n\n### User Experience\n- Network operations provide clear success/error feedback\n- Platform differences are communicated through warnings or documentation\n- Network management integrates seamlessly with existing workflows\n\n### Code Quality\n- Unit test coverage for network operations \u003e80%\n- No linting or security issues introduced\n- Code follows existing patterns and conventions\n- Documentation updated to reflect new capabilities","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-06T21:39:36.067042095-05:00","updated_at":"2025-11-11T20:08:54.656456-05:00","closed_at":"2025-11-11T20:08:54.656456-05:00","source_repo":".","labels":["macos","networks","parity","podman"],"dependencies":[{"issue_id":"quad-ops-bon","depends_on_id":"quad-ops-lub","type":"related","created_at":"2025-11-06T21:39:47.025735433-05:00","created_by":"daemon"}]}
{"id":"quad-ops-car","content_hash":"38824ca3c92247059d05f35a1d878bce39c926ec521d2dad179c2044d944df33","title":"Add cleanup of orphaned rootlessport processes before starting services","description":"When systemd services fail with podman containers using rootless networking, rootlessport processes may not get cleaned up, causing port binding conflicts on subsequent runs. Need to add cleanup logic to kill orphaned rootlessport processes before starting services in sync/up/down commands.","design":"### Root Cause Analysis\n- Podman rootless networking uses rootlessport for port forwarding\n- When systemd services fail, rootlessport processes may not be cleaned up\n- Subsequent runs fail with \"bind: address already in use\" errors\n\n### Solution Options\n1. **Pre-start cleanup**: Kill orphaned rootlessport processes before starting services\n2. **Systemd unit improvements**: Better cleanup in systemd unit files\n3. **Process tracking**: Track and clean up processes managed by quad-ops\n\n### Implementation Approach\n- Add cleanup function to check for orphaned rootlessport processes\n- Kill processes owned by current user that match rootlessport pattern\n- Integrate cleanup into up/down/sync commands before service operations\n- Add logging for cleanup actions\n- Handle errors gracefully (don't fail if cleanup fails)\n\n### Platform Considerations\n- Linux only (rootlessport is Linux-specific)\n- Should be safe to run on systems without rootlessport\n- Only affects systemd platform (macOS launchd doesn't use rootlessport)\n\n### Testing\n- Unit tests for cleanup function\n- Integration tests simulating orphaned processes\n- Manual testing with failed services","acceptance_criteria":"### Rootlessport Cleanup\n- Orphaned rootlessport processes are detected and killed before service starts\n- Port binding conflicts are resolved automatically\n- Cleanup only affects processes owned by current user\n- No impact on running services that shouldn't be cleaned up\n\n### Error Handling\n- Cleanup failures don't prevent service operations\n- Appropriate logging for cleanup actions\n- Graceful degradation when rootlessport not present\n\n### Testing Validation\n- Manual reproduction of orphaned process scenario works\n- Integration tests pass with simulated failures\n- No regressions in existing functionality\n\n### Platform Safety\n- Linux-only implementation (macOS unaffected)\n- Safe to run on systems without podman/rootlessport\n- No security risks (only kills user-owned processes)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-07T00:29:34.766225116-05:00","updated_at":"2025-11-07T00:31:10.504531795-05:00","closed_at":"2025-11-07T00:31:10.504531795-05:00","source_repo":".","labels":["cleanup","linux","podman","rootlessport","systemd"]}
{"id":"quad-ops-cn8","content_hash":"a5d7c355e796ca2613815709ed340fdfdd0189f369548d4fa8074d97d88b7429","title":"Restore v0.21.2 service-to-network mapping (DNS resolution failures)","description":"After the macOS refactor (commit 92dd0a3), service DNS lookups are failing when services try to connect to each other by hostname. This worked in v0.21.2.\n\n## Root Cause\nServices are not being connected to the specific networks they declare in docker-compose.yml. The spec converter only includes project-level networks, not service-level network declarations.\n\nExample from immich docker-compose.yml:\n- immich-server declares `networks: [default, infrastructure-proxy]`\n- When immich-server tries to connect to `redis` hostname, it fails with `EAI_AGAIN` because redis is not on the same network\n\n## Impact\n- Service-to-service DNS resolution fails on both Linux and macOS\n- Services using depends_on with hostname resolution are broken\n- Any multi-network compose file with internal service communication fails\n\n## Solution\nRestore the v0.21.2 behavior where services are connected to their declared networks and renderers generate proper network configuration.","notes":"Closed - Both underlying issues have been fixed: 1) Service-to-network mapping restored (commit f959e8c), 2) Volume/network dependency suffixes corrected (commit 6377d90). The 'Unit not found' errors observed during the previous sync were due to the incorrect dependency suffix names, which is now resolved.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-08T15:57:52.516466306-05:00","updated_at":"2025-11-08T20:58:39.277966653-05:00","closed_at":"2025-11-08T20:58:36.785354157-05:00","source_repo":"."}
{"id":"quad-ops-coc","content_hash":"4a858778d1f73baa13c8c2b1ac1b7c1ebe92a286babda0a3cd93c7e55cda6f7b","title":"Consolidate quadlet INI helpers into quadlet.go writer","description":"**Anti-pattern identified:** Quadlet-specific helpers scattered instead of co-located with QuadletWriter.\n\n**Current state:**\n- INI escape logic, kv sorting, duration formatting, env/label formatting scattered\n- Mount/port writers may be in separate locations\n- Helpers not cohesively organized with quadlet writer\n\n**Target architecture:**\nFile: internal/platform/systemd/quadlet.go (~400 lines)\n- QuadletWriter struct with simple Add* methods\n- All INI-specific helpers co-located (escape, sort, format)\n- Self-contained quadlet unit generation\n\n**Move/inline into quadlet.go:**\n- INI escape functions\n- Key-value sorting\n- Duration formatting for quadlet directives\n- Environment/label formatting\n- Mount/port writers for INI format\n\n**Benefits:**\n- Single cohesive quadlet generation module\n- Clear responsibility: service.Spec → Quadlet INI string\n- Easier to understand and modify\n- Reduces scattered helpers anti-pattern\n\n**Effort:** Medium (1-3 hours)\n\n**Reference:** Oracle review anti-patterns section, full-pipeline-simplification.md systemd renderer structure","status":"closed","priority":1,"issue_type":"task","assignee":"amp","created_at":"2025-11-11T17:05:30.799006-05:00","updated_at":"2025-11-11T19:45:43.938732-05:00","closed_at":"2025-11-11T19:45:43.938732-05:00","source_repo":"."}
{"id":"quad-ops-d4k","content_hash":"136aa59c10230f1130369e1890b5395e9b96a73faae749988896d09b1934c310","title":"Missing tmpfs mount options: size and other tmpfs-specific options","description":"tmpfs mount options like size not fully supported in current implementation.","design":"## Problem\nDocker Compose tmpfs mounts support size and mode options via `tmpfs.size` and `tmpfs.mode`. Additional tmpfs options like uid/gid may also be needed. These are currently partially converted but not fully rendered.\n\n## Source Data\n- compose-spec library: `types.ServiceVolumeConfig.Tmpfs.Size` (UnitBytes), `.Mode` (uint32)\n- compose-spec also uses `types.ServiceConfig.Tmpfs` ([]string) for simple tmpfs paths\n- Location: `internal/compose/spec_converter.go:convertVolumeMounts()` and renderer\n\n## Target Format\nQuadlet supports tmpfs via `Tmpfs=` directive with comma-separated options:\n```\nTmpfs=/tmp:rw,size=64m,mode=1777,uid=1000,gid=1000\n```\n\nOptions:\n- `size=\u003cbytes\u003e` (e.g., 64m, 1g)\n- `mode=\u003coctal\u003e` (e.g., 1777, 0755)\n- `uid=\u003cuid\u003e` (numeric)\n- `gid=\u003cgid\u003e` (numeric)\n- `ro` or `rw` (readonly/readwrite)\n\n## Implementation Plan\n1. Update `internal/service/models.go`:\n   - Add `TmpfsOptions` struct with `Size string`, `Mode uint32`, `UID int`, `GID int` fields\n   - Add `TmpfsOptions *TmpfsOptions` field to `Mount` struct\n\n2. Update `internal/compose/spec_converter.go:convertVolumeMounts()`:\n   - For tmpfs-type mounts, check `v.Tmpfs != nil`\n   - Create `TmpfsOptions` and populate from `v.Tmpfs.Size`, `v.Tmpfs.Mode`\n   - Handle size conversion from UnitBytes to string format (e.g., \"64m\")\n\n3. Update `internal/platform/systemd/renderer.go:addMounts()`:\n   - Tmpfs mounts already use separate `Tmpfs=` directive (see line 326-333)\n   - Update to build options string from `TmpfsOptions` if present\n   - Format: `Tmpfs=/path:option1,option2,option3`\n\n4. Add test cases:\n   - `internal/compose/testdata/golden/` - add compose file with tmpfs size/mode\n   - `internal/platform/systemd/renderer_test.go` - test Tmpfs= with size and mode options","acceptance_criteria":"- tmpfs size option is preserved\n- Other tmpfs options (mode, etc.) are supported\n- Rendered correctly in Quadlet","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-09T13:44:34.801736-05:00","updated_at":"2025-11-09T16:08:15.304679-05:00","closed_at":"2025-11-09T16:08:15.304679-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-d4k","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.802175-05:00","created_by":"daemon"}]}
{"id":"quad-ops-d99","content_hash":"99e1835136cc842371ebd56ae4831c64964a2bbb02749a2423204e611fc00f44","title":"x-podman-volumes documentation doesn't match implementation scope","description":"The build-support.md documentation shows x-podman-volumes being used in the \"Custom Build Volumes\" section and describes them as \"for build-time volume mounts\", but the actual implementation applies x-podman-volumes to container mounts (runtime), not build mounts (build-time).\n\nThe documentation example (lines 256-266) shows:\n```yaml\nservices:\n  app:\n    build:\n      context: .\n    x-podman-volumes:\n      - \"build-cache:/cache\"\n```\n\nBut the implementation in spec_converter.go:62-66 applies these to service.Container.Mounts, not service.Build.\n\nThis creates a mismatch between documented behavior and actual behavior.","acceptance_criteria":"Either:\nA) Update documentation to clarify that x-podman-volumes applies to container runtime, not build-time\nB) Implement x-podman-volumes support for the build stage specifically\nC) Create separate x-podman-build-volumes extension for build-time volumes\n\nCurrent implementation needs clarification on scope and purpose.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T23:13:21.793191-05:00","updated_at":"2025-11-09T23:24:16.21464-05:00","closed_at":"2025-11-09T23:24:16.21464-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-d99","depends_on_id":"quad-ops-3i1","type":"blocks","created_at":"2025-11-09T23:13:21.793716-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dep0","content_hash":"0f63289ce5fbf7166f961d96a6dfab48db7f0445be09947f3104bbfd30a83e69","title":"Phase 0: Remove Sanitization, Add Strict Validation","description":"**Foundation task - MUST complete before other phases**\n\nRemove all sanitization logic and replace with strict up-front validation that follows Docker Compose specification exactly.\n\n**Behavior Change:**\n- Currently: Invalid names silently transformed (e.g., \"My-Project!\" → \"my-project\")\n- After: Invalid names rejected with clear error messages\n\n**User-Facing Test Scenarios (Write First):**\n1. Valid project name (lowercase, digits, dashes, underscores) → Success\n2. Invalid project name (uppercase) → Error with helpful message\n3. Invalid project name (special chars) → Error showing valid pattern\n4. Invalid service name → Error before any rendering\n5. Directory-based project name validation\n6. Error message guides user to fix (shows valid examples)","design":"**Reference:** history/sanitization-removal-summary.md (complete removal plan)\n\n**Implementation Steps:**\n\n1. Add validation functions (internal/compose/convert.go):\n   - ValidateProjectName() - regex ^[a-z0-9][a-z0-9_-]*$\n   - ValidateServiceName() - same pattern\n\n2. Update reader (internal/compose/reader.go):\n   - Replace sanitizeProjectName() calls with ValidateProjectName()\n   - Delete sanitizeProjectName() function (lines 273-306)\n   - Convert directory name to lowercase before validation\n\n3. Remove SanitizeLabel():\n   - Delete from internal/platform/launchd/plist.go (lines 187-200)\n   - Remove calls from internal/platform/launchd/options.go\n\n4. Update tests:\n   - Remove sanitization behavior tests (invalid → valid)\n   - Add validation behavior tests (invalid → error)\n   - Delete TestSanitizeLabel() entirely\n\n**Files to Modify:** 7 files (see summary doc for complete list)","acceptance_criteria":"**Behavior-Driven Acceptance (Test First):**\n\nGiven a compose file with invalid project name \"My-Project\"\nWhen I run quad-ops up\nThen I see error: \"invalid project name \\\"My-Project\\\": must contain only lowercase letters, digits, dashes, underscores and start with letter/digit\"\n\nGiven a compose file with valid project name \"my-project\"\nWhen I run quad-ops up\nThen deployment succeeds without validation errors\n\nGiven a compose file with invalid service name \"Web-App\"\nWhen I run quad-ops up\nThen I see error before any rendering: \"invalid service name \\\"Web-App\\\": must contain only lowercase letters...\"\n\n**Code Acceptance:**\n- ❌ sanitizeProjectName() function exists\n- ❌ SanitizeLabel() function exists\n- ✅ ValidateProjectName() validates with regex\n- ✅ ValidateServiceName() validates with regex\n- ✅ All tests pass\n- ✅ Invalid names rejected with clear errors\n- ✅ Valid names work unchanged","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-12T11:59:45.832881-05:00","updated_at":"2025-11-12T12:11:10.362152-05:00","closed_at":"2025-11-12T12:11:10.362152-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-dep0","depends_on_id":"quad-ops-dep1","type":"blocks","created_at":"2025-11-12T11:59:45.833983-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dep1","content_hash":"3548a66c52c46cf7bd63891636a90ed5e251461b9e74d17cd163fe13ba79ebf8","title":"Dependency Management Consolidation","description":"Comprehensive redesign of dependency management to leverage Quadlet automatic dependencies, add cross-project support, remove sanitization in favor of validation, and ensure correct ordering across platforms.\n\n**Goals:**\n1. Remove redundant manual dependencies (trust Quadlet Network=/Volume=/Image= directives)\n2. Remove all sanitization logic in favor of strict up-front validation\n3. Fix sync/restart ordering to use topological sort (sequential execution)\n4. Add enhanced cycle detection with helpful error messages\n5. Support cross-project dependencies via x-quad-ops-depends-on extension\n6. Validate external resources (networks, volumes, services) before rendering\n\n**Key Design Principles:**\n- Validate, don't sanitize (reject invalid input with clear errors)\n- Trust Quadlet for infrastructure dependencies\n- Strict adherence to Docker Compose specification\n- Platform-aware validation (systemd vs launchd)\n- Sequential restart ordering (no race conditions)\n- Same domain only (user units cannot depend on system units)","design":"See history/dependency-consolidation-summary.md for complete design.\n\nKey design documents:\n- history/dependency-consolidation-summary.md - Complete implementation plan\n- history/dependency-tracking-research.md - Research and gap analysis\n- history/dependency-oracle-review-fixes.md - Oracle review findings\n- history/sanitization-removal-summary.md - Validation vs sanitization philosophy\n\nArchitecture:\n1. Validation at compose load (internal/compose/convert.go)\n2. Quadlet handles infrastructure deps automatically (Network=, Volume=, Image=)\n3. ServiceDependencyGraph handles service-to-service ordering\n4. Platform renderers add manual deps only for services (not infrastructure)\n5. Cross-project deps validated before rendering (batch-aware)\n\nEstimated effort: 15-21 hours across 6 phases","acceptance_criteria":"✅ All sanitization functions removed\n✅ Validation rejects invalid compose files with clear error messages\n✅ No redundant After=/Requires= in generated .container files\n✅ Named volumes use Volume=name.volume:/path syntax\n✅ Services start/restart in topological order (sequential)\n✅ Cycle errors show full path with helpful suggestions\n✅ Cross-project dependencies validated before rendering\n✅ External networks/volumes validated via podman inspect\n✅ Optional external deps use After= only (systemd) or omitted if missing (launchd)\n✅ All tests pass (40+ new behavior-driven tests)\n✅ Documentation updated with naming requirements","status":"open","priority":1,"issue_type":"epic","created_at":"2025-11-12T11:59:26.367043-05:00","updated_at":"2025-11-12T11:59:26.367043-05:00","source_repo":".","labels":["breaking-change","cross-project","dependencies","quadlet","validation"]}
{"id":"quad-ops-dep2","content_hash":"2b00d06c89b801d732dfee669f5a582f9e5b02c6fe66f65fb90589200ea74307","title":"Phase 1: Remove Quadlet Redundancy","description":"Remove redundant manual After=/Requires= directives for networks, volumes, and builds. Trust Quadlet automatic dependency system.\n\n**Behavior Change:**\n- Currently: Manual After=/Requires= added for networks/volumes/builds\n- After: Only Network=/Volume=/Image= directives (Quadlet adds dependencies automatically)\n\n**User-Facing Test Scenarios (Write First):**\n1. Service with named volume → .container uses Volume=name.volume:/path\n2. Service with network → .container uses Network=name.network\n3. Service with build → .container uses Image= directive\n4. Generated .container has NO redundant After=/Requires= for infrastructure\n5. systemctl list-dependencies shows Quadlet-generated deps work\n6. Services start in correct order (infrastructure before services)","design":"**Reference:** history/dependency-consolidation-summary.md lines 784-818\n\n**Key Changes:**\n\n1. internal/platform/systemd/quadlet.go - writeUnitSection():\n   - DELETE redundant After=/Requires= for networks\n   - DELETE redundant After=/Requires= for volumes\n   - DELETE redundant After=/Requires= for builds\n   - KEEP service-to-service After=/Requires=\n\n2. internal/platform/systemd/quadlet.go - writeMounts():\n   - Fix named volume syntax: Volume=volumename.volume:/path\n   - Not: /host/path:/container/path for named volumes\n\n3. Verify Quadlet directives used:\n   - Network=name.network (Quadlet adds After/Requires automatically)\n   - Volume=name.volume:/path (Quadlet adds After/Requires automatically)\n   - Image=tagname (Quadlet finds .build units automatically)\n\n**Per Quadlet docs:** https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html","acceptance_criteria":"**Behavior-Driven Acceptance (Test First):**\n\nGiven a compose file with service using named volume \"data\"\nWhen I run quad-ops up\nThen generated .container contains \"Volume=myproject-data.volume:/app/data\"\nAnd generated .container does NOT contain \"After=myproject-data.volume\"\nAnd systemctl list-dependencies shows myproject-web.service depends on myproject-data.volume\n\nGiven a compose file with service using network \"backend\"\nWhen I run quad-ops up\nThen generated .container contains \"Network=myproject-backend.network\"\nAnd generated .container does NOT contain \"Requires=myproject-backend.network\"\n\nGiven a compose file with service depending on another service\nWhen I run quad-ops up\nThen generated .container DOES contain \"After=myproject-db.service\" (service deps kept)\n\n**Code Acceptance:**\n- ✅ No manual After=/Requires= for volumes in writeUnitSection()\n- ✅ No manual After=/Requires= for networks in writeUnitSection()\n- ✅ No manual After=/Requires= for builds in writeUnitSection()\n- ✅ Named volumes use Volume=name.volume:/path syntax\n- ✅ Service-to-service deps still have manual After=/Requires=","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-12T12:00:03.98618-05:00","updated_at":"2025-11-12T12:23:25.748064-05:00","closed_at":"2025-11-12T12:23:25.748064-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-dep2","depends_on_id":"quad-ops-dep1","type":"blocks","created_at":"2025-11-12T12:00:03.988411-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep2","depends_on_id":"quad-ops-dep0","type":"blocks","created_at":"2025-11-12T12:00:03.989207-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dep3","content_hash":"de69a681dd22d810513442fcc2903674d583af9413a791da993983daf57095be","title":"Phase 2: Fix Sync/Restart Topological Ordering","description":"Fix sync/restart commands to use topological ordering (like up command) and make RestartMany sequential on both platforms.\n\n**Behavior Change:**\n- Currently: sync restarts services alphabetically, systemd RestartMany uses parallel goroutines\n- After: sync restarts in topological order, both platforms sequential\n\n**User-Facing Test Scenarios (Write First):**\n1. sync with changed db and web (depends on db) → db restarts before web\n2. sync with only web changed → only web restarts (in correct order with deps)\n3. Restart respects dependency order (no race conditions)\n4. systemd: services restart sequentially, not in parallel\n5. launchd: services restart sequentially (already true, verify)\n6. Error in one service doesn't block others (continue through failures)","design":"**Reference:** history/dependency-consolidation-summary.md lines 821-873\n\n**Key Changes:**\n\n1. cmd/sync.go:\n   - Create serviceRegistry (like cmd/up.go)\n   - Add ALL specs to registry (need full graph)\n   - Use registry.orderAndExpand(servicesToRestart) for topological order\n   - Replace sortedServiceNames() with graph-based ordering\n\n2. internal/platform/systemd/lifecycle.go - RestartMany():\n   - Change from parallel (goroutines + WaitGroup) to sequential loop\n   - Process services one-by-one in provided order\n   - Comment: \"Sequential ensures dependency order respected\"\n\n3. internal/platform/launchd/lifecycle.go:\n   - Already sequential, verify comment is accurate\n   - No code changes needed\n\n**Critical:** Sequential execution prevents race conditions where dependent service starts before dependency is ready.","acceptance_criteria":"**Behavior-Driven Acceptance (Test First):**\n\nGiven compose with web depending on db\nWhen I modify db config and run quad-ops sync\nThen db restarts before web restarts\n\nGiven compose with web depending on db\nWhen I modify only web and run quad-ops sync  \nThen only web restarts (db not restarted)\n\nGiven compose with A→B→C dependency chain\nWhen I run quad-ops sync with all changed\nThen restart order is: C, then B, then A (reverse topological)\n\nGiven systemd platform\nWhen RestartMany is called with multiple services\nThen services restart sequentially (one completes before next starts)\n\n**Code Acceptance:**\n- ✅ cmd/sync.go uses serviceRegistry.orderAndExpand()\n- ✅ systemd RestartMany has NO goroutines\n- ✅ systemd RestartMany processes in sequential loop\n- ✅ launchd RestartMany already sequential\n- ✅ All restart tests pass with correct ordering","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T12:00:22.986275-05:00","updated_at":"2025-11-12T12:47:55.367511-05:00","closed_at":"2025-11-12T12:47:55.367511-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-dep3","depends_on_id":"quad-ops-dep1","type":"blocks","created_at":"2025-11-12T12:00:22.987302-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep3","depends_on_id":"quad-ops-dep0","type":"blocks","created_at":"2025-11-12T12:00:22.987795-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep3","depends_on_id":"quad-ops-dep2","type":"blocks","created_at":"2025-11-12T12:00:22.988204-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dep4","content_hash":"2614dd34470d9e1d15b7a2888acf430416d915181ca5866728cb967c2e775212","title":"Phase 3: Enhanced Cycle Detection","description":"Add FindCycle() method with DFS path tracking and improve error messages to show actual cycle path with suggestions.\n\n**Behavior Change:**\n- Currently: \"cycle detected\" (no details)\n- After: \"Dependency cycle: web → api → db → web. Remove one of: web→api, api→db, db→web\"\n\n**User-Facing Test Scenarios (Write First):**\n1. Simple cycle (A→B→A) → Error shows \"A → B → A\" path\n2. Complex cycle (A→B→C→D→B) → Error shows full path including where cycle starts\n3. No cycle → No error (topological order succeeds)\n4. Error message suggests which dependency to remove\n5. Error message is actionable (user knows how to fix)\n6. Multiple independent cycles → Reports first one found","design":"**Reference:** history/dependency-consolidation-summary.md lines 876-919\n\n**Implementation:**\n\n1. internal/dependency/dependency.go - Add FindCycle():\n   - DFS with recursion stack tracking\n   - Returns path as []string\n   - Called by GetTopologicalOrder() when cycle detected\n\n2. Improve error message format:\n   ```\n   ERROR: Dependency graph contains a cycle: web → api → db → web\n   \n   To fix, remove one of these dependencies:\n     - web depends on api\n     - api depends on db  \n     - db depends on web\n   ```\n\n3. Update GetTopologicalOrder():\n   - On cycle error, call FindCycle()\n   - Format helpful error message\n   - Show full cycle path with arrows","acceptance_criteria":"**Behavior-Driven Acceptance (Test First):**\n\nGiven compose with simple cycle: web depends on api, api depends on web\nWhen I run quad-ops up\nThen I see error: \"Dependency cycle: web → api → web\"\nAnd error suggests: \"remove one of: web→api, api→web\"\n\nGiven compose with complex cycle: A→B→C→D→B\nWhen I run quad-ops up\nThen I see error showing full path: \"B → C → D → B\"\n\nGiven compose with no cycles\nWhen I run quad-ops up\nThen no cycle error occurs\n\nGiven compose with cycle\nWhen error is shown\nThen error message is actionable (shows which deps to remove)\n\n**Code Acceptance:**\n- ✅ FindCycle() method exists in ServiceDependencyGraph\n- ✅ FindCycle() uses DFS with path tracking\n- ✅ GetTopologicalOrder() calls FindCycle() on cycle detection\n- ✅ Error message shows full cycle path with arrows\n- ✅ Error message suggests which dependencies to remove","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T12:00:39.904604-05:00","updated_at":"2025-11-12T13:08:15.580862-05:00","closed_at":"2025-11-12T13:08:15.580862-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-dep4","depends_on_id":"quad-ops-dep1","type":"blocks","created_at":"2025-11-12T12:00:39.906505-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep4","depends_on_id":"quad-ops-dep0","type":"blocks","created_at":"2025-11-12T12:00:39.907092-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dep5","content_hash":"00534e73dd89d845e01d5fc8a74c160124020325ae35f562acb760e875dfcba1","title":"Phase 4: Cross-Project Dependencies (Basic)","description":"Add support for x-quad-ops-depends-on extension to declare cross-project service dependencies.\n\n**Behavior Change:**\n- Currently: No way to express dependencies between projects\n- After: Services can depend on services in other deployed projects\n\n**User-Facing Test Scenarios (Write First):**\n1. Service with required external dep → Renders with After=/Requires=\n2. Service with optional external dep → Renders with After= only (systemd) or omitted if missing (launchd)\n3. External dep project not deployed → Clear error before rendering\n4. External dep with invalid project/service name → Validation error\n5. Both projects deployed together → Batch-aware validation succeeds\n6. systemd: optional dep doesn't auto-start (uses After= not Wants=)","design":"**Reference:** history/dependency-consolidation-summary.md lines 52-149, 178-277\n\n**Implementation:**\n\n1. internal/service/spec.go:\n   - Add ExternalDependency type (Project, Service, Optional, ExistsInRuntime)\n   - Add ExternalDependencies []ExternalDependency to Spec\n\n2. internal/compose/convert.go:\n   - Add ExtractExternalDependencies() method\n   - Parse x-quad-ops-depends-on extension\n   - Validate project/service names (ValidateComposeProjectName/ServiceName)\n   - Fail on malformed items (no silent continue)\n\n3. internal/platform/systemd/quadlet.go - writeUnitSection():\n   - Required: After= + Requires=\n   - Optional: After= only (NOT Wants=)\n   - Use Prefix() for consistent naming\n\n4. internal/platform/launchd/renderer.go:\n   - Add external deps to DependsOn array\n   - Skip optional deps where ExistsInRuntime == false","acceptance_criteria":"**Behavior-Driven Acceptance (Test First):**\n\nGiven app compose with \"x-quad-ops-depends-on: [{project: infra, service: proxy}]\"\nAnd infrastructure project already deployed\nWhen I run quad-ops up in app project\nThen generated .container contains \"After=infra-proxy.service\" and \"Requires=infra-proxy.service\"\n\nGiven app with optional external dep on monitoring-prometheus\nAnd monitoring project NOT deployed\nWhen I run quad-ops up in app project\nThen systemd .container has \"After=monitoring-prometheus.service\" only\nAnd launchd plist does NOT include monitoring-prometheus in DependsOn\n\nGiven app with required external dep on infra-db\nAnd infra project NOT deployed\nWhen I run quad-ops up in app project\nThen error before rendering: \"required external services not found: infra-db\"\n\nGiven malformed x-quad-ops-depends-on (uppercase project name)\nWhen I run quad-ops up\nThen validation error: \"invalid project name\"\n\n**Code Acceptance:**\n- ✅ ExternalDependency type added to spec\n- ✅ ExtractExternalDependencies() validates names\n- ✅ systemd optional deps use After= only\n- ✅ launchd optional missing deps omitted from DependsOn","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T12:01:00.275586-05:00","updated_at":"2025-11-12T13:24:41.429752-05:00","closed_at":"2025-11-12T13:24:41.429752-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-dep5","depends_on_id":"quad-ops-dep1","type":"blocks","created_at":"2025-11-12T12:01:00.277139-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep5","depends_on_id":"quad-ops-dep0","type":"blocks","created_at":"2025-11-12T12:01:00.277559-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dep6","content_hash":"533af0957ad3f223c48eea7f73370612cec49e66e1eefe6d1bf81e55be40d04e","title":"Phase 5: External Resource Validation","description":"Add validation for external dependencies (services, networks, volumes) before rendering. Platform-aware and batch-aware.\n\n**Behavior Change:**\n- Currently: External resources validated at runtime (systemd fails)\n- After: External resources validated before rendering with clear errors\n\n**User-Facing Test Scenarios (Write First):**\n1. External service exists → Validation passes\n2. External service missing (required) → Error before rendering\n3. External service missing (optional) → Warning, continues\n4. External network missing → Error with podman network create suggestion\n5. External volume missing → Error with podman volume create suggestion\n6. Batch deployment (both projects together) → Validation succeeds\n7. Platform-specific validation (systemd unit name vs launchd label)","design":"**Reference:** history/dependency-consolidation-summary.md lines 334-478\n\n**Implementation:**\n\n1. cmd/up.go and cmd/sync.go - Add helper functions:\n   - systemdUnitNameForService(project, service) → uses Prefix() + .service\n   - launchdLabelForService(project, service) → com.quad-ops.{project}.{service}\n\n2. cmd/up.go and cmd/sync.go - validateExternalDependencies():\n   - Batch-aware: check in-memory specs before Lifecycle.Exists()\n   - Platform-aware: use correct formatter based on platform\n   - Populate ExistsInRuntime flag\n   - Fail for missing required, warn for missing optional\n\n3. cmd/up.go and cmd/sync.go - validateExternalResources():\n   - Check external networks via podman network inspect\n   - Check external volumes via podman volume inspect\n   - Clear errors with actionable suggestions\n\n4. Call validators after processing compose, before rendering:\n   - Detect platform (systemd vs launchd)\n   - validateExternalDependencies(specs, lifecycle, logger, platform)\n   - validateExternalResources(specs, logger)","acceptance_criteria":"**Behavior-Driven Acceptance (Test First):**\n\nGiven app depending on external service infra-db\nAnd infra-db.service exists in systemd\nWhen I run quad-ops up\nThen validation passes (no error about missing service)\n\nGiven app depending on external service infra-api\nAnd infra-api NOT deployed\nWhen I run quad-ops up\nThen error before rendering: \"required external services not found: infra-api (ensure dependency projects are deployed first)\"\n\nGiven app using external network \"shared-net\"\nAnd network does NOT exist\nWhen I run quad-ops up\nThen error: \"external networks not found: shared-net (create with 'podman network create')\"\n\nGiven deploying infra and app projects together (batch)\nAnd app depends on infra-db\nWhen I run quad-ops up on both\nThen validation passes (infra-db satisfied by batch)\n\nGiven systemd platform\nWhen validating external service\nThen checks for unit name \"infra-db.service\"\n\nGiven launchd platform\nWhen validating external service\nThen checks for label \"com.quad-ops.infra.db\"\n\n**Code Acceptance:**\n- ✅ systemdUnitNameForService() uses Prefix()\n- ✅ launchdLabelForService() uses correct format\n- ✅ validateExternalDependencies() is batch-aware\n- ✅ validateExternalDependencies() is platform-aware\n- ✅ validateExternalResources() checks networks/volumes\n- ✅ ExistsInRuntime flag populated correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T12:01:20.577657-05:00","updated_at":"2025-11-12T13:42:10.786547-05:00","closed_at":"2025-11-12T13:42:10.786547-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-dep6","depends_on_id":"quad-ops-dep1","type":"blocks","created_at":"2025-11-12T12:01:20.578933-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep6","depends_on_id":"quad-ops-dep0","type":"blocks","created_at":"2025-11-12T12:01:20.579384-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep6","depends_on_id":"quad-ops-dep5","type":"blocks","created_at":"2025-11-12T12:01:20.579819-05:00","created_by":"daemon"},{"issue_id":"quad-ops-dep6","depends_on_id":"quad-ops-inqe","type":"blocks","created_at":"2025-11-12T13:24:41.439724-05:00","created_by":"daemon"}]}
{"id":"quad-ops-dqrd","content_hash":"ed1916fafa49d49aca29db2e38ed60ff0daed337ceff59d032c2d4b4c3abbc37","title":"Add go-cmp for deep equality comparisons in tests","description":"go-cmp is the de facto standard for deep equality checks with readable diffs in Go tests. Used by Kubernetes, Moby, Prometheus, and Consul. Currently we rely only on testify's assert.Equal which has less readable diffs for complex structures.\n\nSteps:\n1. Add dependency: go get github.com/google/go-cmp/cmp\n2. Identify complex struct comparisons in tests that would benefit from better diffs\n3. Replace with cmp.Diff() where appropriate\n4. Consider custom comparers for quad-ops specific types (service specs, Quadlet units)\n5. Document usage pattern in AGENTS.md\n\nExample usage:\n```go\nif diff := cmp.Diff(want, got); diff != \"\" {\n    t.Errorf(\"mismatch (-want +got):\\n%s\", diff)\n}\n```\n\nBenefits:\n- Better test failure diagnostics\n- Cleaner handling of unexported fields\n- Custom comparison options for complex types","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-12T09:25:15.678579-05:00","updated_at":"2025-11-12T09:55:54.460299-05:00","closed_at":"2025-11-12T09:55:54.460299-05:00","source_repo":"."}
{"id":"quad-ops-eca","content_hash":"ddb61c3cfa220c4f99a4c8c154b63d10905d21fad3a004a505dc65f90e784f1c","title":"Nested git repos still being processed despite .git skip logic","description":"After implementing .git directory detection to skip nested repository clones in compose/reader.go, mm-f1 services are still being processed from test/bdyvp22/quad-ops-deploy/prod/mm-f1/.\\n\\nThe nested quad-ops-deploy directory at test/bdyvp22/quad-ops-deploy/ contains a .git directory, but the walk is still descending into it and processing mm-f1 compose files.\\n\\n## Expected Behavior\\nWhen ReadProjects walks test/bdyvp22/, it should:\\n1. Process test/bdyvp22/devops, infrastructure, llm, media, monitoring/*, news/* (correct)\\n2. Skip test/bdyvp22/quad-ops-deploy because it contains .git\\n3. NOT process test/bdyvp22/quad-ops-deploy/prod/mm-f1\\n\\n## Actual Behavior\\nmm-f1 is still in the processed projects list.\\n\\n## Possible Issues\\n- Code change may not have been recompiled into the binary\\n- .git directory check logic may not be working as intended\\n- Verbose logging not showing the skip message means the code path may not be executing\\n- May need to verify the actual file path structure of the nested repo\",\n\u003cparameter name=\"design\"\u003eThe fix in compose/reader.go (lines 59-66) adds a check:\\n```go\\nif info.IsDir() {\\n    gitPath := filepath.Join(filePath, \\\".git\\\")\\n    if gitInfo, err := os.Stat(gitPath); err == nil \u0026\u0026 gitInfo.IsDir() {\\n        logger.Debug(\\\"Skipping nested repository directory\\\", \\\"path\\\", filePath)\\n        return filepath.SkipDir\\n    }\\n}\\n```\\n\\nBut the expected \\\"Skipping nested repository directory\\\" debug message is not appearing in the output, suggesting this code path is not being reached.\\n\\nNeed to:\\n1. Verify binary was rebuilt with the new code\\n2. Add additional logging to trace which directories are being examined\\n3. Verify the .git detection logic is correct\\n4. Consider alternative approach if current logic is insufficient\",\n\u003cparameter name=\"deps\"\u003e[\"quad-ops-pei\"]","acceptance_criteria":"Verify that mm-f1 is NOT processed when sync runs on a composeDir containing nested git repos\"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T13:24:19.227262073-05:00","updated_at":"2025-11-09T13:25:12.219288049-05:00","closed_at":"2025-11-09T13:25:12.219288049-05:00","source_repo":"."}
{"id":"quad-ops-eki","content_hash":"8cd30106d97c30ed08660f659a3b165190d1e66d957a8eb33559115f143c372c","title":"SystemD renderer generates incorrect volume/network dependency names","description":"The renderer writes container unit files that reference volumes and networks with `-volume` and `-network` suffixes, but the actual unit files use `.volume` and `.network` suffixes.\n\nThis causes systemd to fail to find the dependencies:\n- Container file wants: `After=media_immich-model-cache-volume.service Requires=media_immich-model-cache-volume.service`\n- Actual file: `media_immich-model-cache.volume`\n\nThis breaks all service startup since required volume/network units are not found.\n\nLines in renderer.go:\n- 148-149: volume dependencies use `-volume.service` but should be `.volume`\n- 158-159: network dependencies use `-network.service` but should be `.network`","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-08T20:56:23.385447554-05:00","updated_at":"2025-11-08T20:57:22.558326279-05:00","closed_at":"2025-11-08T20:57:22.558326279-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-eki","depends_on_id":"quad-ops-cn8","type":"blocks","created_at":"2025-11-08T20:56:23.390167589-05:00","created_by":"daemon"}]}
{"id":"quad-ops-f0n","content_hash":"e74117ca08bd00f22a02043d7cf8ccee2fe9bb3e7ca2fce61fe73d2af0732787","title":"Improve dependency resolution and cycle detection in dependency graph","description":"Enhance internal/dependency/dependency.go with cycle detection algorithm, improved error messages, and methods for dependency resolution and conflict detection. Add comprehensive unit tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T23:26:38.535540275-05:00","updated_at":"2025-11-07T00:44:14.553830389-05:00","closed_at":"2025-11-07T00:44:14.553830389-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-f0n","depends_on_id":"quad-ops-9y2","type":"parent-child","created_at":"2025-11-06T23:26:40.071540677-05:00","created_by":"daemon"}]}
{"id":"quad-ops-fdg","content_hash":"0d7f54f9f46a81fd828dcd5c40fdd30987bd99e95304f810525f6af43e76a05f","title":"Test: end-to-end scenario from quad-ops discussion #52","description":"Create integration test that simulates the original error scenario from https://github.com/trly/quad-ops/discussions/52\n\nTest case:\n- Multiple Docker Compose projects (dozzle, llm, scrutiny, beszel)\n- All reference shared infrastructure-proxy network\n- Verify converter produces correct network references without project prefixes\n- Verify renderer generates valid quadlet units for all projects\n\nThis validates the complete fix for the originally reported bug where containers referenced non-existent network units like dozzle-infrastructure-proxy.network instead of infrastructure-proxy.network.","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-09T12:32:26.433013033-05:00","updated_at":"2025-11-09T12:32:26.433013033-05:00","source_repo":"."}
{"id":"quad-ops-fw5","content_hash":"58b74329e4d666a9c55a26dd775605038a5f5a30c09c961d58460a683c8f43da","title":"Update golden test files after fixing double-prefixing in resource names","description":"The golden test files expect double-prefixed resource names (e.g., 'project-project_resource'), but the fix removed the double-prefixing. Update all golden test files to reflect the correct single-prefixed names.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-06T23:43:36.979420254-05:00","updated_at":"2025-11-07T00:25:29.909893381-05:00","closed_at":"2025-11-07T00:25:29.909893381-05:00","source_repo":"."}
{"id":"quad-ops-g38","content_hash":"8a8667a6a93141e6364c52d31cf06702107c1d57fb4013f4d2ebb8cf11bb162f","title":"Step 3: Refactor container rendering to use QuadletWriter","description":"Migrate [Unit], [Container], [Service], [Install] sections to writer-based assembly for clarity and size reduction.\n\nIntent: Convert renderContainer() to use QuadletWriter for all sections, reducing duplication and improving readability.\n\nFiles affected:\n- internal/platform/systemd/renderer.go (renderContainer method)\n- internal/platform/systemd/helpers.go (dependency utilities)\n\nChanges:\n- Replace strings.Builder with QuadletWriter for [Unit] section\n- Migrate dependency directives (After, Requires, RequiresMountsFor) to writer\n- Convert [Container] section to use writer.Set/Append for directives\n- Convert [Service] section to use writer for restart policies\n- Convert [Install] section to use writer\n- Extract joinSections() helper to combine sections with blank lines\n- Deduplicate sorting logic via helper functions\n\nPreconditions: QuadletWriter stable; dependency helper utilities drafted\nPostconditions: Container rendering logic shortened, behavior unchanged, helper functions deduplicated\nChecks: Table-driven golden tests, go test ./internal/platform/systemd/...","notes":"## ✅ Completed Work\n\n### Achievements\n- ✅ Fixed StopTimeoutSec bug (was in [Container], now in [Service] section)\n- ✅ Completely migrated renderContainer() to use QuadletWriter\n- ✅ Refactored into 3 clean helper methods: writeUnitSection, writeContainerSection, writeServiceSection\n- ✅ Migrated all 4 remaining helper methods to QuadletWriter:\n  - addEnvironment (uses AppendMap)\n  - addPorts (uses AppendSorted)\n  - addMounts (uses AppendSorted)\n  - addNetworks (uses Set/Append)\n- ✅ All tests passing (1103 tests)\n- ✅ Golden files updated\n- ✅ File size reduced: 1214 lines → 1122 lines (-92 lines, -7.6%)\n\n### Code Quality Improvements\n- Single QuadletWriter instance per container unit\n- Eliminated duplicate string building logic\n- Consistent section ordering: [Unit] → [Container] → [Service] → [Install]\n- Empty [Unit] sections now omitted (cleaner output)\n- Better separation of concerns with helper methods\n\n### Remaining strings.Builder Usage\nThe remaining strings.Builder usages are in OTHER render methods (not renderContainer):\n- renderVolume (line 698)\n- renderNetwork (line 766)\n- renderBuild (line 877)\n- renderExternalNetwork (line 894)\n\nThese are out of scope for this task, which focused on renderContainer refactoring.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T12:31:08.161919-05:00","updated_at":"2025-11-11T13:22:36.71223-05:00","closed_at":"2025-11-11T13:22:36.71223-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-g38","depends_on_id":"quad-ops-284","type":"blocks","created_at":"2025-11-11T12:31:08.16262-05:00","created_by":"daemon"}]}
{"id":"quad-ops-g76","content_hash":"83596d521a1f674b16ab9c85779cb9fb7d0c4de8a297ec01970bc3baaf68add8","title":"create config init command","description":"","design":"Implement a new config sub-command init\n\nThis should:\n- follow existing sub-command patterns\n- setup a default config in either the default user location or system location pointing to quad-ops examples in the repository\n  ```yaml\n  repositories:\n  - name: quad-ops-compose  # Repository name (required)\n    url: \"https://github.com/example/repo.git\"  # Git repository URL (required)\n    ref: \"main\"  # Git reference to checkout: branch, tag, or commit hash (optional)\n    composeDir: \"compose\"  # Subdirectory where Docker Compose files are located (optional)\n  ```\n","acceptance_criteria":"Command successfully creates an example config, has passing tests, and builds successfully\n","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-06T21:13:51.911801815-05:00","updated_at":"2025-11-06T21:22:11.392787089-05:00","closed_at":"2025-11-06T21:22:11.392787089-05:00","source_repo":"."}
{"id":"quad-ops-gle","content_hash":"5bd367147d8d2f9a073a49f94d080cd97d1f1ed8da25ad10cfedd12dc6448fe6","title":"Remove artifact upload conditional from build.yml","description":"Remove the `if: startsWith(github.ref, 'refs/tags/')` condition from the artifact upload step (line 84-91) so artifacts are saved on every commit, not just tags.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-08T21:51:02.241460002-05:00","updated_at":"2025-11-08T22:08:03.678381934-05:00","closed_at":"2025-11-08T22:08:03.678381934-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-gle","depends_on_id":"quad-ops-1bz","type":"discovered-from","created_at":"2025-11-08T21:51:02.245596857-05:00","created_by":"daemon"}]}
{"id":"quad-ops-gwj","content_hash":"4e114dd75e2d43e81b86bc792e8b732e00b43155eaa976199e2310615ae3dda9","title":"Lost Compose depends_on conditions - no service_healthy or condition support","description":"convertDependencies is called but doesn't implement condition parsing (service_started, service_healthy). Renderer treats all dependencies uniformly (After/Requires), losing condition semantics from v0.21.2.","design":"Implement convertDependencies to parse Compose v2 semantics: service_started and service_healthy both map to After/Requires in systemd (healthy gating cannot be enforced without larger design, but preserve order). Treat missing/unknown condition as service_started. Validate cross-spec dependencies in service.Validate or post-pass to error if Spec.DependsOn references unknown service specs.","acceptance_criteria":"- depends_on with conditions are parsed and converted to After/Requires\n- Unknown service dependencies cause validation errors\n- Order preservation matches v0.21.2 behavior","notes":"Implementation complete:\n- Added comprehensive tests covering all condition types (service_started, service_healthy, service_completed_successfully, missing, unknown)\n- Updated convertDependencies() to parse and validate conditions\n- All conditions map to After/Requires in systemd (documented in code)\n- Unknown conditions treated as service_started\n- Order preservation maintained via sorting\n- All 1052 tests pass (added 9 new tests)\n\nNote: Cross-spec dependency validation (unknown service errors) deferred to quad-ops-ts0 as it requires broader validation framework.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T13:44:34.746029-05:00","updated_at":"2025-11-09T14:40:04.114721-05:00","closed_at":"2025-11-09T14:40:04.114721-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-gwj","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.746484-05:00","created_by":"daemon"}]}
{"id":"quad-ops-h0f","content_hash":"9a74abada337a7b8ac1c653fa40df231a1fedbc540e624642c0589887bbc59bd","title":"Missing Compose feature: extra_hosts (AddHost)","description":"v0.21.2 supported extra_hosts via AddHost field. Current models.go has no Container.AddHost field and spec_converter doesn't convert it.","design":"Add Container.AddHost []string field in models.go. Convert service.ExtraHosts in spec_converter. Render as AddHost= directives in systemd renderer.","acceptance_criteria":"- extra_hosts in compose converts to AddHost directives\n- Multiple extra_hosts render correctly\n- Test coverage for extra_hosts conversion","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T13:44:34.768476-05:00","updated_at":"2025-11-09T15:15:08.912717-05:00","closed_at":"2025-11-09T15:15:08.912717-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-h0f","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.768983-05:00","created_by":"daemon"}]}
{"id":"quad-ops-h0s","content_hash":"820604479d74f50e27569aa083bd1d1113604e0bb7507618a9263c26c28d0948","title":"Investigate service activation timeout handling for long-starting services","description":"During testing, multi-service-webapp service failed with activation timeout error but actually succeeded after the timeout period. The waitForActivation logic needs improvement to handle services that take longer than expected to start.\n\nNeed to:\n- Review waitForActivation timeout logic and substate handling\n- Consider making timeouts more configurable or adaptive\n- Add better detection of when a service is actually starting vs truly failed\n- Test with services that have long startup times (image pulls, initialization)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-07T00:39:19.991396935-05:00","updated_at":"2025-11-11T20:45:05.209234-05:00","closed_at":"2025-11-11T20:45:05.209234-05:00","source_repo":".","labels":["lifecycle","systemd","timeout"]}
{"id":"quad-ops-h26","content_hash":"1537b3babfc003e2512104485c4f6a5a42dceeda897815aeeca6e508bba66fe3","title":"Fix Quadlet volume directive: remove incorrect .volume suffix","description":"The renderer incorrectly appends `.volume` suffix to volume sources in Quadlet Volume= directives.\n\n**Location:** internal/platform/systemd/renderer.go lines 290-291\n\n**Current behavior:**\n```go\nif m.Type == service.MountTypeVolume {\n    source = source + \".volume\"  // Incorrect - Quadlet handles this automatically\n}\n```\n\nProduces: `Volume=miniflux_db-data.volume:/path`\n\n**Expected behavior:**\nRemove the `.volume` suffix. Quadlet resolves named volumes automatically:\n- Correct: `Volume=miniflux-db-data:/path/in/container`\n- Incorrect: `Volume=miniflux_db-data.volume:/path/in/container`\n\n**Documentation:** Per Podman docs, if SOURCE-VOLUME ends with `.volume`, Quadlet looks for that file and creates a dependency. For named volume references without explicit unit files, the suffix should NOT be included.\n\n**Effect:** Exacerbates volume name escaping bug—quadlet generator fails with \"requested Quadlet source not found\"\n\n**Part of:** https://github.com/trly/quad-ops/discussions/52 (Quadlet generator analysis)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T12:22:21.895650177-05:00","updated_at":"2025-11-09T12:33:45.234454271-05:00","closed_at":"2025-11-09T12:33:45.234454271-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-h26","depends_on_id":"quad-ops-712","type":"blocks","created_at":"2025-11-09T12:22:21.896346729-05:00","created_by":"daemon"},{"issue_id":"quad-ops-h26","depends_on_id":"quad-ops-3kb","type":"related","created_at":"2025-11-09T12:22:25.12199568-05:00","created_by":"daemon"}]}
{"id":"quad-ops-h7w","content_hash":"eafceb8a05ad0d9c448971d9489d5ccd2595d8b2957dcdd0b115b3cf45dd7830","title":"Validate end-to-end unit_list behavior on systemd and launchd","description":"After code changes and tests are complete, validate the fix works end-to-end. Manual verification on Linux with systemd, macOS with launchd. Verify unit list returns deployed units, status lookups work, filtering is correct, and no regressions in test suite or linter.","acceptance_criteria":"Manual testing on Linux (systemd) passes. Manual testing on macOS (launchd) passes. Full test suite passes without regressions. Linter passes without issues. Test coverage maintained or improved. No new warnings or errors introduced.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-08T16:02:54.788929932-05:00","updated_at":"2025-11-11T20:45:05.215302-05:00","closed_at":"2025-11-11T20:45:05.215302-05:00","source_repo":".","labels":["e2e","manual-test","validation"]}
{"id":"quad-ops-hak","content_hash":"3884ea4268c3d05e573fd2f95e849da12cc17456ccd58794d4dee716230d01c1","title":"Update launchd renderer to connect services to their declared networks","description":"Update internal/platform/launchd/podmanargs.go to handle service-level networks.\n\nThe function BuildPodmanArgs needs to:\n1. Extract service networks from spec.Networks\n2. Add --network flag for each network the service should join\n3. Handle multiple network connections properly (order matters for primary network)\n\nCurrently only spec.Container.Network.Mode is used. Need to expand to include all declared networks.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T15:58:03.016095468-05:00","updated_at":"2025-11-08T16:55:43.936761371-05:00","closed_at":"2025-11-08T16:55:43.936761371-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-hak","depends_on_id":"quad-ops-69e","type":"blocks","created_at":"2025-11-08T15:58:03.020597325-05:00","created_by":"daemon"}]}
{"id":"quad-ops-hlf","content_hash":"607843d302d64dced0337418f5bfc1fd9edaf022daad1bd94c1650a9689defd9","title":"Remaining Work: Cross-platform Parity \u0026 Compose Feature Completeness","description":"Comprehensive review of all changes since v0.21.2 to identify and track regressions introduced during the v0.22.0 refactoring. Focus areas: dependencies, sync order, and functional parity with the working v0.21.2 release.","acceptance_criteria":"- All issues in epic are resolved\n- v0.21.2 functionality fully restored\n- All critical dependencies and networking behavior restored\n- All resource constraints working correctly\n- All mount options supported (nocopy, SELinux, tmpfs)\n- All Compose features restored (extra_hosts, dns, devices, init containers)","notes":"INVESTIGATION COMPLETE\n\n**Analysis Documents**:\n- history/regression-analysis-v0.22.0.md (comprehensive findings)\n- history/regression-fix-status.md (prior work \u0026 fix status)\n\n**Key Findings**:\n- 15 regressions identified, 1 already fixed (quad-ops-lpb)\n- 5 have related prior work (partial fixes or conflicts)\n- 9 have no prior attempts\n\n**Critical Insights**:\n1. External networks fixed (quad-ops-1sn, 6ph, 0r1)\n2. Service networks restored (quad-ops-cn8)\n3. Dependency suffixes fixed (quad-ops-eki, h26, 712)\n4. Resource constraints partially done (quad-ops-24q)\n5. Name normalization creates compatibility issue (quad-ops-6rg vs quad-ops-ksi)\n\n**Major Gaps**:\n- Over-broad volume dependencies (all services depend on all volumes)\n- Missing network-online.target\n- Missing RequiresMountsFor\n- depends_on conditions not parsed\n- Init containers simplified (volumes/networks/env dropped)\n- Missing Compose features (extra_hosts, dns, devices)\n\n**Next Steps**:\nPhase 1: Resolve inter-dependencies (p22 vs 8oo, ksi vs 6rg)\nPhase 2: Critical fixes (iaa, i12, 581)\nPhase 3: Dependency completeness (gwj)\nPhase 4: Feature parity (1wy, h0f, 4i2, 167)\nPhase 5: Mount options (xru, rqe, d4k)","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-09T13:34:33.999764-05:00","updated_at":"2025-11-09T23:06:28.824106-05:00","closed_at":"2025-11-09T23:06:28.824106-05:00","source_repo":"."}
{"id":"quad-ops-i12","content_hash":"7022fffcb775aae59205e305def08d1098fe8bc8f7f21308002ff7ac89658740","title":"Missing network-online.target dependencies for network reliability","description":"Container units don't include After=network-online.target and Wants=network-online.target. This causes containers to start before network is fully initialized, leading to port binding failures and DNS issues.","design":"Add Wants=network-online.target and After=network-online.target to container units when the container uses any networks or has PublishPort directives. Location: renderContainer() around line 133 in internal/platform/systemd/renderer.go.","acceptance_criteria":"- Containers with networks include network-online.target dependency\n- Containers with published ports include network-online.target dependency\n- Boot-time network races are eliminated","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T13:44:34.731707-05:00","updated_at":"2025-11-09T14:29:37.228283-05:00","closed_at":"2025-11-09T14:29:37.228283-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-i12","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.732127-05:00","created_by":"daemon"}]}
{"id":"quad-ops-ia2","content_hash":"3485ff7c8638cc1ee005d52214d24e73c94709376fd8aeec615e6548079bf897","title":"artifact_helpers.go - launchd.Options has no field or method LabelPrefix","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-06T20:28:13.28390877-05:00","updated_at":"2025-11-06T20:31:56.072325037-05:00","closed_at":"2025-11-06T20:31:56.072325037-05:00","source_repo":"."}
{"id":"quad-ops-iaa","content_hash":"c841f692cf280275916133092f6f5acf9405cf6028f925a079b97c9cd0668d37","title":"Over-broad volume dependencies - services depend on unrelated volumes","description":"spec_converter.go:convertService sets spec.Volumes = convertProjectVolumes(project) for every service, causing all services to depend on ALL project volumes regardless of actual usage. Renderer then adds After/Requires for all those volumes.","design":"Change SpecConverter.convertService to set spec.Volumes = only the project volumes actually referenced in composeService.Volumes of type \"volume\", not all project volumes. Renderer behavior unchanged - continues adding After/Requires for spec.Volumes (which will now be accurate).","acceptance_criteria":"- Services only depend on volumes they actually use\n- Service without volumes has no volume dependencies\n- Multiple services can share same volume (deduplication in artifact store)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T13:44:34.71062-05:00","updated_at":"2025-11-09T14:25:03.092827-05:00","closed_at":"2025-11-09T14:25:03.092827-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-iaa","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.712209-05:00","created_by":"daemon"}]}
{"id":"quad-ops-inqe","content_hash":"bdab027efa2bde7daf395b71026db280e9b24844b73aa4e562020bccad1d70e6","title":"Phase 4.5: Renderer Integration for External Dependencies","description":"Complete renderer integration for x-quad-ops-depends-on now that parsing is complete in quad-ops-dep5.\n\n**systemd renderer (internal/platform/systemd/quadlet.go):**\n- ✅ writeUnitSection() modified to handle ExternalDependencies\n- ✅ Required deps: After= + Requires=\n- ✅ Optional deps: After= only (NOT Wants=)\n- ✅ Unit names: project-service.service format\n- ✅ Sorted output for determinism\n- ✅ Tests added and passing\n\n**launchd renderer (internal/platform/launchd/renderer.go):**\n- ✅ renderService() modified to handle ExternalDependencies\n- ✅ Format: {prefix}.{project}.{service}\n- ✅ Skip optional deps where ExistsInRuntime == false\n- ✅ Sorted DependsOn array\n- ✅ Tests added and passing\n\n**No additional work needed** - renderer integration completed as part of quad-ops-dep5.","design":"This task was completed as part of quad-ops-dep5. All renderer changes are done and tested.","acceptance_criteria":"✅ systemd renderer handles external deps correctly\n✅ launchd renderer handles external deps correctly\n✅ All renderer tests pass\n✅ Generated units have correct dependency directives","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T13:24:31.44182-05:00","updated_at":"2025-11-12T13:24:36.144367-05:00","closed_at":"2025-11-12T13:24:36.144367-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-inqe","depends_on_id":"quad-ops-dep5","type":"blocks","created_at":"2025-11-12T13:24:31.443847-05:00","created_by":"daemon"}]}
{"id":"quad-ops-j0q","content_hash":"c3df32373b8543581a6f953737f68ece9f08c7c1522917e86bbab63e709612b7","title":"Implement Memory and MemorySwap directive rendering","description":"Update systemd renderer addResources() to output Memory=, MemoryReservation=, and MemorySwap= directives to [Container] section when values are present. These map directly to Quadlet native support.","acceptance_criteria":"- Memory field renders as Memory=\u003cvalue\u003e\n- MemoryReservation field renders as MemoryReservation=\u003cvalue\u003e\n- MemorySwap field renders as MemorySwap=\u003cvalue\u003e\n- Empty/zero values are not rendered\n- Directives appear in [Container] section of generated unit file\n- Tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T21:37:08.173079953-05:00","updated_at":"2025-11-08T21:40:00.940910583-05:00","closed_at":"2025-11-08T21:40:00.940910583-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-j0q","depends_on_id":"quad-ops-24q","type":"parent-child","created_at":"2025-11-08T21:37:08.177366531-05:00","created_by":"daemon"}]}
{"id":"quad-ops-jes","content_hash":"66bc6fefcfe63b54ed8c4dbde0ca61beec2e4daa2b3b6bd5f2c291c6de326bbf","title":"Refactor internal-testing tests to behavior-based tests","description":"**Test quality issue:** Multiple tests assert on internal implementation details instead of public behavior.\n\n**Tests that likely test internals (need review):**\n- TestRequiresMountsFor_* - tests helper function, not public API\n- TestRenderer_TmpfsOptions - may test internal formatting\n- TestRenderer_Sysctls* - may test internal directive generation\n- TestNetworkOnlineTarget_* - tests implementation detail\n\n**Problem:**\n- Tests that pin internals prevent refactoring\n- Internal tests break when simplifying code structure\n- Not aligned with behavior-focused testing philosophy\n\n**Solution:**\nReplace with behavior tests that:\n- Input: service.Spec (public)\n- Output: rendered artifact content (public)\n- Validate final behavior, not intermediate steps\n- Use golden tests or table-driven tests\n\n**Approach:**\n1. Review each test file in internal/platform/systemd/*_test.go\n2. Identify tests asserting on non-exported types/functions\n3. Delete or refactor to test via public Render() method\n4. Add golden test cases if behavior isn't covered\n\n**Benefits:**\n- Tests remain stable during refactoring\n- Can simplify internals without breaking tests\n- Enables full-pipeline-simplification progress\n\n**Effort:** Medium (1-3 hours repo-wide)\n\n**Reference:** Oracle review test quality section, AGENTS.md (test through public API exclusively)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T17:05:30.822744-05:00","updated_at":"2025-11-11T19:55:36.060206-05:00","closed_at":"2025-11-11T19:55:36.060206-05:00","source_repo":"."}
{"id":"quad-ops-jg5","content_hash":"618cfff75d3c39435d617b0605e4a873510010f445b3f80df9adc1bf9a09c16d","title":"Missing stop_signal and stop_grace_period rendering (both platforms)","description":"Compose stop_signal and stop_grace_period are parsed and converted but never rendered, causing all containers to use default SIGTERM + 10s timeout.\n\nImpact: Custom stop signals ignored, grace periods ignored, potential data loss on hard kill.","design":"## Implementation Plan\n\n### 1. systemd Renderer (internal/platform/systemd/renderer.go)\n**Native Quadlet directives (preferred approach)**\n- Add `StopSignal` directive mapping from Container.StopSignal\n  - Default: \"SIGTERM\" (if empty)\n  - Format: Signal name without SIG prefix (e.g., \"TERM\", \"KILL\")\n  - Placement: [Service] section\n- Add `StopTimeoutSec` directive mapping from Container.StopGracePeriod\n  - Convert time.Duration to seconds\n  - Default: 10s (if zero)\n  - Format: Integer seconds (e.g., \"30\")\n  - Placement: [Service] section\n\n**Implementation steps**:\n1. Verify Container struct fields are populated by spec_converter\n2. Add conditional rendering in serviceFileContent() or renderService()\n3. Handle zero/empty values with Podman defaults\n4. Test both custom and default values\n\n### 2. launchd Renderer (internal/platform/launchd/podmanargs.go)\n**Podman run flags (only option for launchd)**\n- Add `--stop-signal` flag\n  - Value: Container.StopSignal (or default \"SIGTERM\")\n  - Append to podman run arguments\n- Add `--stop-timeout` flag\n  - Convert Container.StopGracePeriod to seconds\n  - Default: 10 seconds\n  - Append to podman run arguments\n\n**Implementation steps**:\n1. Identify where podman run arguments are built\n2. Add logic after main container arguments\n3. Ensure proper ordering (signals before timeout)\n4. Test with Podman macOS compatibility\n\n### 3. Validation \u0026 Testing\n**Unit tests** (table-driven):\n- Test systemd with custom signal + grace period\n- Test systemd with defaults (empty values)\n- Test systemd with SIGKILL (hard termination)\n- Test launchd with custom signal + timeout\n- Test launchd with defaults\n- Test edge cases (zero duration, empty signal)\n\n**Integration tests**:\n- Render complete Compose → verify output directives present\n- Verify signal names rendered correctly (TERM vs SIGTERM)\n- Verify duration conversion (10s → \"10\", 1m → \"60\")\n\n### 4. Files to Modify\n- `internal/platform/systemd/renderer.go` - Add directives\n- `internal/platform/launchd/podmanargs.go` - Add flags\n- `internal/platform/systemd/renderer_test.go` - Unit tests\n- `internal/platform/launchd/podmanargs_test.go` - Unit tests\n\n### 5. Success Criteria\n- ✅ StopSignal directive appears in systemd output\n- ✅ StopTimeoutSec directive appears in systemd output\n- ✅ --stop-signal flag appears in launchd podman args\n- ✅ --stop-timeout flag appears in launchd podman args\n- ✅ All test cases passing (\u003e95% coverage)","acceptance_criteria":"- stop_signal renders to StopSignal= on systemd\n- stop_grace_period renders to StopTimeoutSec= on systemd\n- stop_signal renders to --stop-signal on launchd\n- stop_grace_period renders to --stop-timeout on launchd\n- Test coverage for both platforms","notes":"Verified Quadlet native support:\n- StopSignal (native Quadlet directive)\n- StopTimeout (native Quadlet directive)\n\nAlso supported via Podman flags:\n- podman run --stop-signal\n- podman run --stop-timeout\n\nImplementation: Use native Quadlet directives on systemd, Podman flags on launchd","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T16:40:17.240822-05:00","updated_at":"2025-11-09T19:07:15.3746-05:00","closed_at":"2025-11-09T19:07:15.3746-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-jg5","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.506144-05:00","created_by":"daemon"}]}
{"id":"quad-ops-jp2","content_hash":"f6319f895f7a5138e86c9400d798a0b5b9009304a1530599befcdeb376dbe780","title":"Remove all divergence checks from unit list command","description":"The divergence check in the unit list command is no longer useful since we fixed the issue with package services being detected as managed units. The divergence check was designed to detect configuration drift between what should be deployed (from compose sources) vs what is deployed, but with the fix, the repo artifact store now correctly tracks only expected artifacts, making divergence checks redundant.","design":"Remove the checkDivergence method and related logic from unit_list.go. Simplify the unit list command to only show deployed artifacts without warnings about divergence.","acceptance_criteria":"Unit list command runs without divergence warnings, and the --show-divergence flag can be removed or made no-op.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-07T00:19:28.636456371-05:00","updated_at":"2025-11-07T00:23:48.322603169-05:00","closed_at":"2025-11-07T00:23:48.322603169-05:00","source_repo":".","labels":["cleanup","refactor"]}
{"id":"quad-ops-jto6","content_hash":"fc41eb03203500f5b69001da99134d411240782dcc7314dde8d40c141a827157","title":"Phase 6: Update Documentation for Breaking Changes","description":"Update user-facing documentation to reflect breaking changes from dependency consolidation work.\n\n**Breaking Changes to Document:**\n\n1. **Sanitization Removed (quad-ops-dep0 - COMPLETED)**:\n   - Previously: Invalid names silently transformed (e.g., \"My-Project!\" → \"my-project\")\n   - Now: Invalid names rejected with clear error messages\n   - Affects: Users with existing compose files containing invalid project/service names\n\n**Key Documentation Updates:**\n\n1. **README.md** - Add naming requirements section:\n   - Project names must match: ^[a-z0-9][a-z0-9_-]*$\n   - Service names must match: ^[a-zA-Z0-9][a-zA-Z0-9_.-]*$ (allows uppercase, periods)\n   - Clear examples of valid/invalid names\n   - Migration examples for common invalid names\n\n2. **QUICKSTART.md** - Update examples to use valid names only\n\n3. **Migration guide** (new section in README):\n   - Breaking change: sanitization removed in favor of strict validation\n   - How to fix invalid names in existing compose files\n   - Examples of common invalid → valid migrations:\n     * \"My-Project\" → \"my-project\"\n     * \"my_project!\" → \"my-project\"\n     * \"_myproject\" → \"myproject\"\n   - Directory names with uppercase/special chars now fail validation\n\n4. **x-quad-ops-depends-on extension** (future phases):\n   - Document cross-project dependency syntax\n   - Show required vs optional dependency examples\n   - Platform-specific behavior notes\n\n**Files to Update:**\n- README.md (naming requirements + migration guide)\n- QUICKSTART.md (if exists - ensure examples use valid names)\n- Any other user-facing docs referencing project/service names","notes":"Breaking changes from quad-ops-dep2 (COMPLETED):\n\n2. **Quadlet Dependency Optimization (quad-ops-dep2 - COMPLETED)**:\n   - Previously: Generated .container files contained redundant After=/Requires= directives for networks, volumes, and builds\n   - Now: Quadlet automatically handles these dependencies via Network=, Volume=, and Image= directives\n   - Affects: Generated .container files are cleaner and rely on Quadlet's automatic dependency system\n   - **Internal change only** - No user action required. Quadlet handles dependencies automatically.\n   - Named volumes now use Quadlet reference syntax: Volume=name.volume:/path\n   - Build images now use Quadlet reference syntax: Image=name.build\n   - Service-to-service dependencies (depends_on) still use manual After=/Requires= directives\n\nBreaking changes from quad-ops-dep3 (COMPLETED):\n\n3. **Sync Restart Ordering (quad-ops-dep3 - COMPLETED)**:\n   - Previously: sync command restarted services alphabetically (no dependency awareness)\n   - Previously: systemd RestartMany used parallel goroutines (race conditions possible)\n   - Now: sync restarts services in topological order (dependencies first)\n   - Now: Both systemd and launchd RestartMany process sequentially\n   - Affects: Service restart order during sync operations\n   - **Internal improvement** - No user action required. Ensures dependencies restart before dependents.\n   - Eliminates race conditions where dependent service might start before dependency is ready","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T12:05:55.06088-05:00","updated_at":"2025-11-12T13:55:41.791764-05:00","closed_at":"2025-11-12T13:55:41.791764-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-jto6","depends_on_id":"quad-ops-dep1","type":"parent-child","created_at":"2025-11-12T12:05:55.062803-05:00","created_by":"daemon"}]}
{"id":"quad-ops-jxm","content_hash":"173508993f5250e344e83d6be8222dffd264bfa5b0fe5177dc05b31db5a7bd1c","title":"Verify line count reduction target: 9,558 non-test lines (target was ≤2,750)","description":"Current non-test line count is 9,558 lines. Original acceptance criteria specified ≤2,750 lines (78% reduction from 12,432).\n\nNeed to verify:\n1. Was the target realistic?\n2. What was the baseline measurement methodology?\n3. Should acceptance criteria be updated to reflect actual achievable simplification?\n\nCurrent state after simplification:\n- Total internal/*.go: 19,319 lines (includes tests)\n- Non-test code: 9,558 lines\n- Tests pass, coverage maintained at 68.9%\n\nReference: quad-ops-7 acceptance criteria mentions \"12,432 → ≤2,750 lines (78% reduction)\"","acceptance_criteria":"✅ Realistic line count targets updated:\n- Compose: ~1,200-1,600 lines (post-extraction and dedupe)\n- Platform/systemd: ~1,400-1,800 lines (renderer + lifecycle)\n- Platform/launchd: ~900-1,200 lines (already achieved)\n- Total: 7,000-9,000 lines (30-45% reduction from 12,432)\n- Complexity: No function \u003e30 cyclomatic complexity\n- All linters pass\n- Coverage maintained at 68.9%+\n- Golden tests pass (byte-identical output)","notes":"Oracle analysis confirms original 78% reduction target (12,432 → 2,750) was unrealistic with current scope.\n\n**Current State (non-test lines):**\n- compose: 1,686 lines (target was \u003c400)\n- platform/systemd: 1,613 lines (target was \u003c1,300) \n- platform/launchd: 1,127 lines (target was \u003c1,300)\n- internal/systemd (orchestration): 1,885 lines (not in original count)\n- Other packages (service, repository, podman, validate, log): 2,147 lines\n- **Total: 9,558 lines**\n\n**Why Target Was Unrealistic:**\nThe original estimate assumed removing the internal/systemd orchestration layer (DBus wrappers, unit manager, orchestrator). Keeping comprehensive compose→quadlet feature mapping + orchestration makes 78% reduction impossible.\n\n**Realistic Achievable Target: 30-45% reduction (7,000-9,000 lines)**\n\n**Immediate Opportunities (300-600 line reduction):**\n1. Extract helpers from complexity hotspots:\n   - compose.convertContainer (complexity 65 → \u003c30)\n   - compose.convertInitContainers (complexity 45 → \u003c30)\n   - systemd.writeContainerSection (complexity 66 → \u003c30)\n2. Deduplicate network/env mapping across compose functions\n3. Delete compose/interfaces.go (unused)\n4. Consider folding compose/processor.go\n\n**Advanced Path (50%+ reduction, higher risk):**\n- Retire internal/systemd orchestration layer\n- Collapse to minimal DBus client + lifecycle\n- Expect thousands of lines removed but significant testing needs\n\n**Recommendation:** Update acceptance criteria to realistic ranges, focus on unblocking linter via helper extraction, defer architectural changes to separate project.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-11T18:53:45.52919-05:00","updated_at":"2025-11-11T20:01:08.732444-05:00","closed_at":"2025-11-11T20:01:08.732444-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-jxm","depends_on_id":"quad-ops-7","type":"discovered-from","created_at":"2025-11-11T18:53:45.539533-05:00","created_by":"daemon"}]}
{"id":"quad-ops-k86","content_hash":"e54f265dff1a38b4ea0bf7ade58b71016c146c5dc963bed677e4e0b602c65fbc","title":"quad-ops package services are detected as managed units","description":"Findings from analysis of artifact_helpers.go and unit_list.go divergence check: artifact_helpers.go provides cross-platform helpers for parsing service names, filtering artifacts by platform, and excluding unmanaged paths (e.g., .git, build dirs). The divergence check compares repository artifacts (git-managed) vs filesystem artifacts (deployed), identifying extra files on disk, missing deployments, and content mismatches via hash comparison.","design":"Only be concerned with services generated from the composeDir defined in internal/config for internal/repository. Configuration drift should represent what units/plists **should** be rendered (from compose sources) vs which **are** rendered, and if the on-disk unit appears to have been modified and doesn't or won't match what will be rendered.","notes":"❯ ./quad-ops -u unit list\ntime=2025-11-06T23:59:42.550-05:00 level=WARN msg=\"Divergence detected between repository and filesystem artifacts\"\ntime=2025-11-06T23:59:42.550-05:00 level=WARN msg=\"Artifacts in repository but not deployed\" count=2 paths=\"[quad-ops-examples/build/package/quad-ops@.service quad-ops-examples/build/package/quad-ops.service]\"\n","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-07T00:02:12.622566492-05:00","updated_at":"2025-11-07T00:19:25.156809673-05:00","closed_at":"2025-11-07T00:19:25.156809673-05:00","source_repo":"."}
{"id":"quad-ops-kgm","content_hash":"421787238218da3e25663db0c4a8da2a3d7030731c31cbc695ec908a3a3059bc","title":"Review network dependency handling for unnecessary coupling","description":"The renderer adds dependencies on ALL networks in the spec if the container doesn't explicitly list service networks:\n\n```go\nif len(c.Network.ServiceNetworks) \u003e 0 {\n    // Uses service-specific networks ✅\n} else {\n    // Falls back to ALL networks in spec ⚠️ \n    for _, net := range spec.Networks {\n        if !net.External {\n            builder.WriteString(fmt.Sprintf(\\\"After=%s.network\\\\n\\\", net.Name))\n            builder.WriteString(fmt.Sprintf(\\\"Requires=%s.network\\\\n\\\", net.Name))\n        }\n    }\n}\n```\n\nThis creates unnecessary dependencies and could cause ordering issues. Consider only adding networks the container actually uses.","acceptance_criteria":"Review network dependency logic. Consider adding validation to warn if container's networks don't match declared spec networks. Update fallback logic to be more conservative.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-08T21:09:03.119049724-05:00","updated_at":"2025-11-10T00:16:28.197863-05:00","closed_at":"2025-11-10T00:05:41.198259573-05:00","source_repo":".","labels":["quadlet","task"]}
{"id":"quad-ops-ksi","content_hash":"3a4d1c7e01d31f37f7a03454b8ff78b473afa4f620602d182f68000eb8d1045a","title":"Name instability - SanitizeName converts underscores to hyphens breaking compatibility","description":"SanitizeName converts underscores to hyphens (validate.go), potentially renaming units versus v0.21.2 and breaking dependency edges and sync detection.","design":"Preserve underscores in SanitizeName (don't convert) for backward compatibility. Only strip truly invalid characters. This prevents unit name changes that break dependency edges. Consider feature-flag or migration path.","acceptance_criteria":"- Service/volume/network names with underscores preserve underscores\n- Names match v0.21.2 naming\n- Dependencies resolve correctly with underscored names","notes":"CONFLICT: quad-ops-6rg (commit c25e201) normalized names to use hyphens for DNS compliance, but this breaks v0.21.2 compatibility which used underscores. Need migration strategy or feature flag to preserve old behavior.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T13:44:34.752942-05:00","updated_at":"2025-11-09T14:51:38.369931-05:00","closed_at":"2025-11-09T14:51:38.369931-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-ksi","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.753468-05:00","created_by":"daemon"}]}
{"id":"quad-ops-ld0","content_hash":"aab21b38d9f5bfb197854e6126749b58bf6e624938a99991ac023e1c60fc2fd4","title":"Duplicate PidsLimit directive can be rendered","description":"The renderer has two independent sources for PidsLimit that can both be written to the unit file:\n- Container.Resources.PidsLimit\n- Container.PidsLimit (duplicate field)\n\nBoth can be non-zero and both will be rendered, creating duplicate directives. Model should consolidate to single source.","acceptance_criteria":"Consolidate PidsLimit to single source. Document which field is the canonical one. Update rendering logic to use only one source. Add test to prevent duplicate directives.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-08T21:09:03.034343707-05:00","updated_at":"2025-11-08T21:46:25.118990234-05:00","closed_at":"2025-11-08T21:46:25.118990234-05:00","source_repo":".","labels":["bug","validation"]}
{"id":"quad-ops-lpb","content_hash":"1e6ac48e28d391cb8d92cc05b164499b2849b6fbf541b02fa13d8f77d917f8bb","title":"External networks misclassified as managed - rendering unwanted .network files","description":"convertServiceNetworksList creates a Network with default driver \"bridge\" and External=false when a service references a network not in project.Networks. This should be External=true and should not render a .network file.","design":"In convertServiceNetworksList (when service references network not present in project.Networks), set External=true and do not set Driver/Options. Renderer must not create .network artifacts for external networks. Container should not Require/After external network units.","acceptance_criteria":"- External networks don't generate .network files\n- Services using external networks start without dependency on non-existent units\n- Mixed external/managed networks work correctly","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T13:44:34.725704-05:00","updated_at":"2025-11-09T13:47:07.904264-05:00","closed_at":"2025-11-09T13:47:07.904264-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-lpb","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.726218-05:00","created_by":"daemon"}]}
{"id":"quad-ops-lub","content_hash":"3f30aaf954eb0441bf855bacd9ecb25879a4759011476d5c945c1014292d6869","title":"Restore Linux network units functionality","description":"The systemd platform should properly render separate .network unit files for named networks from the service spec. Currently networks are only handled as part of container network mode.\n\nNeed to:\n- Ensure renderService creates separate artifacts for networks in spec.Networks  \n- Implement proper Quadlet network unit rendering with IPAM, DNS, and all supported options\n- Add network dependencies to container units (After/Requires)\n- Test that network units are created and managed properly\n\nThis restores the Linux-specific network management that was lost in the cross-platform abstraction.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-06T21:39:29.416134847-05:00","updated_at":"2025-11-06T21:59:01.799839888-05:00","closed_at":"2025-11-06T21:59:01.799839888-05:00","source_repo":".","labels":["linux","networks","platform-specific","quadlet"]}
{"id":"quad-ops-lym","content_hash":"e31faeb4288d72e39cee4959721ebb96bcd6afaad1ce810f2a32b8423e501160","title":"Missing shm_size support for /dev/shm size configuration","description":"Compose shm_size not converted, causing applications using large shared memory (Chrome, PostgreSQL, NumPy) to fail with ENOSPC. Default 64MB is often too small.","design":"1. Add ShmSize string field to service.Container (internal/service/models.go)\n2. Convert service.ShmSize in spec_converter.go:convertResources() \n3. Render:\n   - systemd: Quadlet ShmSize= directive (native)\n   - launchd: --shm-size podman flag\n\nNote: Quadlet docs show ShmSize= as native directive","acceptance_criteria":"- shm_size in compose converts to Container.ShmSize\n- Renders as ShmSize= on systemd\n- Renders as --shm-size on launchd\n- Applications with large shared memory work\n- Test coverage for resource constraints","notes":"Verified Quadlet native support:\n- ShmSize (native Quadlet directive)\n\nAlso supported via Podman flag:\n- podman run --shm-size\n\nImplementation: Use native Quadlet directive on systemd, Podman flag on launchd","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T16:40:17.255174-05:00","updated_at":"2025-11-09T17:34:22.472114-05:00","closed_at":"2025-11-09T17:34:22.472114-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-lym","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.512304-05:00","created_by":"daemon"}]}
{"id":"quad-ops-m5f","content_hash":"11c96cf09eff21ebb34728f151ef3766f76d2af92a52f72711e499f3acc89d8c","title":"Fix quadlet dependency translation for network and volume references","description":"When rendering quadlet container units, dependencies that are networks or volumes are incorrectly translated.\n\nCurrent behavior:\n- Network dependency `devops-infrastructure-proxy.network` becomes `After=devops-infrastructure-proxy.network.service`\n- This causes quadlet generator error: \"unable to translate dependency for devops-infrastructure-proxy.network\"\n\nExpected behavior (per Podman docs):\n- Network dependencies should be `After=network-name.network`\n- Volume dependencies should be `After=volume-name.volume`\n- Service dependencies should be `After=service-name.service`\n\nRoot cause: The renderer's renderContainer() function (lines 138-140) appends `.service` to ALL dependencies, but it should only append `.service` to actual service-to-service dependencies. Dependencies that already have a type suffix (`.network`, `.volume`) should not get `.service` appended.\n\nError message from quadlet:\n```\nquadlet-generator: converting \"devops-gogs.container\": unable to translate dependency for devops-infrastructure-proxy.network\nquadlet-generator: converting \"beszel-hub.container\": unable to translate dependency for beszel-infrastructure-proxy.network\nquadlet-generator: converting \"scrutiny-web.container\": unable to translate dependency for scrutiny-infrastructure-proxy.network\n```","acceptance_criteria":"Identify how dependencies are distinguished (service vs network vs volume). Render network/volume dependencies with correct type suffix (`.network`, `.volume`), not `.service`. Ensure quadlet generator accepts the rendered units without \"unable to translate dependency\" errors. Add tests covering service-to-service, service-to-network, and service-to-volume dependencies.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T12:40:37.633207593-05:00","updated_at":"2025-11-09T12:42:54.080523176-05:00","closed_at":"2025-11-09T12:42:54.080523176-05:00","source_repo":"."}
{"id":"quad-ops-mo35","content_hash":"6ec245d17ddad0d18cebb38f6eb49b56badd2f2cefc56f5f8bcd7c2f00029b0d","title":"Add goleak for goroutine leak detection in tests","description":"Industry standard practice (Kubernetes, Prometheus, etcd, Docker Compose all use this) is to detect goroutine leaks in tests using uber-go/goleak. This is critical for concurrent systems to prevent resource leaks.\n\nSteps:\n1. Add dependency: go get go.uber.org/goleak\n2. Add goleak.VerifyNone(t) to tests that spawn goroutines\n3. Document usage pattern in AGENTS.md\n4. Consider adding to TestMain functions for package-level leak detection\n5. Fix any discovered leaks\n\nFocus areas:\n- internal/systemd (DBus interactions)\n- cmd/daemon (background sync)\n- Any tests using goroutines or channels\n\nReference: https://github.com/uber-go/goleak","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-12T09:25:15.670645-05:00","updated_at":"2025-11-12T09:55:54.322087-05:00","closed_at":"2025-11-12T09:55:54.322087-05:00","source_repo":"."}
{"id":"quad-ops-ni3","content_hash":"9e25b0e86da49521a80ee741a5a3b899d1c63e8c533a01a9c7abd20ab45695f9","title":"Document or fix Entrypoint/Exec space-joining escaping","description":"Entrypoint and Exec directives are currently built by space-joining array elements:\n\n```go\nif len(c.Entrypoint) \u003e 0 {\n    builder.WriteString(\"Entrypoint=\" + strings.Join(c.Entrypoint, \" \") + \"\\n\")\n}\n```\n\nThis breaks if array elements contain spaces, e.g.:\n- Original array: [\\\"sh\\\", \\\"-c\\\", \\\"echo 'hello world'\\\"]\n- Rendered: Entrypoint=sh -c echo 'hello world'\n\nShould either:\n1. Implement proper shell escaping\n2. Document this as a limitation in migration guide\n3. Research Quadlet's expected format for these directives","acceptance_criteria":"Research Quadlet format for Entrypoint/Exec with arguments containing spaces. Implement proper escaping or document limitation with examples of what works/doesn't work.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-08T21:09:03.091448683-05:00","updated_at":"2025-11-08T21:09:03.091448683-05:00","source_repo":".","labels":["quadlet","task"]}
{"id":"quad-ops-o3w","content_hash":"2027f4177539feeebb157dc4a4e22cf747af64998b5581bf11061b396102c5a3","title":"Document tag management: prevent tag reuse in releases","description":"Add documentation explaining that git tags cannot be reused for releases. Once a tag is pushed and triggers the release workflow, moving it to a different commit will cause the second release attempt to fail with asset already_exists errors. Should document the correct workflow: bump version, create new tag, push. If corrections are needed before release, delete tag+release and create new version.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-08T22:12:31.191482724-05:00","updated_at":"2025-11-08T22:12:31.191482724-05:00","source_repo":"."}
{"id":"quad-ops-odg3","content_hash":"b8be2903aef7c0efc8bac2ef25eaaa498c492a764095bc19376f6441ae17b6c0","title":"Migrate repository_test.go to use t.TempDir() and delete testutil.SetupTempDir","description":"Replace testutil.SetupTempDir usage in internal/git/repository_test.go with stdlib t.TempDir(). Then delete SetupTempDir function from internal/testutil/testutil.go and its test.\n\nNew e2e tests already use t.TempDir() - this completes the migration.","acceptance_criteria":"- repository_test.go uses t.TempDir()\n- SetupTempDir function deleted from testutil.go\n- testutil_test.go TestSetupTempDir test removed\n- All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T09:39:38.841485-05:00","updated_at":"2025-11-12T09:53:25.649451-05:00","closed_at":"2025-11-12T09:53:25.649451-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-odg3","depends_on_id":"quad-ops-uubw","type":"discovered-from","created_at":"2025-11-12T09:39:38.843115-05:00","created_by":"daemon"}]}
{"id":"quad-ops-op80","content_hash":"80dd08484fa19da7456e9b6fc997acf417ef283f7936ce55e76971d41c4c9c79","title":"Simplify testutil.NewTestLogger to stdlib-based helper","description":"Replace custom testHandler slog implementation with simpler stdlib-based logger:\n- Writes to t.Log() when testing.Verbose()\n- Discards output otherwise\n- No custom slog.Handler overhead\n\nMove to cmd/test_helpers.go as TestLogger() since it's only used in cmd tests.","design":"```go\nfunc TestLogger(t *testing.T) log.Logger {\n    var w io.Writer = io.Discard\n    if testing.Verbose() {\n        w = \u0026testWriter{t}\n    }\n    slogLogger := slog.New(slog.NewTextHandler(w, nil))\n    return log.NewSlogAdapter(slogLogger)\n}\n\ntype testWriter struct{ t *testing.T }\nfunc (w testWriter) Write(p []byte) (int, error) {\n    w.t.Log(string(p))\n    return len(p), nil\n}\n```","acceptance_criteria":"- TestLogger() helper in cmd/test_helpers.go\n- Uses io.Discard for non-verbose tests\n- Uses testWriter{t} for verbose tests\n- All cmd/*_test.go files updated to use TestLogger\n- testutil.NewTestLogger and testHandler deleted if unused elsewhere\n- All tests pass","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-12T09:39:38.850676-05:00","updated_at":"2025-11-12T09:55:54.46104-05:00","closed_at":"2025-11-12T09:55:54.46104-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-op80","depends_on_id":"quad-ops-we42","type":"discovered-from","created_at":"2025-11-12T09:39:38.851265-05:00","created_by":"daemon"}]}
{"id":"quad-ops-owk","content_hash":"73614c7c9d4355a0a4efc63a52eb167416de28f6c26275d1039771a28324b648","title":"Remove unused SanitizeProjectName public function","description":"The public `SanitizeProjectName()` function in internal/compose/helpers.go is no longer being called after the validation-first approach was implemented in the Prefix() function. \n\nThe private `sanitizeProjectName()` in reader.go is still used for Docker Compose requirements (lowercase conversion, etc.), but the exported public function should be removed to avoid confusion and keep the API clean.\n\nVerify this is not part of the public API before removal.","acceptance_criteria":"Confirm SanitizeProjectName() has no external callers, remove the function from helpers.go, update any related documentation, and verify all tests still pass.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-10T08:40:19.118464158-05:00","updated_at":"2025-11-11T20:06:58.89481-05:00","closed_at":"2025-11-11T20:06:58.89481-05:00","source_repo":"."}
{"id":"quad-ops-p22","content_hash":"44b2fd6c0ac23ecb23ff46e1b79e0dc0500006b07cd7ccca788e4e187df11d76","title":"Missing network dependencies - containers don't depend on network units","description":"Renderer only adds network After/Requires from Container.Network.ServiceNetworks. If convertNetworkMode doesn't populate this (fallback to project networks), containers won't depend on any .network units even though spec.Networks are rendered.","design":"In SpecConverter.convertNetworkMode, always populate Container.Network.ServiceNetworks with the resolved network names the service joins. If service doesn't declare networks, populate with project default networks. In systemd.Renderer.renderContainer, if Container.Network.ServiceNetworks is empty, fall back to spec.Networks (ensures dependencies on default networks).","acceptance_criteria":"- Containers with networks have After/Requires for those .network units\n- Containers without explicit networks depend on project default networks\n- Network units are created before container starts","notes":"FIXED\n\n**Root Cause**: \nCommit 1b328e7 removed fallback logic that added dependencies to ALL project networks when ServiceNetworks was empty. This was correct to prevent over-broad dependencies, but it inadvertently broke default network assignment. When a service doesn't explicitly declare networks in Docker Compose, it should use the project's default networks.\n\n**Solution Implemented**:\n1. Modified `convertNetworkMode()` to populate `ServiceNetworks` with project default networks when service has no explicit network declarations\n2. Fixed external network handling to NOT apply project prefix (was inconsistent)\n3. Added comprehensive tests covering all network dependency scenarios\n\n**Changes**:\n- `internal/compose/spec_converter.go`: Added logic to populate ServiceNetworks with project default networks when empty\n- `internal/compose/spec_converter.go`: Fixed external network prefix handling in convertServiceNetworksList\n- `internal/compose/network_dependencies_test.go`: Added 6 new tests for network dependency behavior\n- `internal/compose/spec_converter_test.go`: Updated test expectation for external network naming\n\n**Test Coverage**:\n✅ Services with explicit networks get proper ServiceNetworks\n✅ Services without explicit networks use project default networks\n✅ Services with multiple default networks get all of them\n✅ External networks are handled correctly (no prefix)\n✅ Bridge mode services work correctly\n✅ Edge case: projects with no networks\n\nAll tests pass with no regressions.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T13:44:34.719526-05:00","updated_at":"2025-11-09T14:18:00.99817-05:00","closed_at":"2025-11-09T14:18:00.99817-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-p22","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.720028-05:00","created_by":"daemon"}]}
{"id":"quad-ops-pb1","content_hash":"189d1e522a4919b5a89d1b1d2a3d7aef6a668d9bf6773ddefcfc6a878cc1f352","title":"Test: systemd renderer with external networks","description":"Add integration test in renderer_test.go to validate that containers using external (non-prefixed) networks generate correct systemd unit dependencies.\n\nTest scenario:\n- Container uses both an external network (infrastructure-proxy) and a local network (backend)\n- External network should NOT have project prefix in dependencies\n- Local network SHOULD have project prefix in dependencies\n- Verify generated container unit file has correct After/Requires for both networks\n\nThis validates end-to-end that the compose converter fix (quad-ops-1sn) produces correct quadlet artifacts.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-11-09T12:32:26.421993532-05:00","updated_at":"2025-11-10T00:16:28.198601-05:00","closed_at":"2025-11-10T00:08:57.217096287-05:00","source_repo":"."}
{"id":"quad-ops-pd6","content_hash":"8bc806ee4225e9e1fa72cc709cc26cf55eb379da24d5c6a5f2839089c7d3e377","title":"Implement dependency-aware lifecycle ordering in launchd (StartMany, StopMany, RestartMany)","description":"internal/platform/launchd/lifecycle.go (lines 250, 259, 268): StartMany, StopMany, and RestartMany methods have \\\"no dependency ordering\\\" comments, indicating they iterate without respecting service dependencies.\\n\\nSystemd has fully implemented dependency-aware lifecycle (see internal/platform/systemd/lifecycle.go):\\n- StartMany() respects forward dependencies\\n- StopMany() uses reverse dependency order\\n- RestartMany() respects dependency order\\n\\nLaunchd counterparts need equivalent implementation to avoid race conditions and startup/shutdown failures when services have inter-dependencies.\\n\\nPrerequisites:\\n- Plist dependency fields (quad-ops-26t)\\n- Launchd renderer dependency output (quad-ops-9ha)\\n\\nAnalysis: See history/quad-ops-9y2-improve-cross-platform-dependency-management.md Phase 2-3 for implementation details.","design":"## Implementation Architecture\n\n### Current State\n- **cmd/up.go**: Lines 329-376 - Uses `registry.orderAndExpand()` to resolve dependency order before calling `StartMany`\n- **cmd/down.go**: Lines 116-161 - Collects services to stop but does NOT order them, calls `StopMany` with arbitrary order\n- **cmd/sync.go**: Line 175 - Calls `RestartMany` with ordered services\n- **internal/platform/systemd/lifecycle.go**: Lines 260-423 - Fully implements dependency-aware ordering\n- **internal/platform/launchd/lifecycle.go**: Lines 250-275 - Currently ignores ordering, iterates without sequence\n\n### Key Insight\nThe commands pass **ordered service names** to lifecycle methods:\n- `up.go` pre-orders via `registry.orderAndExpand()` (topological sort)\n- `sync.go` pre-orders services\n- `down.go` does NOT pre-order (BUG to fix separately: quad-ops-w84)\n\n### Implementation Plan\n\n**Phase 1: Sequential Processing (3 methods)**\n\n1. **StartMany** (line 251-257):\n   - Change from concurrent iteration to **sequential processing**\n   - Services already ordered by dependency graph upstream\n   - Process in provided order (respects forward dependencies)\n   - Return map of results as before\n\n2. **StopMany** (line 259-266):\n   - **Reverse the service list** (like systemd line 327-330)\n   - Process sequentially in reversed order\n   - Return map of results\n   - Note: down.go should pre-order services (separate issue quad-ops-w84)\n\n3. **RestartMany** (line 268-275):\n   - Process sequentially in provided order\n   - Services already ordered by dependency graph upstream\n   - Return map of results\n\n**Key Changes**:\n- Replace `for name := range names` loops with sequential processing\n- Add debug logging showing sequential execution\n- Keep error handling (log but continue processing)\n- No interface changes needed\n- No dependency metadata needed in methods (ordering happens upstream)\n\n### Testing Strategy\n- Modify existing lifecycle tests to verify sequential order\n- Add integration test with dependent services (e.g., app → postgres)\n- Verify start waits for dependencies\n- Verify stop reverses order\n- Both systemd and launchd should behave identically\n\n### Files to Modify\n1. `internal/platform/launchd/lifecycle.go` - Three methods\n2. `internal/platform/launchd/lifecycle_test.go` - Add sequential order tests\n3. `cmd/down_test.go` - Adjust expectations for sequential stopping","acceptance_criteria":"./quad-ops up/down/sync on macOS respects service dependency order without race conditions. StartMany waits for dependencies, StopMany reverses order, RestartMany maintains ordering","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:01:30.68064453-05:00","updated_at":"2025-11-08T18:13:09.769813753-05:00","closed_at":"2025-11-08T18:13:09.769813753-05:00","source_repo":".","labels":["dependencies","launchd","lifecycle","platform-specific"],"dependencies":[{"issue_id":"quad-ops-pd6","depends_on_id":"quad-ops-9ha","type":"blocks","created_at":"2025-11-08T16:01:30.690989336-05:00","created_by":"daemon"},{"issue_id":"quad-ops-pd6","depends_on_id":"quad-ops-w84","type":"related","created_at":"2025-11-08T16:01:33.184813695-05:00","created_by":"daemon"}]}
{"id":"quad-ops-pei","content_hash":"71f9e88098bb7ca127098ad67b461bde713db12919eb57aa60b2b58d1f15cde7","title":"sync command not honoring composeDir repository setting","description":"The sync command is not respecting the composeDir setting in the repository configuration.\n\nConfig shows:\n```\nrepositories:\n  - name: quad-ops-deploy\n    url: https://github.com/trly/quad-ops-deploy.git\n    composeDir: test/bdyvp22\n```\n\nWhen running `./quad-ops -u -v sync -f`, the sync appears to process compose files from the entire repository rather than just the configured `test/bdyvp22` subdirectory. This results in potentially processing unintended compose files and failing to respect the repository's directory structure configuration.","design":"## Root Cause Analysis\n\nThe sync command `handleSyncResult()` function correctly implements composeDir handling in `cmd/sync.go` lines 217-220:\n\n```go\nrepoPath := filepath.Join(app.Config.RepositoryDir, result.Repository.Name)\nif result.Repository.ComposeDir != \"\" {\n    repoPath = filepath.Join(repoPath, result.Repository.ComposeDir)\n}\nprojects, err := compose.ReadProjects(repoPath)\n```\n\nHowever, there are two issues preventing proper composeDir functionality:\n\n### Issue 1: Missing Validation Before Reading Projects\nThe code does NOT validate that the composeDir path actually exists BEFORE attempting to read projects. This can lead to:\n- Silently reading from the wrong directory (parent if composeDir doesn't exist)\n- Poor error messages to users\n\nWhile `compose.ReadProjects()` does validate the directory exists and return an error, there's NO pre-sync validation that the configured composeDir exists in the cloned repository.\n\n### Issue 2: No Pre-Sync Validation (Identical to doctor command)\nThe `doctor` command includes validation at lines 364-379 to check if composeDir exists, but the `sync` command has NO equivalent validation. This means:\n- Users don't get early warning if composeDir is misconfigured\n- Errors only appear during compose reading (which may fail with less helpful messages)\n- No consistent validation pattern across commands\n\n## Files Requiring Changes\n\n1. **cmd/sync.go** - handleSyncResult() method\n   - Add validation to check if composeDir path exists before calling compose.ReadProjects()\n   - Return clear error if path doesn't exist  \n   - Log debug info about which path is being scanned\n\n2. **cmd/sync_test.go** - Add test cases\n   - TestSyncCommand_WithComposeDir - basic composeDir functionality\n   - TestSyncCommand_WithComposeDirNotFound - error handling when composeDir doesn't exist\n   - TestSyncCommand_WithComposeDirAndCompose Files - verify correct subdirectory is scanned\n\n## Proposed Fix Implementation\n\n1. Add pre-validation in `handleSyncResult()` after building repoPath:\n   - Check if repoPath exists using FileSystem.Stat()\n   - Return error with helpful message if missing\n   - Log debug message showing the path being scanned\n\n2. Add tests to verify:\n   - Compose files in composeDir are processed (not parent directory)\n   - Error is returned if composeDir doesn't exist\n   - Error message guides user to check configuration","notes":"INVESTIGATION COMPLETE - Ready for implementation planning\n\nSimilar issue was previously fixed in quad-ops-b5m (validate command path handling). This is a parallel issue in the sync command that needs consistent validation pattern.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-09T12:58:50.350485724-05:00","updated_at":"2025-11-09T13:25:12.20823924-05:00","closed_at":"2025-11-09T13:25:12.20823924-05:00","source_repo":"."}
{"id":"quad-ops-pmj","content_hash":"255396584bbbb6aeb36837b49c8e87a1acf01c81a7953ade6c37684c4463c433","title":"Add tests for memory and CPU constraint rendering","description":"Write table-driven tests for systemd renderer to verify Memory, MemoryReservation, MemorySwap, and CPU constraint fields are correctly rendered to unit files. Tests should cover edge cases like zero values and mixed constraint scenarios.","acceptance_criteria":"- Tests for Memory= directive rendering\n- Tests for MemoryReservation= directive rendering\n- Tests for MemorySwap= directive rendering\n- Tests for CPUShares, CPUQuota, CPUPeriod via PodmanArgs\n- Tests for mixed constraints\n- All tests pass and provide \u003e90% coverage of addResources function","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T21:37:08.09997211-05:00","updated_at":"2025-11-08T21:39:49.984683493-05:00","closed_at":"2025-11-08T21:39:49.984683493-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-pmj","depends_on_id":"quad-ops-24q","type":"parent-child","created_at":"2025-11-08T21:37:08.104217176-05:00","created_by":"daemon"}]}
{"id":"quad-ops-pr4","content_hash":"759e36d3f80ac9c15a3f6448c55db0739a17c24a05c95e0dcbf9d552473b322e","title":"Investigate service startup failure on Linux: init-containers-web fails with unexpected state: failed","description":"The `./quad-ops -u up` command fails on Linux systems with the error: \\\"service init-containers-web failed to start: unexpected state: failed\\\". This appears to be a systemd integration issue where init containers are not properly configured as oneshot services.\n\nRoot cause: Init containers (created from `x-quad-ops-init` extension) are rendered as regular container units with `Restart=no`, but systemd requires oneshot services to have `Type=oneshot` and `RemainAfterExit=yes` to remain in \\\"active\\\" state after successful completion. Without these settings, init containers exit and become \\\"inactive\\\", preventing dependent services from starting.\n\nNeed to modify the systemd renderer in `internal/platform/systemd/renderer.go` to detect init containers (by name pattern containing \\\"-init-\\\") and add the appropriate systemd service configuration.","acceptance_criteria":"Running `./quad-ops -u up` on Linux systems successfully starts all services without errors, specifically the init-containers-web service should start without entering \"failed\" state.","notes":"Issue resolved. The problem was that multi-service-webapp container was still running and occupying port 8080 even after stopping the systemd service. The rootlessport process needed to be manually killed to free the port. After clearing the port conflict, init-containers-web started successfully.","status":"closed","priority":2,"issue_type":"bug","assignee":"trly","created_at":"2025-11-06T23:46:02.54965128-05:00","updated_at":"2025-11-06T23:57:54.467355247-05:00","closed_at":"2025-11-06T23:57:54.467367478-05:00","source_repo":"."}
{"id":"quad-ops-q12","content_hash":"910a2b825a389e3d35c16376440c1d9219b7b1b4e859b1f042f069c8068dd07a","title":"Add comprehensive tests for service network connections in containers","description":"Write tests to verify:\n1. systemd renderer adds Network= directives for each service-level network\n2. launchd renderer adds --network flags for each service-level network  \n3. Services with multiple networks are handled correctly\n4. External networks are skipped in both renderers\n5. Network ordering is consistent (sorted for determinism)\n\nTests should cover both single and multi-network scenarios like the immich example (default + infrastructure-proxy).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:53:50.99995072-05:00","updated_at":"2025-11-08T17:48:09.775676342-05:00","closed_at":"2025-11-08T17:48:09.775676342-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-q12","depends_on_id":"quad-ops-wib","type":"blocks","created_at":"2025-11-08T16:53:51.003631681-05:00","created_by":"daemon"}]}
{"id":"quad-ops-qgm","content_hash":"db9bf56fb4a68866e4255bccbd60093fade799babe1f1b507cd15b56c5f03956","title":"Implement CPU constraint rendering via PodmanArgs","description":"Update systemd renderer to output CPU constraints (CPUShares, CPUQuota, CPUPeriod) as PodmanArgs directives since Quadlet has no native CPU constraint fields. CPUQuota and CPUPeriod are in microseconds; convert appropriately for --cpu-quota and --cpu-period flags.","acceptance_criteria":"- CPUShares renders as PodmanArgs=--cpu-shares \u003cvalue\u003e\n- CPUQuota renders as PodmanArgs=--cpu-quota \u003cvalue\u003e\n- CPUPeriod renders as PodmanArgs=--cpu-period \u003cvalue\u003e\n- Empty/zero values are not rendered\n- Multiple PodmanArgs directives combine correctly\n- Tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T21:37:08.245943695-05:00","updated_at":"2025-11-08T21:40:01.011981575-05:00","closed_at":"2025-11-08T21:40:01.011981575-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-qgm","depends_on_id":"quad-ops-24q","type":"parent-child","created_at":"2025-11-08T21:37:08.25001651-05:00","created_by":"daemon"}]}
{"id":"quad-ops-r3w","content_hash":"267293608f3103e81695253ccb53aa5f445e531ca4a6d883fbec160ff51f8807","title":"Create minimal systemd helpers.go for platform-specific utilities","description":"**Anti-pattern identified:** Systemd-specific utilities may be scattered or mixed with quadlet logic.\n\n**Target architecture:**\nFile: internal/platform/systemd/helpers.go (≤100 lines)\n- Keep ONLY systemd-specific utilities\n- Unit path/filename generation\n- User vs system quadlet directory resolution\n- Dependency ordering (After/Requires/Wants)\n- Unit name formatting\n\n**What belongs here:**\n- unitFilename() - systemd unit naming\n- userQuadletDir() / systemQuadletDir() - path resolution\n- wantsRequires() - systemd dependency directives\n- Dependency graph ordering for systemd units\n\n**What does NOT belong here:**\n- Quadlet INI formatting (→ quadlet.go)\n- Podman args building (→ shared podman_args.go)\n- Single-use helpers (→ inline into callers)\n\n**Benefits:**\n- Clear separation: platform-specific vs rendering logic\n- Minimal, focused helper file\n- Easy to find systemd-specific concerns\n\n**Effort:** Small-Medium (1-3 hours)\n\n**Reference:** Oracle review anti-patterns section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-11T17:05:30.80663-05:00","updated_at":"2025-11-11T20:02:14.253456-05:00","closed_at":"2025-11-11T20:02:14.253456-05:00","source_repo":"."}
{"id":"quad-ops-rdm","content_hash":"b4dfaf99147f1fea18e66b6c68e504787d885e19c4d977a3871c7671b67e6ce8","title":"Validation warnings for unimplemented Compose fields","description":"Some Compose fields are parsed but silently ignored with no warning, causing users to not know features aren't working.\n\nStandard Compose fields needing implementation: volumes_from, logging, stdin_open, tty\n\nSwarm-only fields to reject: deploy.placement, deploy.update_config, deploy.rollback_config, deploy.endpoint_mode, configs/secrets with driver field, ports with mode: ingress\n\nNote: sysctls and ulimits ARE supported by Quadlet (Sysctl= and Ulimit= directives)","design":"Add validation in cmd/validate.go:\n\n**Warnings for unimplemented standard fields:**\n- volumes_from (suggest named volumes instead)\n- logging.driver/options if custom drivers not in Podman's supported list\n- stdin_open, tty (interactive mode not practical in systemd units)\n\n**Errors for Swarm-only fields:**\n- deploy.placement.* (Swarm orchestration)\n- deploy.update_config, deploy.rollback_config (Swarm rolling updates)\n- deploy.endpoint_mode (Swarm service discovery)\n- deploy.mode: global or replicas \u003e 1 (multi-instance orchestration)\n- configs/secrets with driver field (Swarm centralized store)\n- ports with mode: ingress (Swarm load balancing)\n\nFormat:\nERROR: Swarm feature not supported: deploy.placement (use Kubernetes/Nomad for orchestration)\nWarning: service 'app' uses unsupported field 'volumes_from' - consider using named volumes instead\n\nNote: sysctls and ulimits should be implemented (Quadlet native support)","acceptance_criteria":"- Warnings emitted for unsupported fields\n- Warnings are helpful (suggest workarounds)\n- Validation doesn't fail (warnings only)\n- Test coverage for warning scenarios\n- README documents unsupported fields","notes":"Implementation plan prepared (see Amp thread). Ready for execution once approved.","status":"closed","priority":2,"issue_type":"task","assignee":"amp","created_at":"2025-11-09T16:40:17.280241-05:00","updated_at":"2025-11-09T23:00:28.875168-05:00","closed_at":"2025-11-09T23:00:28.875168-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-rdm","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.533704-05:00","created_by":"daemon"}]}
{"id":"quad-ops-rgd","content_hash":"dffc52f6195e2891aa2ff38b7d642c435d310b2725e7c0a1663a51fcb60028f7","title":"Fix gofmt issue in renderer_test.go","description":"Task fmt modified internal/platform/systemd/renderer_test.go - code not properly formatted.\n\nRun `go fmt ./...` and commit the changes.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-11T18:53:36.12947-05:00","updated_at":"2025-11-11T19:18:28.761185-05:00","closed_at":"2025-11-11T19:18:28.761185-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-rgd","depends_on_id":"quad-ops-7","type":"discovered-from","created_at":"2025-11-11T18:53:36.129955-05:00","created_by":"daemon"}]}
{"id":"quad-ops-rqe","content_hash":"e0566460da5c65f3233cd08cbe0a303fc6ed4a6e1ad40f7d605c12f5a14fd0de","title":"Missing bind mount options: z/Z relabel flags","description":"SELinux relabel flags (z/Z) for bind mounts not supported in current implementation.","design":"## Problem\nDocker Compose bind mounts support SELinux relabeling via `bind.selinux: z|Z` which controls SELinux context labeling. `z` = shared label (multiple containers), `Z` = private label (single container). This option is currently ignored during conversion.\n\n## Source Data\n- compose-spec library: `types.ServiceVolumeConfig.Bind.SELinux` (string: \"z\" | \"Z\")\n- Location: `internal/compose/spec_converter.go:convertVolumeMounts()`\n\n## Target Format\nQuadlet Volume= directive supports z/Z options:\n```\nVolume=/host/path:/container/path:z    # shared SELinux label\nVolume=/host/path:/container/path:Z    # private SELinux label\n```\n\n## Implementation Plan\n1. Update `internal/service/models.go`:\n   - Add `SELinux string` field to `BindOptions` struct (already exists, just needs to be populated)\n\n2. Update `internal/compose/spec_converter.go:convertVolumeMounts()`:\n   - For bind-type mounts, check `v.Bind != nil \u0026\u0026 v.Bind.SELinux != \"\"`\n   - Set `mount.BindOptions.SELinux = v.Bind.SELinux` \n   - Already captures Propagation, just add SELinux field handling\n\n3. Update `internal/platform/systemd/renderer.go:addMounts()`:\n   - When building mount string for bind mounts, check `m.BindOptions.SELinux`\n   - Append `:z` or `:Z` to mount string based on value\n\n4. Add test cases:\n   - `internal/compose/testdata/golden/` - add compose file with bind mount z/Z\n   - `internal/platform/systemd/renderer_test.go` - test Volume= with z and Z options","acceptance_criteria":"- z/Z options in bind mounts are preserved\n- Rendered correctly in Quadlet Volume= directive\n- SELinux relabeling works as expected","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-09T13:44:34.795669-05:00","updated_at":"2025-11-09T16:03:50.735425-05:00","closed_at":"2025-11-09T16:03:50.735425-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-rqe","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.796066-05:00","created_by":"daemon"}]}
{"id":"quad-ops-s9l","content_hash":"8ee76ac798fea820efdd842ed9d1584a27f8d962c31f9e107404b8968142b7ca","title":"Fix init container volume mounting in spec converter","description":"Init containers defined via x-quad-ops-init extension need to inherit volumes from the main service to access shared data directories. Currently, init containers don't get volume mounts, causing failures when they try to write to shared volumes like /shared/data.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-06T23:51:14.6100226-05:00","updated_at":"2025-11-06T23:54:13.232121169-05:00","closed_at":"2025-11-06T23:54:13.232121169-05:00","source_repo":".","labels":["init-containers","spec-converter","volumes"]}
{"id":"quad-ops-sgd","content_hash":"22856d51040298b23f5dcbe6aea96e32fea36efb9f18c2ded4043c46f6ca3ef6","title":"issue with github workflow build.yml","description":"\nError: Failed to run: Error: Command failed: /home/runner/golangci-lint-2.6.1-linux-amd64/golangci-lint config verify\njsonschema:  does not validate with /additionalProperties: additional properties 'linters-settings' not allowed\nThe command is terminated due to an error: the configuration contains invalid elements\n, Error: Command failed: /home/runner/golangci-lint-2.6.1-linux-amd64/golangci-lint config verify\njsonschema:  does not validate with /additionalProperties: additional properties 'linters-settings' not allowed\nThe command is terminated due to an error: the configuration contains invalid elements\n\n    at genericNodeError (node:internal/errors:984:15)\n    at wrappedFn (node:internal/errors:538:14)\n    at ChildProcess.exithandler (node:child_process:422:12)\n    at ChildProcess.emit (node:events:524:28)\n    at maybeClose (node:internal/child_process:1104:16)\n    at ChildProcess._handle.onexit (node:internal/child_process:304:5)\nError: Command failed: /home/runner/golangci-lint-2.6.1-linux-amd64/golangci-lint config verify\njsonschema:  does not validate with /additionalProperties: additional properties 'linters-settings' not allowed","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-06T21:53:02.978723976-05:00","updated_at":"2025-11-06T21:54:17.737045479-05:00","closed_at":"2025-11-06T21:54:17.737045479-05:00","source_repo":"."}
{"id":"quad-ops-slm","content_hash":"0ae28aeac9514a36d3152c850e1c79f32735d3986b585a5ccdc87e9a99be00d6","title":"Implement x-podman-env-secrets extension support","description":"The multi-service example uses x-podman-env-secrets extension to map secrets to environment variables. This extension is used but not implemented.\n\nNeed to:\n- Process x-podman-env-secrets from project.Extensions in spec_converter.go\n- Add support for mapping secrets to environment variables in the service model\n- Ensure the renderer outputs appropriate Podman arguments or systemd environment setup\n\nExtension format:\n```yaml\nx-podman-env-secrets:\n  db_password: WORDPRESS_DB_PASSWORD\n```\n\nThis should make the secret available as an environment variable in the container.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-06T21:36:26.634415865-05:00","updated_at":"2025-11-06T21:45:44.413052281-05:00","closed_at":"2025-11-06T21:45:44.413052281-05:00","source_repo":"."}
{"id":"quad-ops-sly","content_hash":"df984f743b947a210a114683288695e1c6848864d2e9299e874ed94ec1ec638a","title":"Emit extra host and DNS flags in launchd BuildPodmanArgs","description":"Update internal/platform/launchd/podmanargs.go to append --add-host, --dns, --dns-search, and --dns-opt arguments based on the populated service.Container fields. Leverage deterministic ordering to match converter output and satisfy newly added tests.","notes":"Implementation guidance:\n- When emitting --add-host and DNS-related flags, rely on alphabetically sorted order to match converter-provided slices (ensures deterministic output and satisfies parity tests).\n- Preserve existing behavior for other arguments; focus changes on extra host/DNS handling only.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-09T18:44:32.355078-05:00","updated_at":"2025-11-09T18:55:24.758998-05:00","closed_at":"2025-11-09T18:55:24.758998-05:00","source_repo":".","labels":["bugfix","launchd"],"dependencies":[{"issue_id":"quad-ops-sly","depends_on_id":"quad-ops-460","type":"blocks","created_at":"2025-11-09T18:44:32.35688-05:00","created_by":"daemon"}]}
{"id":"quad-ops-ts0","content_hash":"28f5d23295c692a82085be8105a6dc4db4543f6b60a79af3f0198d50dd7d622f","title":"Add dependency validation and cycle detection during spec conversion","description":"Extend validation in internal/service/validate.go to include cycle detection using the dependency graph. Add validation that all DependsOn services exist and there are no circular dependencies.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T23:26:34.951571807-05:00","updated_at":"2025-11-12T11:58:54.622642-05:00","closed_at":"2025-11-12T11:58:54.622642-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-ts0","depends_on_id":"quad-ops-9y2","type":"parent-child","created_at":"2025-11-06T23:26:36.591633784-05:00","created_by":"daemon"}]}
{"id":"quad-ops-u4g","content_hash":"653f8e206c3f988dd101ec6834e003ce56a3745edab51cee28fea365e2729a87","title":"Add tests verifying unit_list uses deployed artifacts by default","description":"Add comprehensive tests to verify the fix for quad-ops-w84 and prevent regression.\n\nNeed platform-specific tests for Linux (systemd) and macOS (launchd). Need negative tests verifying RepositoryDir artifacts (raw docker-compose.yml, .git/) are NOT listed. Need end-to-end behavior tests that after sync renders units, unit list shows them. Need integration edge cases with multiple artifact types and permission errors.","acceptance_criteria":"Tests exist for both Linux (systemd) and macOS (launchd) platforms. Tests verify that QuadletDir artifacts are returned. Tests verify that RepositoryDir artifacts are NOT returned. Tests verify platform-specific filtering (.container, .plist) works. All tests pass with the fix applied. Test coverage for unit_list command increased.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T16:02:54.723729619-05:00","updated_at":"2025-11-09T10:23:33.807427269-05:00","closed_at":"2025-11-09T10:23:33.807427269-05:00","source_repo":".","labels":["testing","unit_list"]}
{"id":"quad-ops-usm","content_hash":"eed8032c35be39c24e9ae9ebdf345c86a4fc95ffd0e8d9165d5c02b5cbf862fc","title":"Document CI/CD workflow philosophy for quad-ops","description":"Clarify and document the CI/CD approach: build.yml validates on every commit, release.yaml rebuilds with GoReleaser on tags. Don't try to share artifacts across workflows.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-08T22:07:42.906409728-05:00","updated_at":"2025-11-08T22:07:42.906409728-05:00","source_repo":"."}
{"id":"quad-ops-uubw","content_hash":"dde4faad7db436c705efac6365d30d128ff6c54f9c711a4e0c1f4020ad5f0ea0","title":"Replace testutil.SetupTempDir with stdlib t.TempDir()","description":"testutil.SetupTempDir duplicates functionality available in Go 1.15+ stdlib. Replace all usages with built-in t.TempDir() which provides automatic cleanup and better integration with the testing framework.\n\nSteps:\n1. Find all calls to testutil.SetupTempDir() across test files\n2. Replace with t.TempDir() (returns string, no cleanup func needed)\n3. Update any cleanup logic that relied on the returned cleanup function\n4. Remove SetupTempDir function from testutil.go once all usages replaced\n\nBenefits:\n- Reduces maintenance overhead\n- Uses battle-tested stdlib implementation\n- One less custom utility to document/maintain","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-12T09:25:15.653951-05:00","updated_at":"2025-11-12T09:55:54.323388-05:00","closed_at":"2025-11-12T09:55:54.323388-05:00","source_repo":"."}
{"id":"quad-ops-vaw0","content_hash":"dc71eba69ca4280827c2a4d858b1da94f5640e271143c4079b3a281ff17ec4cf","title":"Add E2E command tests to improve coverage","description":"Codecov failing on PR #50 due to low test coverage in cmd/ (74.2%), internal/systemd (49.3%), internal/podman (44.3%), and internal/platform/systemd (67.8%).\n\nAdd end-to-end command tests covering typical user workflows:\n- daemon start/stop/restart\n- config init with various options\n- doctor diagnostics\n- Full workflow chains: sync→up→down\n\nFocus on testing through public CLI interface rather than deep unit testing of internal mocks.\n\nAcceptance criteria:\n- Add E2E tests for daemon, config init, doctor commands\n- Add workflow chain tests (sync→up→down)\n- Coverage for cmd/ packages reaches ≥80%\n- Tests focus on user behavior through public CLI\n- Codecov check passes on PR #50","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-12T09:08:37.010163-05:00","updated_at":"2025-11-12T09:23:49.144665-05:00","closed_at":"2025-11-12T09:23:49.144665-05:00","source_repo":"."}
{"id":"quad-ops-vfp","content_hash":"1dfae1e3584dc612197791a01071fbb248d293ce677379f6bcfa4b83cdaa2e88","title":"Add cmd/quad-ops/main.go to fix task build","description":"Create missing main.go entrypoint so `task build` passes.\n\n**Implementation:**\n- Create cmd/quad-ops/main.go\n- package main\n- Call cmd.NewRootCommand().GetCobraCommand().Execute()\n- os.Exit(1) on error\n\n**Verify:**\n- task build (should compile successfully)\n- ./quad-ops --help (should show commands)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-11T20:30:35.598482-05:00","updated_at":"2025-11-11T20:35:49.331965-05:00","closed_at":"2025-11-11T20:35:49.331965-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-vfp","depends_on_id":"quad-ops-9f5","type":"discovered-from","created_at":"2025-11-11T20:30:35.600213-05:00","created_by":"daemon"}]}
{"id":"quad-ops-vkf","content_hash":"d1010d396e4b243345eba8b2168dd757a4e6964a0deb2a2fa302005da2f8d011","title":"Privileged port 80/443 binding fails in rootless Podman","description":"## Environment Limitation (Not a Code Bug)\nServices trying to bind to privileged ports (\u003c 1024) fail in rootless Podman because the user lacks the capability to use low port numbers. This is a system/kernel configuration issue, not a quad-ops bug.\n\n### Actual Error\n```\nError: rootlessport cannot expose privileged port 80, you can add 'net.ipv4.ip_unprivileged_port_start=80' to /etc/sysctl.conf (currently 1024)\n```\n\n### Affected Services\n- infrastructure-reverse-proxy (ports 80, 443)\n- Any other services binding to privileged ports\n\n### Solutions (System Configuration)\n1. **Recommended**: Configure unprivileged port access:\n   ```bash\n   sudo sysctl net.ipv4.ip_unprivileged_port_start=80\n   sudo sysctl -w net.ipv4.ip_unprivileged_port_start=80  # permanent\n   echo 'net.ipv4.ip_unprivileged_port_start=80' | sudo tee -a /etc/sysctl.conf\n   ```\n\n2. **Alternative**: Use port forwarding (e.g., firewall NAT from 80→8080)\n\n3. **Not recommended**: Run Podman in privileged mode (security risk)\n\n### Action Items\n- Document this in INSTALLATION.md or setup guide\n- Add to troubleshooting section of README\n- Clarify that this is system/kernel config, not quad-ops issue","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T10:36:47.80967079-05:00","updated_at":"2025-11-09T12:31:55.281407967-05:00","closed_at":"2025-11-09T12:31:55.281407967-05:00","source_repo":"."}
{"id":"quad-ops-w10","content_hash":"33bf87436e960636a81e2dd70271ebfdf4c2dab057a054361788db346e3605d1","title":"simplify network dependency logic","description":"**Problem:** Immich containers in the media project cannot resolve service hostnames (database, redis) despite being connected to networks where those services should be discoverable.\n\n**Error Details:**\n- `getaddrinfo ENOTFOUND database` (errno -3008)\n- `getaddrinfo ENOTFOUND redis` (errno -3008)\n- Services immich-server, immich-machine-learning, and immich-database fail to start\n\n**Deployment Analysis:**\nThe media/docker-compose.yml references:\n- immich-server: connects to `default` and `infrastructure-proxy` networks\n- immich-redis: service in default network  \n- immich-database: service in default network\n- Both redis and database services use short hostnames in immich-server environment variables and configuration\n\n**Root Causes (Multi-layered):**\n\n1. **Network Service Discovery:** Podman containers resolve services via DNS only when connected to a user-defined bridge network. The `default` network (implied network name is `media_default`) should provide DNS resolution for `immich-redis` and `immich-database` container names.\n\n2. **Missing Infrastructure Network Unit:** The `infrastructure-proxy` network is marked `external: true` but no unit exists at the systemd level. The quad-ops converter must be generating references to an external network that hasn't been created.\n\n3. **Network Dependency Ordering:** Services may start before their dependencies (database, redis) are fully ready on the network, or container networks aren't properly initialized before containers attempt DNS resolution.\n\n4. **DNS Resolution Configuration:** Need to verify:\n   - Do containers have proper DNS servers configured?\n   - Is the Podman network driver properly setting up DNS for the bridge network?\n   - Are --add-host and --dns flags being emitted correctly in quadlet renderers?\n\n**Next Steps for Investigation:**\n1. Verify infrastructure-proxy network unit is created (or should be)\n2. Check if quad-ops is emitting proper DNS/network flags in systemd/launchd renderers\n3. Test DNS resolution from immich containers to dependent services\n4. Review network dependency logic in spec converter vs systemd renderer parity","design":"**Core Issue: Missing Network Dependency Graph Integration**\n\nThe problem: Quadlet's native `.network` dependency system requires:\n1. A `.network` unit file for every network referenced in a container's `Network=` directive\n2. Explicit systemd dependencies (`After=`, `Requires=`) to ensure network units start before container units\n3. But currently, no `.network` units are generated for external networks\n\n**Current State:**\n- `internal/dependency/ServiceDependencyGraph` tracks only service-to-service dependencies from `depends_on`\n- Spec converter populates `spec.Container.Network.ServiceNetworks` with network names\n- Systemd renderer emits `Network=\u003cname\u003e.network` directives\n- But for external networks, the `.network` unit file doesn't exist, breaking Quadlet's dependency tracking\n\n**Solution: Extend Dependency Graph for Networks**\n\n1. **Generate `.network` Units for External Networks:**\n   - For each external network, emit a minimal `.network` unit file with `NetworkName=\u003cexternal-name\u003e`\n   - This gives Quadlet something to depend on, enabling automatic ordering\n   - External networks are pre-created elsewhere (manual or bootstrap); our `.network` unit just documents the reference\n\n2. **Network Dependency Logic:**\n   - If a service references networks, its unit should have `After=` and `Requires=` on those network units\n   - All networks (external and project-local) should generate `.network` files\n   - The spec converter's `ServiceNetworks` population is correct; the renderer just needs to emit units for external networks\n\n3. **Implementation:**\n   - Modify `renderer.RenderNetwork()` to handle external networks\n   - Emit `.network` unit files with `NetworkName=\u003cname\u003e` for all networks, not just project networks\n   - For external networks, the unit is minimal: just `[Network]` section with `NetworkName=`\n   - Systemd renderer already handles `After=`/`Requires=` logic correctly; it just needs the external units to exist\n\n**Why This Works:**\n- Quadlet sees `Network=infrastructure-proxy.network` in container unit\n- Quadlet looks for `infrastructure-proxy.network` unit file (we generate it)\n- Quadlet auto-generates `After=infrastructure-proxy-network.service` and `Wants=infrastructure-proxy-network.service`\n- System boot order: networks start → containers start\n- DNS service discovery works because network is ready before containers connect\n\n**Key Insight:**\nDon't skip external networks; just generate simpler `.network` units for them that defer to pre-existing Podman networks.","acceptance_criteria":"**Must complete all of:**\n\n1. **Modify systemd renderer to generate external network units:**\n   - Update `RenderNetwork()` to emit `.network` files for external networks\n   - External network units contain minimal `[Network]` section with `NetworkName=\u003cname\u003e`\n   - Path: `internal/platform/systemd/renderer.go`\n\n2. **Ensure dependency tracking includes external networks:**\n   - Verify that `addDependencies()` includes external networks in `After=`/`Requires=`\n   - External network units must exist before container units can depend on them\n   - Path: `internal/platform/systemd/renderer.go` lines 216-232\n\n3. **Add tests for external network unit generation:**\n   - Test that external networks generate `.network` units with correct `NetworkName=`\n   - Test that container units have `After=` and `Requires=` for external networks\n   - Test cross-project external network sharing (immich references infrastructure-proxy)\n   - Path: `internal/platform/systemd/renderer_test.go`\n\n4. **Verify no regressions:**\n   - All existing tests pass\n   - Launchd platform continues working (uses `--network` flags, not Quadlet units)\n   - Project-local networks still generate full `.network` units (unchanged)\n\n5. **Validate with immich deployment:**\n   - Generate units for media and infrastructure projects\n   - Verify `infrastructure-proxy.network` unit file is created\n   - Verify media services have `After=infrastructure-proxy.network` and `Requires=infrastructure-proxy.network`\n   - DNS service discovery resolves correctly when infrastructure-proxy network exists","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-10T01:11:09.752760008-05:00","updated_at":"2025-11-11T09:31:54.236474-05:00","closed_at":"2025-11-11T01:44:30.939403427-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-w10","depends_on_id":"quad-ops-4je","type":"related","created_at":"2025-11-10T01:13:08.501149714-05:00","created_by":"daemon"},{"issue_id":"quad-ops-w10","depends_on_id":"quad-ops-zow","type":"related","created_at":"2025-11-10T01:13:08.506659475-05:00","created_by":"daemon"},{"issue_id":"quad-ops-w10","depends_on_id":"quad-ops-1i5","type":"related","created_at":"2025-11-10T01:13:08.511383933-05:00","created_by":"daemon"},{"issue_id":"quad-ops-w10","depends_on_id":"quad-ops-fdg","type":"related","created_at":"2025-11-10T01:13:08.516131471-05:00","created_by":"daemon"}]}
{"id":"quad-ops-w25","content_hash":"063e5fb535afba77f651ac5c0d2648863c58b37b2ad755b45fea6542262502a1","title":"sync command requires --force to detect remote repo changes","description":"the sync command requires --force to be applied to actually compare and make updates, even if the repository was synced and new changes exist\n\n","acceptance_criteria":"./quad-ops sync -u should actually update if there are changes pulled from the remote and not require --force\n","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-07T01:09:07.289642171-05:00","updated_at":"2025-11-07T21:58:56.781784422-05:00","closed_at":"2025-11-07T21:58:56.781784422-05:00","source_repo":"."}
{"id":"quad-ops-w2q","content_hash":"c016a1e427d12ed7e182f96ee5bb01cd3ee0fc7767160c8ea149238b4aece16d","title":"unit list is not finding platform specific units that are managed","description":"[root@bdyvp22 ~]# quad-ops sync -v --force\nquad-ops using config: /etc/quad-ops/config.yaml\n\ntime=2025-11-07T01:10:27.422-05:00 level=DEBUG msg=\"Validating systemd availability\"\ntime=2025-11-07T01:10:27.429-05:00 level=DEBUG msg=\"Validating podman availability\"\ntime=2025-11-07T01:10:27.463-05:00 level=DEBUG msg=\"Validating podman-system-generator availability\"\ntime=2025-11-07T01:10:27.465-05:00 level=DEBUG msg=\"Initializing platform: systemd (Linux)\"\ntime=2025-11-07T01:10:27.465-05:00 level=DEBUG msg=\"Syncing repository\" name=quad-ops-deploy url=https://github.com/trly/quad-ops-deploy.git\ntime=2025-11-07T01:10:27.465-05:00 level=DEBUG msg=\"Syncing repository\" path=quad-ops-deploy\ntime=2025-11-07T01:10:27.465-05:00 level=DEBUG msg=\"Repository already exists, opening\" path=/var/lib/quad-ops/quad-ops-deploy\ntime=2025-11-07T01:10:27.465-05:00 level=DEBUG msg=\"Pulling latest changes from origin\"\ntime=2025-11-07T01:10:27.795-05:00 level=DEBUG msg=\"Repository is already up to date\"\ntime=2025-11-07T01:10:27.795-05:00 level=DEBUG msg=\"Repository synced successfully\" name=quad-ops-deploy changed=false commit=\"\"\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=devops services=1\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Content hash comparison\" existing=7b969d95e6b6e217a0fb2670048bb100a139fd2180f331cbf5d50dd53ec32ed6 new=7b969d95e6b6e217a0fb2670048bb100a139fd2180f331cbf5d50dd53ec32ed6 path=/etc/containers/systemd/devops_gogs-data.volume\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=devops_gogs-data.volume\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Content hash comparison\" existing=e84df50ab997fb0b278bff87f8b50ff433985383c6cdd60f242e47581f4c64ba new=e84df50ab997fb0b278bff87f8b50ff433985383c6cdd60f242e47581f4c64ba path=/etc/containers/systemd/devops_default.network\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=devops_default.network\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5e1a307a1659354f2123a6fd6c4bd6a425bbff18a8ca7b04dee5a46e12aca7ab new=5e1a307a1659354f2123a6fd6c4bd6a425bbff18a8ca7b04dee5a46e12aca7ab path=/etc/containers/systemd/devops-gogs.container\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=devops-gogs.container\ntime=2025-11-07T01:10:27.902-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=devops\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=infrastructure services=3\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Content hash comparison\" existing=f3613709db30d81429eaee24f36b559f76b1658e32c162df56f18901dcc202bd new=f3613709db30d81429eaee24f36b559f76b1658e32c162df56f18901dcc202bd path=/etc/containers/systemd/infrastructure_authelia-data.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_authelia-data.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5fda1f479c2e7cc14455575289f18bfb1f1201f4f80b151e5277e876f69b1db4 new=5fda1f479c2e7cc14455575289f18bfb1f1201f4f80b151e5277e876f69b1db4 path=/etc/containers/systemd/infrastructure_caddy-data.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_caddy-data.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9f19346832616d95b9143d0f97e9309d32e70c6c2ae9d75f5d4e0b76e881f50a new=9f19346832616d95b9143d0f97e9309d32e70c6c2ae9d75f5d4e0b76e881f50a path=/etc/containers/systemd/infrastructure_caddy-config.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_caddy-config.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6f12c4e077e0d396bfcd58afb612be7faf94d621a264eb159399f98d263fb410 new=6f12c4e077e0d396bfcd58afb612be7faf94d621a264eb159399f98d263fb410 path=/etc/containers/systemd/infrastructure_unifi-db-data.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi-db-data.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Content hash comparison\" existing=957d9b0d71e494dd7667145213b5dbbb29b666689c667ff0d72ae72bb006c11a new=957d9b0d71e494dd7667145213b5dbbb29b666689c667ff0d72ae72bb006c11a path=/etc/containers/systemd/infrastructure_unifi-config.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi-config.volume\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Content hash comparison\" existing=22f86239d721d954f2d8a8c9bb8b19167ea0069d6f9d80bb06be4909aed5a8f9 new=22f86239d721d954f2d8a8c9bb8b19167ea0069d6f9d80bb06be4909aed5a8f9 path=/etc/containers/systemd/infrastructure_authelia.network\ntime=2025-11-07T01:10:27.903-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_authelia.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6c48fe70e8edc921991858558ef7f31698c3b58fb6954a481572ce4973974cc1 new=6c48fe70e8edc921991858558ef7f31698c3b58fb6954a481572ce4973974cc1 path=/etc/containers/systemd/infrastructure_default.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_default.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Content hash comparison\" existing=241dd3545c75050911aecda0921b205d76645d42804e2381bcdbf708198086d9 new=241dd3545c75050911aecda0921b205d76645d42804e2381bcdbf708198086d9 path=/etc/containers/systemd/infrastructure_proxy.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_proxy.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Content hash comparison\" existing=02aa2759a51f83da1e6d075df98ddf2c0627d62f2b5b4c2b35665fde1c74f722 new=02aa2759a51f83da1e6d075df98ddf2c0627d62f2b5b4c2b35665fde1c74f722 path=/etc/containers/systemd/infrastructure_unifi.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi.network\ntime=2025-11-07T01:10:27.904-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6e117e4a86fe16b9c29f10928752f6799b0ae5a8c7f640e540a1a6c627610895 new=a82e73909344a4edc4464983669fce8cead4b867c10656607d7d10b7efafba27 path=/etc/containers/systemd/infrastructure-unifi-network-application.container\ntime=2025-11-07T01:10:27.927-05:00 level=DEBUG msg=\"Artifact written\" path=infrastructure-unifi-network-application.container hash=a82e73909344a4edc4464983669fce8cead4b867c10656607d7d10b7efafba27\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6f12c4e077e0d396bfcd58afb612be7faf94d621a264eb159399f98d263fb410 new=6f12c4e077e0d396bfcd58afb612be7faf94d621a264eb159399f98d263fb410 path=/etc/containers/systemd/infrastructure_unifi-db-data.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi-db-data.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=957d9b0d71e494dd7667145213b5dbbb29b666689c667ff0d72ae72bb006c11a new=957d9b0d71e494dd7667145213b5dbbb29b666689c667ff0d72ae72bb006c11a path=/etc/containers/systemd/infrastructure_unifi-config.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi-config.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=f3613709db30d81429eaee24f36b559f76b1658e32c162df56f18901dcc202bd new=f3613709db30d81429eaee24f36b559f76b1658e32c162df56f18901dcc202bd path=/etc/containers/systemd/infrastructure_authelia-data.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_authelia-data.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5fda1f479c2e7cc14455575289f18bfb1f1201f4f80b151e5277e876f69b1db4 new=5fda1f479c2e7cc14455575289f18bfb1f1201f4f80b151e5277e876f69b1db4 path=/etc/containers/systemd/infrastructure_caddy-data.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_caddy-data.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9f19346832616d95b9143d0f97e9309d32e70c6c2ae9d75f5d4e0b76e881f50a new=9f19346832616d95b9143d0f97e9309d32e70c6c2ae9d75f5d4e0b76e881f50a path=/etc/containers/systemd/infrastructure_caddy-config.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_caddy-config.volume\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=22f86239d721d954f2d8a8c9bb8b19167ea0069d6f9d80bb06be4909aed5a8f9 new=22f86239d721d954f2d8a8c9bb8b19167ea0069d6f9d80bb06be4909aed5a8f9 path=/etc/containers/systemd/infrastructure_authelia.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_authelia.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6c48fe70e8edc921991858558ef7f31698c3b58fb6954a481572ce4973974cc1 new=6c48fe70e8edc921991858558ef7f31698c3b58fb6954a481572ce4973974cc1 path=/etc/containers/systemd/infrastructure_default.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_default.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=241dd3545c75050911aecda0921b205d76645d42804e2381bcdbf708198086d9 new=241dd3545c75050911aecda0921b205d76645d42804e2381bcdbf708198086d9 path=/etc/containers/systemd/infrastructure_proxy.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_proxy.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=02aa2759a51f83da1e6d075df98ddf2c0627d62f2b5b4c2b35665fde1c74f722 new=02aa2759a51f83da1e6d075df98ddf2c0627d62f2b5b4c2b35665fde1c74f722 path=/etc/containers/systemd/infrastructure_unifi.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi.network\ntime=2025-11-07T01:10:27.928-05:00 level=DEBUG msg=\"Content hash comparison\" existing=dc7f6bac1bb5545e490c8d1794ae2c4e53956b6bb6aa4c812824922a276bed10 new=20c609428cf50015ee6ed84db6195f0391532feb43a56d26be1b3a8a438f9065 path=/etc/containers/systemd/infrastructure-unifi-db.container\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact written\" path=infrastructure-unifi-db.container hash=20c609428cf50015ee6ed84db6195f0391532feb43a56d26be1b3a8a438f9065\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=f3613709db30d81429eaee24f36b559f76b1658e32c162df56f18901dcc202bd new=f3613709db30d81429eaee24f36b559f76b1658e32c162df56f18901dcc202bd path=/etc/containers/systemd/infrastructure_authelia-data.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_authelia-data.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5fda1f479c2e7cc14455575289f18bfb1f1201f4f80b151e5277e876f69b1db4 new=5fda1f479c2e7cc14455575289f18bfb1f1201f4f80b151e5277e876f69b1db4 path=/etc/containers/systemd/infrastructure_caddy-data.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_caddy-data.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9f19346832616d95b9143d0f97e9309d32e70c6c2ae9d75f5d4e0b76e881f50a new=9f19346832616d95b9143d0f97e9309d32e70c6c2ae9d75f5d4e0b76e881f50a path=/etc/containers/systemd/infrastructure_caddy-config.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_caddy-config.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6f12c4e077e0d396bfcd58afb612be7faf94d621a264eb159399f98d263fb410 new=6f12c4e077e0d396bfcd58afb612be7faf94d621a264eb159399f98d263fb410 path=/etc/containers/systemd/infrastructure_unifi-db-data.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi-db-data.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=957d9b0d71e494dd7667145213b5dbbb29b666689c667ff0d72ae72bb006c11a new=957d9b0d71e494dd7667145213b5dbbb29b666689c667ff0d72ae72bb006c11a path=/etc/containers/systemd/infrastructure_unifi-config.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi-config.volume\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=22f86239d721d954f2d8a8c9bb8b19167ea0069d6f9d80bb06be4909aed5a8f9 new=22f86239d721d954f2d8a8c9bb8b19167ea0069d6f9d80bb06be4909aed5a8f9 path=/etc/containers/systemd/infrastructure_authelia.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_authelia.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6c48fe70e8edc921991858558ef7f31698c3b58fb6954a481572ce4973974cc1 new=6c48fe70e8edc921991858558ef7f31698c3b58fb6954a481572ce4973974cc1 path=/etc/containers/systemd/infrastructure_default.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_default.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=241dd3545c75050911aecda0921b205d76645d42804e2381bcdbf708198086d9 new=241dd3545c75050911aecda0921b205d76645d42804e2381bcdbf708198086d9 path=/etc/containers/systemd/infrastructure_proxy.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_proxy.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=02aa2759a51f83da1e6d075df98ddf2c0627d62f2b5b4c2b35665fde1c74f722 new=02aa2759a51f83da1e6d075df98ddf2c0627d62f2b5b4c2b35665fde1c74f722 path=/etc/containers/systemd/infrastructure_unifi.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=infrastructure_unifi.network\ntime=2025-11-07T01:10:27.930-05:00 level=DEBUG msg=\"Content hash comparison\" existing=349fd61155d61c8e776b8edb99f3e6077b21caf8b3f125074603c911daeb9c5b new=c5805a40920e0a4e074fa014d2da2141842e1d9609a1bf94962e1b924d424b3f path=/etc/containers/systemd/infrastructure-reverse-proxy.container\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact written\" path=infrastructure-reverse-proxy.container hash=c5805a40920e0a4e074fa014d2da2141842e1d9609a1bf94962e1b924d424b3f\ntime=2025-11-07T01:10:27.932-05:00 level=INFO msg=\"Artifacts written\" repo=quad-ops-deploy project=infrastructure changed=3\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=llm services=2\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Content hash comparison\" existing=4f560251bc04ffcf9769116536333da8a302e62ca3ab07183e6222cabe7b8434 new=4f560251bc04ffcf9769116536333da8a302e62ca3ab07183e6222cabe7b8434 path=/etc/containers/systemd/llm_ollama-data.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=llm_ollama-data.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Content hash comparison\" existing=98a8cb75209a8a8f42db6eed00f17c148d990be612fb41abf9ca9be85799ca36 new=98a8cb75209a8a8f42db6eed00f17c148d990be612fb41abf9ca9be85799ca36 path=/etc/containers/systemd/llm_open-webui.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=llm_open-webui.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Content hash comparison\" existing=e8a0b2ed6a931b502e7937e807f1ceeef9635fca75baac017a2ff52e3033aa4a new=e8a0b2ed6a931b502e7937e807f1ceeef9635fca75baac017a2ff52e3033aa4a path=/etc/containers/systemd/llm-ollama.container\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=llm-ollama.container\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Content hash comparison\" existing=4f560251bc04ffcf9769116536333da8a302e62ca3ab07183e6222cabe7b8434 new=4f560251bc04ffcf9769116536333da8a302e62ca3ab07183e6222cabe7b8434 path=/etc/containers/systemd/llm_ollama-data.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=llm_ollama-data.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Content hash comparison\" existing=98a8cb75209a8a8f42db6eed00f17c148d990be612fb41abf9ca9be85799ca36 new=98a8cb75209a8a8f42db6eed00f17c148d990be612fb41abf9ca9be85799ca36 path=/etc/containers/systemd/llm_open-webui.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=llm_open-webui.volume\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5004365365d11210fa4edfba8f7ce7b8a3654acbdeaae0cc9341fdb6b8fa9b4e new=5004365365d11210fa4edfba8f7ce7b8a3654acbdeaae0cc9341fdb6b8fa9b4e path=/etc/containers/systemd/llm-open-webui.container\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=llm-open-webui.container\ntime=2025-11-07T01:10:27.932-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=llm\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=media services=4\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 new=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 path=/etc/containers/systemd/media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 new=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 path=/etc/containers/systemd/media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 new=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 path=/etc/containers/systemd/media_default.network\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_default.network\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=422f47ee9978068408b939812f4c969c7379a529f7e709c7e5826e8fd02ee507 new=422f47ee9978068408b939812f4c969c7379a529f7e709c7e5826e8fd02ee507 path=/etc/containers/systemd/media-immich-redis.container\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media-immich-redis.container\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 new=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 path=/etc/containers/systemd/media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 new=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 path=/etc/containers/systemd/media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 new=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 path=/etc/containers/systemd/media_default.network\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_default.network\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=bed403a6ba0a58b6a679833e5484749bd4c8b4c8ea0e337a06382d981b97982a new=bed403a6ba0a58b6a679833e5484749bd4c8b4c8ea0e337a06382d981b97982a path=/etc/containers/systemd/media-immich-database.container\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media-immich-database.container\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 new=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 path=/etc/containers/systemd/media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 new=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 path=/etc/containers/systemd/media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 new=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 path=/etc/containers/systemd/media_default.network\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_default.network\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=6ac3449a26ad0c4f144544722ae78d9f7f517017c4efe768787b7ef99566035b new=6ac3449a26ad0c4f144544722ae78d9f7f517017c4efe768787b7ef99566035b path=/etc/containers/systemd/media-immich-server.container\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media-immich-server.container\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 new=05cb419411cca6e28e531cc78660d8c3c87364ccc5caf34677be7a14dd157990 path=/etc/containers/systemd/media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-model-cache.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Content hash comparison\" existing=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 new=26e42cf21e09056b475bd06f517ad886fb0c43e0a5d0dbdb7249e6ede2333061 path=/etc/containers/systemd/media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.933-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_immich-postgres-data.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 new=9ecfeaeb087e46edaaad9b516fc589966d98bfcfeb67e09c6328969d0650e2f1 path=/etc/containers/systemd/media_default.network\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media_default.network\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5f622ee876beee30e9d38f086f9901d92f9bb7b5e2d3d0f1705ffdf10b92a9d9 new=5f622ee876beee30e9d38f086f9901d92f9bb7b5e2d3d0f1705ffdf10b92a9d9 path=/etc/containers/systemd/media-immich-machine-learning.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=media-immich-machine-learning.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=media\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=beszel services=2\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=583de05f26a61f682d106856aaaece9d53c377cd052f3423885385c7a3bc0f91 new=583de05f26a61f682d106856aaaece9d53c377cd052f3423885385c7a3bc0f91 path=/etc/containers/systemd/beszel_beszel-data.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel_beszel-data.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=75d1a5dccd7018654a21e462387ff383ada56db5175f9eac13a17aaad437741c new=75d1a5dccd7018654a21e462387ff383ada56db5175f9eac13a17aaad437741c path=/etc/containers/systemd/beszel_beszel-socket.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel_beszel-socket.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=3d71ab71e48289d4b77424429341e67b64c4171b577e23256ef99b2dd80b9e62 new=3d71ab71e48289d4b77424429341e67b64c4171b577e23256ef99b2dd80b9e62 path=/etc/containers/systemd/beszel_default.network\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel_default.network\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=cca2e84159912620fa63d7900fef0953b77dbb7998e1557bfa1154997d19b16d new=cca2e84159912620fa63d7900fef0953b77dbb7998e1557bfa1154997d19b16d path=/etc/containers/systemd/beszel-hub.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel-hub.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=583de05f26a61f682d106856aaaece9d53c377cd052f3423885385c7a3bc0f91 new=583de05f26a61f682d106856aaaece9d53c377cd052f3423885385c7a3bc0f91 path=/etc/containers/systemd/beszel_beszel-data.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel_beszel-data.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=75d1a5dccd7018654a21e462387ff383ada56db5175f9eac13a17aaad437741c new=75d1a5dccd7018654a21e462387ff383ada56db5175f9eac13a17aaad437741c path=/etc/containers/systemd/beszel_beszel-socket.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel_beszel-socket.volume\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=3d71ab71e48289d4b77424429341e67b64c4171b577e23256ef99b2dd80b9e62 new=3d71ab71e48289d4b77424429341e67b64c4171b577e23256ef99b2dd80b9e62 path=/etc/containers/systemd/beszel_default.network\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel_default.network\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=5441be71ab7154088ca6058106781822d1b08124088c0dd77c397f71e1e70336 new=5441be71ab7154088ca6058106781822d1b08124088c0dd77c397f71e1e70336 path=/etc/containers/systemd/beszel-agent.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=beszel-agent.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=beszel\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=dozzle services=1\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Content hash comparison\" existing=bc90c385951cd0f2e96cecdfaf6a6c7dc313224f7eeb2dfaf41ac75e9bc5ae44 new=bc90c385951cd0f2e96cecdfaf6a6c7dc313224f7eeb2dfaf41ac75e9bc5ae44 path=/etc/containers/systemd/dozzle-web.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=dozzle-web.container\ntime=2025-11-07T01:10:27.934-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=dozzle\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=scrutiny services=3\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=cbb3146f77abbd98d872f853508fd63ee1bfdb8b6124c86064d2fd45dcb5e6bf new=cbb3146f77abbd98d872f853508fd63ee1bfdb8b6124c86064d2fd45dcb5e6bf path=/etc/containers/systemd/scrutiny_scrutiny-config.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_scrutiny-config.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=3d2450a4ed24d3f712330eb2e093b57a70d83ce22b75684549cca101731018c0 new=3d2450a4ed24d3f712330eb2e093b57a70d83ce22b75684549cca101731018c0 path=/etc/containers/systemd/scrutiny_scrutiny-influxdb.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_scrutiny-influxdb.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=8d430dd19599734a2f02f62d5396698b671246a0bda312c9069eb8cecb2c785c new=8d430dd19599734a2f02f62d5396698b671246a0bda312c9069eb8cecb2c785c path=/etc/containers/systemd/scrutiny_default.network\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_default.network\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=17d4fcacc146817a6157d158383f7fb89a213c3cfdcd1af807c5786625bf5b58 new=17d4fcacc146817a6157d158383f7fb89a213c3cfdcd1af807c5786625bf5b58 path=/etc/containers/systemd/scrutiny-web.container\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny-web.container\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=cbb3146f77abbd98d872f853508fd63ee1bfdb8b6124c86064d2fd45dcb5e6bf new=cbb3146f77abbd98d872f853508fd63ee1bfdb8b6124c86064d2fd45dcb5e6bf path=/etc/containers/systemd/scrutiny_scrutiny-config.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_scrutiny-config.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=3d2450a4ed24d3f712330eb2e093b57a70d83ce22b75684549cca101731018c0 new=3d2450a4ed24d3f712330eb2e093b57a70d83ce22b75684549cca101731018c0 path=/etc/containers/systemd/scrutiny_scrutiny-influxdb.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_scrutiny-influxdb.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=8d430dd19599734a2f02f62d5396698b671246a0bda312c9069eb8cecb2c785c new=8d430dd19599734a2f02f62d5396698b671246a0bda312c9069eb8cecb2c785c path=/etc/containers/systemd/scrutiny_default.network\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_default.network\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=d4fc4113bfbc9890e5e49374d9e3dbce7635bc5af06f147c49452fdcc840f133 new=d4fc4113bfbc9890e5e49374d9e3dbce7635bc5af06f147c49452fdcc840f133 path=/etc/containers/systemd/scrutiny-collector.container\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny-collector.container\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=cbb3146f77abbd98d872f853508fd63ee1bfdb8b6124c86064d2fd45dcb5e6bf new=cbb3146f77abbd98d872f853508fd63ee1bfdb8b6124c86064d2fd45dcb5e6bf path=/etc/containers/systemd/scrutiny_scrutiny-config.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_scrutiny-config.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=3d2450a4ed24d3f712330eb2e093b57a70d83ce22b75684549cca101731018c0 new=3d2450a4ed24d3f712330eb2e093b57a70d83ce22b75684549cca101731018c0 path=/etc/containers/systemd/scrutiny_scrutiny-influxdb.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_scrutiny-influxdb.volume\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=8d430dd19599734a2f02f62d5396698b671246a0bda312c9069eb8cecb2c785c new=8d430dd19599734a2f02f62d5396698b671246a0bda312c9069eb8cecb2c785c path=/etc/containers/systemd/scrutiny_default.network\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny_default.network\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Content hash comparison\" existing=0625d5eb5c056d6655b9fc47720618906b5462bdf3273f02eff2a9c2ed9e008c new=0625d5eb5c056d6655b9fc47720618906b5462bdf3273f02eff2a9c2ed9e008c path=/etc/containers/systemd/scrutiny-influxdb.container\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=scrutiny-influxdb.container\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=scrutiny\ntime=2025-11-07T01:10:27.935-05:00 level=DEBUG msg=\"Processed compose project\" repo=quad-ops-deploy project=miniflux services=2\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Content hash comparison\" existing=cf6e14acc8357da96fa8908c8a64a4ea6b26df8ef4e0155aa383a89be8c1f904 new=cf6e14acc8357da96fa8908c8a64a4ea6b26df8ef4e0155aa383a89be8c1f904 path=/etc/containers/systemd/miniflux_db-data.volume\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=miniflux_db-data.volume\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Content hash comparison\" existing=66405212cf1660b772fcd91d7b010c7fff5cbb3dc1c35ac0959ee63547158edc new=66405212cf1660b772fcd91d7b010c7fff5cbb3dc1c35ac0959ee63547158edc path=/etc/containers/systemd/miniflux_default.network\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=miniflux_default.network\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Content hash comparison\" existing=eff137248dc314963bd490e7851e766e4749fb67a4fd4f0c3fe32cd72e32e315 new=eff137248dc314963bd490e7851e766e4749fb67a4fd4f0c3fe32cd72e32e315 path=/etc/containers/systemd/miniflux-db.container\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=miniflux-db.container\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Content hash comparison\" existing=cf6e14acc8357da96fa8908c8a64a4ea6b26df8ef4e0155aa383a89be8c1f904 new=cf6e14acc8357da96fa8908c8a64a4ea6b26df8ef4e0155aa383a89be8c1f904 path=/etc/containers/systemd/miniflux_db-data.volume\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=miniflux_db-data.volume\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Content hash comparison\" existing=66405212cf1660b772fcd91d7b010c7fff5cbb3dc1c35ac0959ee63547158edc new=66405212cf1660b772fcd91d7b010c7fff5cbb3dc1c35ac0959ee63547158edc path=/etc/containers/systemd/miniflux_default.network\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=miniflux_default.network\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Content hash comparison\" existing=718135521d0e78d3187116ffea781df185f706277fb10d5541c419ba423eaf5b new=718135521d0e78d3187116ffea781df185f706277fb10d5541c419ba423eaf5b path=/etc/containers/systemd/miniflux-web.container\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Artifact unchanged, skipping\" path=miniflux-web.container\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"No artifact changes\" repo=quad-ops-deploy project=miniflux\ntime=2025-11-07T01:10:27.936-05:00 level=INFO msg=\"Reloading service manager\"\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Reloading systemd daemon configuration\"\ntime=2025-11-07T01:10:27.936-05:00 level=DEBUG msg=\"Establishing system connection to systemd\"\ntime=2025-11-07T01:10:28.908-05:00 level=DEBUG msg=\"Successfully reloaded systemd daemon\"\ntime=2025-11-07T01:10:28.908-05:00 level=DEBUG msg=\"Restarting multiple services\" count=3\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"No orphaned rootlessport processes found (pgrep exit code 1)\"\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"Restarting service\" name=infrastructure-reverse-proxy\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"Establishing system connection to systemd\"\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"Restarting service\" name=infrastructure-unifi-network-application\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"Establishing system connection to systemd\"\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"Restarting service\" name=infrastructure-unifi-db\ntime=2025-11-07T01:10:28.990-05:00 level=DEBUG msg=\"Establishing system connection to systemd\"\ntime=2025-11-07T01:10:29.838-05:00 level=DEBUG msg=\"Successfully restarted service\" name=infrastructure-reverse-proxy\ntime=2025-11-07T01:10:34.153-05:00 level=DEBUG msg=\"Successfully restarted service\" name=infrastructure-unifi-db\ntime=2025-11-07T01:10:34.536-05:00 level=DEBUG msg=\"Successfully restarted service\" name=infrastructure-unifi-network-application\ntime=2025-11-07T01:10:34.536-05:00 level=DEBUG msg=\"Completed restarting services\" total=3 success=3 failed=0\ntime=2025-11-07T01:10:34.536-05:00 level=INFO msg=\"Service restarted\" service=infrastructure-unifi-network-application\ntime=2025-11-07T01:10:34.536-05:00 level=INFO msg=\"Service restarted\" service=infrastructure-reverse-proxy\ntime=2025-11-07T01:10:34.536-05:00 level=INFO msg=\"Service restarted\" service=infrastructure-unifi-db\n\n[root@bdyvp22 ~]# quad-ops unit list -v\nquad-ops using config: /etc/quad-ops/config.yaml\n\ntime=2025-11-07T01:10:45.481-05:00 level=DEBUG msg=\"Validating systemd availability\"\ntime=2025-11-07T01:10:45.488-05:00 level=DEBUG msg=\"Validating podman availability\"\ntime=2025-11-07T01:10:45.520-05:00 level=DEBUG msg=\"Validating podman-system-generator availability\"\ntime=2025-11-07T01:10:45.522-05:00 level=DEBUG msg=\"Listing artifacts from repository\"\ntime=2025-11-07T01:10:45.529-05:00 level=INFO msg=\"No deployed artifacts found\"\n\n[trly@bdyvp22 ~]$ sudo podman ps -a\n[sudo] password for trly:\nCONTAINER ID  IMAGE                                                                                                COMMAND               CREATED         STATUS                 PORTS                                                                                                                                                                                                       NAMES\n661fa4d491b9  docker.io/ollama/ollama:latest                                                                       serve                 21 hours ago    Up 21 hours            11434/tcp                                                                                                                                                                                                   llm-ollama\n1c2be9a3d4bb  ghcr.io/open-webui/open-webui:latest                                                                 bash start.sh         21 hours ago    Up 21 hours            8080/tcp                                                                                                                                                                                                    llm-open-webui\nf58cec69fb3c  docker.io/henrygd/beszel:latest                                                                      serve --http=0.0....  21 hours ago    Up 21 hours            8090/tcp                                                                                                                                                                                                    beszel-hub\n46ed7cafdabe  ghcr.io/immich-app/immich-machine-learning:v2.1.0                                                    python -m immich_...  21 hours ago    Up 21 hours                                                                                                                                                                                                                        media-immich-machine-learning\n8d42f47dc0cb  docker.io/valkey/valkey@sha256:facc1d2c3462975c34e10fccb167bfa92b0e0dbd992fc282c29a61c3243afb11      valkey-server         21 hours ago    Up 21 hours (healthy)  6379/tcp                                                                                                                                                                                                    media-immich-redis\n8c2a33ba7945  ghcr.io/immich-app/postgres@sha256:32324a2f41df5de9efe1af166b7008c3f55646f8d0e00d9550c16c9822366b4a  postgres -c confi...  21 hours ago    Up 21 hours            5432/tcp                                                                                                                                                                                                    media-immich-database\n493de8374947  docker.io/library/influxdb:2.2                                                                       influxd               21 hours ago    Up 21 hours (healthy)  8086/tcp                                                                                                                                                                                                    scrutiny-influxdb\n0aaac6fb0175  ghcr.io/analogj/scrutiny:master-collector                                                            /entrypoint-colle...  21 hours ago    Up 21 hours                                                                                                                                                                                                                        scrutiny-collector\nd12431da0eea  ghcr.io/trly/caddy:main                                                                              caddy run --confi...  21 hours ago    Up 21 hours            0.0.0.0:80-\u003e80/tcp, 0.0.0.0:443-\u003e443/tcp, 2019/tcp, 443/udp                                                                                                                                                 infrastructure-reverse-proxy\ncbadfde53532  docker.io/library/mongo:8                                                                            mongod                21 hours ago    Up 21 hours            27017/tcp                                                                                                                                                                                                   infrastructure-unifi-db\nd5143d0d151b  lscr.io/linuxserver/unifi-network-application:latest                                                                       21 hours ago    Up 21 hours            0.0.0.0:6789-\u003e6789/tcp, 0.0.0.0:8080-\u003e8080/tcp, 0.0.0.0:8843-\u003e8843/tcp, 0.0.0.0:8880-\u003e8880/tcp, 0.0.0.0:1900-\u003e1900/udp, 0.0.0.0:3478-\u003e3478/udp, 0.0.0.0:5514-\u003e5514/udp, 0.0.0.0:10001-\u003e10001/udp, 8443/tcp  infrastructure-unifi-network-application\nf7128578bd90  ghcr.io/immich-app/immich-server:v2.1.0                                                              start.sh              18 seconds ago  Up 18 seconds          127.0.0.1:2283-\u003e2283/tcp, 127.0.0.1:8081-8082-\u003e8081-8082/tcp                                                                                                                                                media-immich-server\n","notes":"ROOT CAUSE IDENTIFIED: RepoArtifactStore is initialized with cfg.RepositoryDir (/var/lib/quad-ops - where git repos are cloned), but unit list tries to list from there by default. Actual deployed artifacts are in cfg.QuadletDir (/etc/containers/systemd/). RepoArtifactStore scans raw git clones (Compose files) which don't match platform filters (.container, .network), returning empty list. The rendered artifact files only exist after sync writes them to QuadletDir. Fix: Make unit list default to using ArtifactStore (deployed dir) instead of RepoArtifactStore (git repo dir). See history/ROOT_CAUSE_ANALYSIS.md","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-07T01:11:27.273766288-05:00","updated_at":"2025-11-07T22:13:23.897176023-05:00","closed_at":"2025-11-07T22:13:23.897176023-05:00","source_repo":"."}
{"id":"quad-ops-w84","content_hash":"f1cf6e0ff203ac33349b5d827396ae15c44b2b49d88364125b1e8b7a0782aa9b","title":"unit list command uses wrong artifact directory on both platforms","description":"cmd/app.go (lines 72-73): unit list initializes ArtifactStore with cfg.RepositoryDir (git clone location) instead of cfg.QuadletDir (rendered platform-specific units).\n\nThis causes unit list to scan raw Compose files instead of rendered .service/.network/.volume files, returning empty results when platform-specific units exist.\n\nRendered units only exist in QuadletDir after sync writes them. RepoArtifactStore scans git clones which don't match platform filters (.container, .network, .service, .plist).\n\nFix: Make unit list default to using ArtifactStore pointing to cfg.QuadletDir (deployed directory) instead of RepoArtifactStore.","acceptance_criteria":"./quad-ops unit list should return all deployed platform-specific units from QuadletDir for both systemd and launchd","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-08T16:01:18.292203186-05:00","updated_at":"2025-11-08T16:13:55.849264467-05:00","closed_at":"2025-11-08T16:13:55.849264467-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-w84","depends_on_id":"quad-ops-a3j","type":"parent-child","created_at":"2025-11-08T16:02:58.84731813-05:00","created_by":"daemon"},{"issue_id":"quad-ops-w84","depends_on_id":"quad-ops-u4g","type":"parent-child","created_at":"2025-11-08T16:02:58.881900501-05:00","created_by":"daemon"},{"issue_id":"quad-ops-w84","depends_on_id":"quad-ops-h7w","type":"parent-child","created_at":"2025-11-08T16:02:58.91509316-05:00","created_by":"daemon"}]}
{"id":"quad-ops-we42","content_hash":"7bbeafaf24e19e716ace4cdf196dbaa744f90cb8ea5b3a79d2e3dc50fc8eb410","title":"Evaluate and simplify testutil.NewTestLogger","description":"testutil.NewTestLogger creates a custom slog.Handler for test logging. This adds maintenance overhead for questionable value. Major Go projects either use testify's built-in logger support or simply use standard logging in tests.\n\nSteps:\n1. Audit all usages of NewTestLogger to understand if custom handler is actually needed\n2. Evaluate alternatives:\n   - Use standard log output (tests capture it automatically)\n   - Use testify's testing.T logging integration\n   - Keep only if slog-specific features are required\n3. If keeping, document why custom handler is necessary\n4. If removing, migrate usages to simpler approach\n\nResearch findings: Major projects (Kubernetes, etcd, Prometheus) don't build custom test loggers - they use standard logging or testify helpers.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-12T09:25:15.66361-05:00","updated_at":"2025-11-12T09:55:54.461584-05:00","closed_at":"2025-11-12T09:55:54.461584-05:00","source_repo":"."}
{"id":"quad-ops-wib","content_hash":"0152749e529a73d0a8e2e543e9127a14d01400dd1fe585fb33018739182ecf5f","title":"Add tests for service network declarations and DNS resolution","description":"Write comprehensive tests covering:\n1. SpecConverter correctly extracts service-level networks from compose files\n2. Services with multiple network declarations are converted properly\n3. systemd renderer generates correct --network flags for each service network\n4. launchd renderer generates correct --network flags for each service network\n5. Network unit file dependencies are set correctly\n6. Test with multi-network services like the immich example (default + infrastructure-proxy)\n\nTests should verify DNS resolution would work (services on same networks).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-08T15:58:06.880531913-05:00","updated_at":"2025-11-08T16:55:44.010617008-05:00","closed_at":"2025-11-08T16:55:44.010617008-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-wib","depends_on_id":"quad-ops-4pn","type":"blocks","created_at":"2025-11-08T15:58:06.885577397-05:00","created_by":"daemon"},{"issue_id":"quad-ops-wib","depends_on_id":"quad-ops-hak","type":"blocks","created_at":"2025-11-08T15:58:06.889157141-05:00","created_by":"daemon"}]}
{"id":"quad-ops-x67","content_hash":"06f031f2c5b2ed3ffc5deab915ea5b4d28af77c110e42ed3aadf4391b5dc6443","title":"Network name sanitization must maintain consistency between definition and service references","description":"Document and validate the critical dependency between SanitizeName usage in network definition and service network references.\n\n## Problem\n\nSanitizeName is called in two contexts for networks:\n\n1. **Network Definition** (convertProjectNetworks, lines 530-535):\n   - Sanitizes network names when creating service.Network objects\n   - May prefix with project name\n\n2. **Service Network References** (convertNetworkMode, lines 553-557, 586-590):\n   - Sanitizes network names when populating Container.Network.ServiceNetworks\n   - Must produce identical names as network definitions\n\nIf SanitizeName behavior changes or is applied inconsistently, the names will diverge and network dependencies break at runtime.\n\n## Impact\n\n**systemd rendering failure:**\n- Network defined as: \"my_network\" → sanitized to \"my_network\"\n- Service references: \"my_network\" → sanitized to \"my-network\" (different!)\n- systemd unit dependency for Network=my-network fails to find my_network.network\n- Container startup fails with missing network error\n\n## Dependency Chain\n\n1. SanitizeName definition (internal/service/validate.go:226-245)\n2. convertProjectNetworks (line 532)\n3. convertNetworkMode default networks (line 553)\n4. convertNetworkMode explicit networks (line 586)\n5. systemd renderer that expects matching names (internal/platform/systemd/renderer.go)\n\n## Test Coverage\n\nnetwork_dependencies_test.go validates this by asserting that ServiceNetworks contains exactly the same sanitized names as spec.Networks definitions.\n\n## Action Items\n\n- [ ] Document in code comments why SanitizeName consistency is critical\n- [ ] Add assertions/validations to prevent future regressions\n- [ ] Consider making SanitizeName immutable or version-stable\n- [ ] Review all calls to SanitizeName for networks to ensure consistency","design":"## Design Approach\n\n### Root Cause\nThe network name sanitization uses a regex-based approach that must be applied identically everywhere:\n\n```go\nfunc SanitizeName(name string) string {\n    // 1. Replace invalid chars with hyphens\n    // 2. Remove leading/trailing non-alphanumeric\n    // 3. Collapse multiple hyphens\n    return result\n}\n```\n\nThis function is called in two separate code paths that must always produce identical output for the same input.\n\n### Risk\nIf future changes modify SanitizeName (e.g., to preserve underscores or dots differently), the two code paths may diverge unintentionally, causing network names to mismatch.\n\n### Prevention Strategy\n1. Add explicit validation that compares defined network names with referenced names\n2. Document the critical nature of SanitizeName consistency for networks\n3. Add invariant checks in spec validation phase\n4. Consider a separate NameNormalizer interface to enforce consistency","acceptance_criteria":"- Behavior documented in comments explaining SanitizeName dependency\n- Code comments added to both network definition and service reference locations\n- No functional changes (current behavior is correct)\n- Issue serves as documentation/risk mitigation for future changes","notes":"Analysis phase complete. Key findings:\n1. SanitizeName() is called ~12 times across spec_converter.go and tests\n2. All input names already validated by compose-spec parser  \n3. Prefix() function only does string concatenation with hyphen - cannot introduce invalid chars\n4. Current sanitization is unnecessary and adds complexity\n\n## Phase 1: Remove SanitizeName Tests and Function ✅ COMPLETED\n\n- Removed SanitizeName() function from internal/service/validate.go (lines 226-245)\n- Removed TestSanitizeName() test \n- Removed TestSanitizeName_UnderscorePreservation() test\n- Removed TestSanitizeName_DependencyStability() test\n- Removed TestSanitizeName_SystemdCompatibility() test\n- Service validation tests all pass\n- Other tests remain untouched (next phase will update them)\n\n## Next Phase: Update call sites in spec_converter.go and its tests (10 call sites to replace)\n\nPlan: Option A (Complete removal) per history/quad-ops-x67-plan.md\"","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-11-10T07:47:26.802417421-05:00","updated_at":"2025-11-10T08:01:17.053155691-05:00","source_repo":"."}
{"id":"quad-ops-xd3","content_hash":"84da4b7686411726524992628f117a0a9437b4ea08c3425fe517ba1484d2abc4","title":"Test dependency handling across platforms","description":"Add missing dependency handling tests, primarily for systemd renderer and integration tests. launchd tests already comprehensive.\n\nCurrent coverage:\n✅ cmd/up_test.go - Dependency ordering and expansion tests\n✅ internal/platform/launchd/renderer_test.go - DependsOn rendering\n✅ internal/platform/launchd/lifecycle_test.go - Start/stop ordering\n❌ internal/platform/systemd/renderer_test.go - Missing After/Requires/Before tests\n❌ Integration tests - No multi-service dependency integration tests\n\nNeed to:\n- Add systemd renderer tests for After/Requires/Before directive generation\n- Test network and volume dependency rendering in systemd Quadlet units\n- Create integration tests with multi-service compose files containing dependencies\n- Verify dependency ordering works end-to-end on both platforms","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-06T23:26:45.293937957-05:00","updated_at":"2025-11-12T11:58:58.122561-05:00","closed_at":"2025-11-12T11:58:58.122561-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-xd3","depends_on_id":"quad-ops-9y2","type":"parent-child","created_at":"2025-11-06T23:26:48.36698896-05:00","created_by":"daemon"}]}
{"id":"quad-ops-xgo","content_hash":"609cc7a2672a5c5639ee7888869db3cf75aad84f2136a2ce71cee56dbbe5af12","title":"Create missing Podman-systemd (Quadlet) documentation section","description":"The docs index references a 'Podman-systemd (Quadlet)' section that doesn't exist. Create this section to document:\n- Quadlet unit file formats and options\n- How quad-ops generates and manages Quadlet units\n- Platform-specific differences and limitations\n- Troubleshooting Quadlet-related issues\n- Links to official Podman Quadlet documentation","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-06T23:24:14.454650246-05:00","updated_at":"2025-11-06T23:24:14.454650246-05:00","source_repo":".","labels":["documentation","podman","quadlet","systemd"],"dependencies":[{"issue_id":"quad-ops-xgo","depends_on_id":"quad-ops-79g","type":"blocks","created_at":"2025-11-06T23:24:14.464388859-05:00","created_by":"daemon"}]}
{"id":"quad-ops-xmd","content_hash":"090513f4f6ec2a2f1b6fadcaddccc862dcf96e36e08ce73576e0ad26ae87f082","title":"Apply dependency formatting fix to launchd renderer","description":"The systemd renderer was fixed to handle dependency names with unit type suffixes (like .network, .volume). The launchd renderer may have similar issues when handling dependencies via buildLabel().\n\nNeed to:\n1. Review launchd/renderer.go buildLabel() function to understand how it formats dependency labels\n2. Apply the same logic to handle unit type suffixes correctly for macOS launchd plist files\n3. Add tests for launchd with dependencies that have unit type suffixes","acceptance_criteria":"Launchd renderer properly handles dependencies with unit type suffixes. Dependencies are formatted consistently with the systemd renderer. Tests confirm no malformed suffixes are generated.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-09T12:42:43.656748391-05:00","updated_at":"2025-11-09T12:42:43.656748391-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-xmd","depends_on_id":"quad-ops-m5f","type":"blocks","created_at":"2025-11-09T12:42:43.657520243-05:00","created_by":"daemon"}]}
{"id":"quad-ops-xoj","content_hash":"0065c1be4a812ee963c5c4664c35d1ea4d460aba052cfe36195e551f5355900d","title":"Improve golden test structure: add .golden suffix and extra/missing artifact checks","description":"Based on oracle review and Go best practices research (Kubernetes pattern):\n\n**Current issues:**\n- Golden files don't use .golden suffix (harder to identify fixtures)\n- No verification that all/only expected artifacts are generated\n- require.NoError formatting bug (missing 'f' suffix)\n\n**Changes needed in renderer_golden_test.go:**\n1. Add .golden suffix: `goldenPath := filepath.Join(\"testdata\", tc.name, artifact.Path + \".golden\")`\n2. Fix formatting: `require.NoErrorf(t, err, \"Failed to read golden file: %s\", goldenPath)`\n3. Add artifact count verification: check result.Artifacts matches expected files in testdata\n4. Optional: Add t.Parallel() per subtest for speed\n\n**Benefits:**\n- Clearer fixture identification (.golden extension)\n- Catch missing/extra artifacts (prevents stale fixtures)\n- Follows Kubernetes/Go stdlib patterns\n\n**Reference:** Oracle review from quad-ops review session, librarian research on golden test patterns","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-11T17:05:30.782231-05:00","updated_at":"2025-11-11T17:07:48.42057-05:00","closed_at":"2025-11-11T17:07:48.42057-05:00","source_repo":"."}
{"id":"quad-ops-xqw","content_hash":"a4e27552d09380597a2ce60db7bd3e6965ab03597a55e5d42433fdea1398b4ab","title":"Cross-platform parity: launchd missing extra_hosts, dns, devices, tmpfs options","description":"launchd renderer doesn't translate Container fields to podman CLI flags, causing features to work on systemd but fail silently on macOS.\n\nMissing in BuildPodmanArgs():\n- extra_hosts → --add-host\n- dns/dns_search/dns_opt → --dns, --dns-search, --dns-opt  \n- devices → --device\n- tmpfs long syntax → --tmpfs with size/mode options\n\nImpact: Same compose file behaves differently on Linux vs macOS","design":"File: internal/platform/launchd/podmanargs.go\n\nIn BuildPodmanArgs():\n1. Add --add-host for each Container.AddHost entry\n2. Add --dns for each Container.DNS entry\n3. Add --dns-search for each Container.DNSSearch entry\n4. Add --dns-opt for each Container.DNSOpt entry\n5. Add --device for each Container.Devices entry\n6. For tmpfs mounts with TmpfsOptions, build --tmpfs /path:size=X,mode=Y format\n\nAll Container fields are already populated by spec_converter; just need flag generation.","acceptance_criteria":"- extra_hosts works on macOS\n- dns/dns_search/dns_opt works on macOS\n- devices works on macOS\n- tmpfs size/mode options work on macOS\n- Test coverage for all flags","notes":"Implementation Plan drafted on 2025-11-09:\n1. Add failing launchd-specific tests covering --add-host/--dns/--dns-search/--dns-opt, --device, and tmpfs option rendering.\n2. Update BuildPodmanArgs to emit extra host and DNS flags using deterministic ordering.\n3. Render tmpfs mounts (including TmpfsOptions) via --tmpfs flags instead of generic -v entries.\n4. Run full suite, lint, and tidy helper naming once new behavior passes.\n\nScope remains confined to internal/platform/launchd podman argument building/tests; systemd renderer and lifecycle layers remain untouched.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-09T16:40:17.231577-05:00","updated_at":"2025-11-09T19:02:13.70352-05:00","closed_at":"2025-11-09T19:02:13.70352-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-xqw","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.500131-05:00","created_by":"daemon"},{"issue_id":"quad-ops-xqw","depends_on_id":"quad-ops-460","type":"parent-child","created_at":"2025-11-09T18:44:53.052034-05:00","created_by":"daemon"},{"issue_id":"quad-ops-xqw","depends_on_id":"quad-ops-sly","type":"parent-child","created_at":"2025-11-09T18:44:57.961955-05:00","created_by":"daemon"},{"issue_id":"quad-ops-xqw","depends_on_id":"quad-ops-4kk","type":"parent-child","created_at":"2025-11-09T18:45:14.878831-05:00","created_by":"daemon"}]}
{"id":"quad-ops-xru","content_hash":"2007dc9c5ec56f97e364450e65ae2a314a7bb979c179b52e52c9dc17358d244a","title":"Missing volume mount options: nocopy flag","description":"Volume mount nocopy option not supported in current implementation.","design":"## Problem\nDocker Compose volumes support the `nocopy` option (via `volume.nocopy: true`) which prevents copying content from the container image to the volume on first mount. This option is currently ignored during conversion.\n\n## Source Data\n- compose-spec library: `types.ServiceVolumeConfig.Volume.NoCopy` (bool)\n- Location: `internal/compose/spec_converter.go:convertVolumeMounts()`\n\n## Target Format\nQuadlet Volume= directive supports `nocopy` option:\n```\nVolume=myvolume:/data:nocopy\n```\n\n## Implementation Plan\n1. Update `internal/service/models.go`:\n   - Add `NoCopy bool` field to `Mount` struct or add to `Options` map\n\n2. Update `internal/compose/spec_converter.go:convertVolumeMounts()`:\n   - Check `v.Volume != nil \u0026\u0026 v.Volume.NoCopy` for volume-type mounts\n   - Set the nocopy flag in the Mount struct\n\n3. Update `internal/platform/systemd/renderer.go:addMounts()`:\n   - When building mount string, append `:nocopy` option if set\n   - Only applies to volume-type mounts, not bind mounts\n\n4. Add test cases:\n   - `internal/compose/testdata/golden/` - add compose file with volume nocopy\n   - `internal/platform/systemd/renderer_test.go` - test Volume= with nocopy option","acceptance_criteria":"- nocopy option in volume mounts is preserved\n- Rendered correctly in Quadlet Volume= directive","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-09T13:44:34.789316-05:00","updated_at":"2025-11-09T15:57:51.006339-05:00","closed_at":"2025-11-09T15:57:51.006339-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-xru","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T13:44:34.789745-05:00","created_by":"daemon"}]}
{"id":"quad-ops-y05","content_hash":"e84f1216cb92ca47c42515c0ee09b06a2973d5156a075a9ba8dc5dcb8ace969a","title":"Configs with file/content sources not converted to bind mounts","description":"Compose configs with local sources (file, content, environment) are parsed but not converted to bind mounts.\n\nStandard Compose configs (NOT Swarm-specific) work via bind mounts:\n- file: ./config.txt → bind mount from file\n- content: \"data\" → write to temp file, bind mount\n- environment: VAR → read var, write to file, bind mount\n\nSwarm-only configs (external: true with driver) should be rejected in validation.\n\nImpact: Config-based configuration files ignored","design":"1. Parse configs in spec_converter.go:\n   - file source: Create bind mount from file path\n   - content source: Write to project temp dir, create bind mount\n   - environment source: Read env var, write to temp file, create bind mount\n   - external with driver: REJECT in validation (Swarm-only)\n\n2. Map ServiceConfigObjConfig to Mount:\n   - source → bind mount source path\n   - target → container path (default: /run/configs/\u003cname\u003e)\n   - uid/gid/mode → convert to mount options if supported\n\n3. Validation:\n   - Error if config has driver field (Swarm-only)\n   - Warn if external without local file reference\n\nReference: https://github.com/compose-spec/compose-spec/blob/main/08-configs.md","acceptance_criteria":"- Configs with file source create bind mounts\n- Configs with content source write file and bind mount\n- Configs with environment source read var and bind mount  \n- External configs with driver fail validation with clear error\n- Test coverage for config mounting\n- Secrets follow same pattern","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-09T16:40:17.275033-05:00","updated_at":"2025-11-09T18:14:07.342942-05:00","closed_at":"2025-11-09T18:14:07.342942-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-y05","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.518647-05:00","created_by":"daemon"}]}
{"id":"quad-ops-yip","content_hash":"cb782964380a19f6f8b405d7b418941c6ed44f6068dc80ed3e3af907f45e3863","title":"Missing device_cgroup_rules support for fine-grained device access","description":"Compose device_cgroup_rules not converted, preventing low-level cgroup device permissions.\n\nExample: 'c 13:* rmw' to allow all /dev/input/* devices","design":"1. Add DeviceCgroupRules []string field to service.Container\n2. Convert service.DeviceCgroupRules in spec_converter.go:convertContainer()\n3. Render as PodmanArgs=--device-cgroup-rule \u003crule\u003e on both platforms\n\nFormat: 'type major:minor permissions'\nExample: 'c 13:* rmw'","acceptance_criteria":"- device_cgroup_rules converts to Container.DeviceCgroupRules\n- Renders as --device-cgroup-rule flags\n- Multiple rules work correctly\n- Test coverage for device access scenarios","notes":"Verified Podman support (no native Quadlet directive):\n- podman run --device-cgroup-rule 'type major:minor permissions'\n\nImplementation: Use PodmanArgs on both platforms","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-11-09T16:40:17.268431-05:00","updated_at":"2025-11-09T17:52:59.920321-05:00","closed_at":"2025-11-09T17:52:59.920321-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-yip","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.530145-05:00","created_by":"daemon"}]}
{"id":"quad-ops-yx7","content_hash":"a296e71c57dd8158ce37e58ca842c295c4295f6339f3bca43260c721117e1308","title":"Document systemd Quadlet generator requirements and setup","description":"Users deploying quad-ops need clear guidance on systemd Quadlet generator setup.\n\n## Missing Documentation\n1. **Generator installation**:\n   - What to install (podman package includes the generator)\n   - How to verify it's installed and working\n   - Systemd version requirements\n\n2. **Permissions**:\n   - Writing to /etc/containers/systemd requires root or proper user setup\n   - User-mode vs system-mode setup differences\n\n3. **Troubleshooting**:\n   - How to debug if generator isn't running\n   - How to manually check generated units\n   - How to verify Quadlet generator is in systemd's path\n\n4. **Timing/Delays**:\n   - Why there might be delays between writing files and services being available\n   - What happens if sync runs while generator is still processing\n\n## Deliverables\n- Update INSTALLATION.md with Quadlet generator setup\n- Add troubleshooting section to docs\n- Document systemd/Podman version compatibility","acceptance_criteria":"Add comprehensive documentation explaining Quadlet generator requirements, setup steps, and troubleshooting procedures. Ensure users understand the dependency on systemd generator availability.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-08T21:16:25.346460111-05:00","updated_at":"2025-11-08T21:16:25.346460111-05:00","source_repo":".","labels":["documentation","task"]}
{"id":"quad-ops-zow","content_hash":"d94eebc8228cf9ed1a5b0ec8353d2e132f0b4d399c8b99e508e5075ac33b8a1c","title":"Doc: network architecture and external network handling","description":"Document the network architecture and external network handling in the codebase.\n\nAdd to DESIGN.md or architecture docs:\n- How external networks are distinguished from project-local networks\n- Why external networks are NOT prefixed with project name\n- Use case: multiple projects sharing a single infrastructure network\n- The spec converter's role in resolving network references\n- How systemd/launchd renderers generate dependencies for networks\n\nThis helps future maintainers understand the network prefixing logic and why the fix for quad-ops-1sn was necessary.","status":"open","priority":4,"issue_type":"task","created_at":"2025-11-09T12:32:26.453181865-05:00","updated_at":"2025-11-09T12:32:26.453181865-05:00","source_repo":"."}
{"id":"quad-ops-zzc","content_hash":"b21e7bd703df47f46fc61d97030468f27337d448a7e9c3fd77b4f01a772fac56","title":"Missing sysctls support for kernel parameter tuning","description":"Compose sysctls field not converted, preventing kernel parameter configuration for containers.\n\nCommon use case: net.ipv4.ip_forward=1 for routing containers\n\nQuadlet native support: Sysctl= directive","design":"1. Add Sysctls map[string]string field to service.Container (internal/service/models.go)\n2. Convert service.Sysctls in spec_converter.go:convertContainer()\n3. Render:\n   - systemd: Quadlet Sysctl= directive (native, one per line)\n   - launchd: --sysctl flag (one --sysctl per entry)\n\nQuadlet format:\n```\nSysctl=net.ipv4.ip_forward=1\nSysctl=net.ipv6.conf.all.forwarding=1\n```\n\nPodman format:\n```\n--sysctl net.ipv4.ip_forward=1 --sysctl net.ipv6.conf.all.forwarding=1\n```","acceptance_criteria":"- sysctls in compose converts to Container.Sysctls\n- Renders as Sysctl= on systemd (multiple lines)\n- Renders as --sysctl on launchd (multiple flags)\n- Test coverage for kernel parameter scenarios","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-09T16:46:01.318249-05:00","updated_at":"2025-11-09T17:42:57.212928-05:00","closed_at":"2025-11-09T17:42:57.212928-05:00","source_repo":".","dependencies":[{"issue_id":"quad-ops-zzc","depends_on_id":"quad-ops-hlf","type":"parent-child","created_at":"2025-11-09T16:51:18.523718-05:00","created_by":"daemon"}]}
